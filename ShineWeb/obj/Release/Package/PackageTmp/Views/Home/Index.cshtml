@model ShineWeb.Models.Homescreen
@{
    ViewBag.Title = "Home Page";
}
<link href="~/Content/bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/navbar.css" rel="stylesheet" />
<link href="~/Content/buttonTop.css" rel="stylesheet" />
<link href="~/Content/jquery-ui.css" rel="stylesheet" />
<link href="~/Content/dataTables.dataTables.2.2.2.css" rel="stylesheet" />
<script src="~/Scripts/bootstrap.min.js"></script>
<script src="~/Scripts/jquery-1.10.2.min.js"></script>
<script src="~/Scripts/jquery-3.7.1.js"></script>
<script src="~/Scripts/bootstrap-typeahead.min.js"></script>
<script src="~/Scripts/jquery-ui.js"></script>
<script src="~/Scripts/dataTables.2.2.2.js"></script>
<script src="~/Scripts/js/refreshtoken.js"></script>
<style>
    td {
        font-size: 11px;
    }

    input[type=number] {
        text-align: right;
    }

        input[type=number]::placeholder {
            text-align: left;
        }
    /* Chrome, Safari, Edge, Opera */
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    /* Firefox */
    input[type=number] {
        -moz-appearance: textfield;
    }
    /* The Modal (background) */
    .modalBatch1 {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 10; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    /* Modal Content/Box */
    @@media only screen and (min-width: 600px) {
        .modalBatch-content1 {
            background-color: #ffffff;
            margin: 3% auto; /* 15% from the top and centered */
            padding: 10px;
            border: 1px solid #888;
            width: 80%; /* Could be more or less, depending on screen size */
            height: 80%;
            top: 5%;
            overflow: auto;
        }
    }

    @@media only screen and (max-width: 600px) {
        .modalBatch-content1 {
            background-color: #ffffff;
            margin: 10% auto; /* 15% from the top and centered */
            padding: 25px;
            border: 1px solid #888;
            width: 95%; /* Could be more or less, depending on screen size */
            height: 90%;
            top: 20%;
            overflow: auto;
        }
    }

    .modal-dialog {
        width: 80%
    }
    /* The Close Button */
    .closefg1 {
        color: #aaa;
        float: right;
        font-size: 10px;
        font-weight: bold;
    }

        .closefg1:hover,
        .closefg1:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

    .form-label {
        position: relative;
        display: block;
        clear: both;
        max-width: 500px;
        margin: 0 auto;
    }

    .labelup {
        -webkit-transform: translateY(50%);
        -moz-transform: translateY(-50%);
        -ms-transform: translateY(-50%);
        -o-transform: translateY(-50%);
        transform: translateY(50%);
        -webkit-transition: all 0.2s ease-in-out;
        -moz-transition: all 0.2s ease-in-out;
        transition: all 0.2s ease-in-out;
        position: absolute;
        top: -40%;
        left: 1em;
        background: #fffefe;
        color: #2b2828;
        font-size: 0.90em;
        cursor: text;
        pointer-events: none;
        font-family: sans-serif;
    }

    tr {
        cursor: pointer
    }

    body {
        font-family: Arial, sans-serif;
    }

    .gdInput {
        width: 100%;
        height: 25px;
        border-width: 0 0 0.1px 0;
        border-color: #e0d6d6;
    }
    #tblDraftCount colgroup col{
        min-width:10px !important;
    }
</style>
<style>
    .summary-box {
        display: inline-block;
        min-width: 100px;
        padding: 15px 20px;
        border-radius: 8px;
        margin: 5px;
        text-align: center;
        vertical-align: middle;
    }

    .bg-paid {
        background-color: #ccf5e7;
    }

    .bg-unpaid {
        background-color: #d8eaff;
    }

    .bg-total {
        background-color: #ffd999;
    }

    .summary-label {
        font-size: 12px;
        color: #333;
        margin-bottom: 5px;
    }

    .summary-value {
        font-size: 14px;
        font-weight: bold;
        color: #000;
    }

    .summary-symbol {
        font-size: 20px;
        font-weight: bold;
        margin: 0 8px;
        display: inline-block;
        vertical-align: middle;
    }

    .rowselected {
        background-color: #daf6fb !important;
    }
</style>
<style>
    .quick-access {
        background-color: #fff3cd;
        padding: 5px;
        font-weight: bold;
        border: 1px solid #eee;
    }

    .form-section {
        background-color: #d9edf7;
        padding: 5px;
        border: 1px solid #bce8f1;
    }

    .btn-group {
        margin-top: 5px;
    }

    label {
        font-weight: normal;
    }

    .quick-form-container {
        position: fixed; /* stays in top-right even on scroll */
        top: 50px;
        right: 20px;
        width: 220px;
        z-index: 1;
    }
    .container{
        padding:0px !important;
    }
    .Transvariant-container {
        position: fixed; /* stays in top-right even on scroll */
        top: 260px;
        right: 20px;
        width: 220px;
        z-index: 1;
    }
</style>
<body>
    <div class="toastBox"></div>
    @Html.HiddenFor(model => model.CollectionDetailEnable, new { @autocomplete = "off", @class = "form-control", @id = "txtCollectionDetailEnable" })
    @Html.HiddenFor(model => model.ChequeDetailEnable, new { @autocomplete = "off", @class = "form-control", @id = "txtChequeDetailEnable" })
    @Html.HiddenFor(model => model.TransVariantEnable, new { @autocomplete = "off", @class = "form-control", @id = "txtTransVariantEnable" })
    
    <div class="quick-form-container">
        <div class="quick-access">Quick Access</div>
        <div class="form-section">
            <div>
                <label for="transaction">Transaction:</label>
                <select class="form-control" id="cmbQAtransaction">
                </select>
                <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrTransName" class="clrdivs"></div>
            </div>
            <div>
                <label for="docid">Doc ID:</label>
                <input type="text" class="form-control" id="txtQAdocid" placeholder="Enter Doc ID">
                <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrDocID" class="clrdivs"></div>
            </div>
            <div>
                <table width="100%">
                    <tr>
                        <td align="left">
                            <button type="button" id="btnQAClear" class="btn btn-danger"><span class="glyphicon glyphicon-refresh"> Reset </span></button>
                        </td>
                        <td align="right">
                            <button type="button" id="btnQASubmit" class="btn btn-success"><span class="glyphicon glyphicon-saved"> Submit </span></button>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <div class="Transvariant-container">
        <div class="quick-access">Transaction Variant</div>
        <div class="form-section">
            <div>
                <label for="transaction">Transaction:</label>
                <select class="form-control FormclrcmbField" id="cmbVariantTransaction"><option value="0">Select</option></select>
                <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrVariantTransName" class="clrdivs"></div>
            </div>
            <div>
                <label for="docid">Doc ID:</label>
                <input type="text" class="form-control" id="txtVariantDocID" placeholder="Select Doc ID">
                <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrVariantDocID" class="clrdivs"></div>
            </div>
            <div>
                <input hidden id="txtPartyID" />
                <label for="docid">Party Name:</label>
                <input type="text" class="form-control" id="txtVariantPartyName" placeholder="Select Party Name">
                <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrVariantPartyName" class="clrdiv"></div>
            </div>
            <div>
                <table width="100%">
                    <tr>
                        <td align="left">
                            <button type="button" id="btnVariantClear" class="btn btn-danger"><span class="glyphicon glyphicon-refresh"> Reset </span></button>
                        </td>
                        <td align="right">
                            <button type="button" id="btnVariantSubmit" class="btn btn-success"><span class="glyphicon glyphicon-saved"> Submit </span></button>
                        </td>
                    </tr>
                </table>


            </div>
        </div>
    </div>
    <div class="row">
        <div id="dvMainTable" class="col-xs-12 col-sm-12 col-md-2 col-lg-2">
            <table class="table table-bordered" id="tblDraftCount" width="100%">
                <thead>
                    <tr>
                        <th colspan="4">Pending Draft</th>
                    </tr>
                    <tr class="trclrforcolheader">
                        <th style="text-align:center;font-size: 12px;width:0%;">TransID</th>
                        <th style="text-align:center;font-size: 12px;width:0%;">TransName</th>
                        <th style="text-align:center;font-size: 12px;width:75%;">Transaction</th>
                        <th style="text-align:center;font-size: 12px;width:25%;">Count</th>

                    </tr>
                </thead>
            </table>
        </div>
        <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
            <div id="dvCollectionDetail">
                <table class="table table-bordered" id="tblCollectionDetail" width="100%">
                    <thead>
                        <tr>
                            <th>Collection Details</th>
                            <th>
                                <select id="cmbTimeFilter" class="gdInput">
                                    <option value="1">Today</option>
                                    <option value="2">Week</option>
                                    <option value="3">Month</option>
                                    <option value="4">Quarter</option>
                                    <option value="5">All</option>
                                </select>
                            </th>
                        </tr>
                        <tr class="trclrforcolheader">
                            <th style="text-align:center;font-size: 12px;width:65%;">
                                Payment Mode
                            </th>
                            <th style="text-align:center;font-size: 12px;width:35%;">
                                Collected ₹
                            </th>
                        </tr>
                    </thead>
                </table>
            </div>
            <div id="dvChequeDetail">
                <table class="table table-bordered" id="tblChequeDetail" width="100%">
                    <thead>
                        <tr>
                            <th colspan="3">Cheque In Hand</th>
                        </tr>
                        <tr class="trclrforcolheader">
                            <th style="text-align:center;font-size: 12px;width:50%;">
                                Date
                            </th>
                            <th style="text-align:center;font-size: 12px;width:25%;">
                                Count
                            </th>
                            <th style="text-align:center;font-size: 12px;width:25%;">
                                Amount
                            </th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>

        <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
            <div style="padding-top:20px">
                <div class="container text-center">
                    <div class="summary-box bg-paid">
                        <div class="summary-label">Cash</div>
                        <div class="summary-value" id="dvCash">₹ 0.00</div>
                    </div>
                    <div class="summary-box bg-unpaid">
                        <div class="summary-label">Bank</div>
                        <div class="summary-value" id="dvBank">₹ 0.00</div>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <div class="modalBatch1" id="myModalfg1">
        <div class="modal-dialog">
            <div class="modalBatch-content1">
                <!-- Modal Header -->
                <div class="modal-header">
                    <button type="button" class="closefg1">&times;</button>
                    <h5 class="modal-title" style="color:black" id="lblPopupheading"><b></b></h5>
                    @*<hr />*@
                </div>
                <!-- Modal body -->
                <div class="modal-body">
                    <div style="padding-top:2px">
                        <div id="dvAssign" style="width:100%;padding-bottom:7px">
                            <input hidden id="txtTransID" />
                            <input hidden id="txtTransName" />
                            <table class="table table-bordered" id="tblDraftData" width="100%">
                                <thead>
                                    <tr class="trclrforcolheader">
                                        <th style="text-align:center;font-size: 12px;width:0%;">TransID</th>
                                        <th style="text-align:center;font-size: 12px;width:0%;">ID</th>
                                        <th style="text-align:center;font-size: 12px;width:0%;">Mode</th>
                                        <th style="text-align:center;font-size: 12px;width:0%;">EnccDocprefix</th>
                                        <th style="text-align:center;font-size: 12px;width:9%;">Doc ID</th>
                                        <th style="text-align:center;font-size: 12px;width:9%;">Date</th>
                                        <th style="text-align:center;font-size: 12px;width:10%;">Ref No</th>
                                        <th style="text-align:center;font-size: 12px;width:12%;">Branch</th>
                                        <th style="text-align:center;font-size: 12px;width:9%;">Beat Name</th>
                                        <th style="text-align:center;font-size: 12px;width:9%;">Salesman Name</th>
                                        <th style="text-align:center;font-size: 12px;width:20%;">Party Name</th>
                                        <th style="text-align:center;font-size: 12px;width:8%;">Gross ₹</th>
                                        <th style="text-align:center;font-size: 12px;width:8%;">Tax ₹</th>
                                        <th style="text-align:center;font-size: 12px;width:8%;">Net ₹</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" style="background-color:skyblue">
                    <div style="padding-top:0px" align="right">
                        <button tabindex="5" type="button" class="btn btn-warning" id="btnClose"><span class="glyphicon glyphicon-remove"> Close</span></button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script type="text/javascript">
    var RID = '@Session["RoleID"]';
    var Aurl = '@Session["APIurl"]';
    var TblDraftCount = $('#tblDraftCount').DataTable({
        "bFilter": false,
        "bSearchable": false,
        "bInfo": false,
        "bPaginate": false,
        "ordering": false,
        scrollY: "400px",
        scrollX: true,
        scrollCollapse: true,
        "columnDefs": [{ "targets": [0, 1], "visible": false, searchable: false }, { "targets": [3], "class": "dt-body-center" }],
    });
    var TblDraftData = $('#tblDraftData').DataTable({
        "bFilter": true,
        "bSearchable": true,
        "bInfo": true,
        "bPaginate": true,
        "ordering": false,
        scrollY: "300px",
        scrollX: true,
        scrollCollapse: true,
        "columnDefs": [{ "targets": [0, 1, 2,3,4,7,8,9], "visible": false, searchable: false }],
    });
    var tblCollectionDetail = $('#tblCollectionDetail').DataTable({
        "bFilter": false,
        "bSearchable": false,
        "bInfo": false,
        "bPaginate": false,
        "ordering": false,
        scrollY: "400px",
        scrollX: true,
        scrollCollapse: true,
    });
    var tblChequeDetail = $('#tblChequeDetail').DataTable({
        "bFilter": false,
        "bSearchable": false,
        "bInfo": false,
        "bPaginate": false,
        "ordering": false,
        scrollY: "400px",
        scrollX: true,
        scrollCollapse: true,
});

    function displayResult(item) {
        $('.alert').show().html('You selected <strong>' + item.value + '</strong>: <strong>' + item.text + '</strong>');
    }
    var modal = document.getElementById("myModalfg1");
    var span = document.getElementsByClassName("closefg1")[0];
    span.onclick = function () {
        modal.style.display = "none";
    }
    $('#btnClose').click(function (e) {
        modal.style.display = "none";
    });
    if ($("#txtCollectionDetailEnable").val() == 0) {
        $("#dvCollectionDetail").hide();
    }
    if ($("#txtChequeDetailEnable").val() == 0) {
        $("#dvChequeDetail").hide();
    }
    if ($("#txtTransVariantEnable").val() == 0) {
        $(".Transvariant-container").hide();
    }    
    GetData(1, 0);
    GetData(5, 0);
    GetData(6, RID);
    var arrTrans = [];
    function GetData(nMode, ID) {
        $.ajax({
            url: Aurl + "homescreendraft/get",
            type: 'get',
            contentType: 'json',
            data: { Mode: nMode, Trans: ID },
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                if (nMode == 1) {
                    if (data.length > 0) {
                        TblDraftCount.draw().clear(); TblDraftCount.draw().clear();
                        $.each(data, function (i, items) {
                            TblDraftCount.row.add([
                                items.ID,
                                items.Mode,
                                items.Name,
                                items.Value
                            ]).draw(false);
                        });
                    }
                }
                else if (nMode == 2) {
                    TblDraftData.draw().clear(); TblDraftData.draw().clear();
                    if (data.length > 0) {
                        $.each(data, function (i, items) {
                            TblDraftData.row.add([
                                items.TransID,
                                items.ID,
                                items.TransMode,
                                items.EncDocPrefix,
                                items.DocID,
                                items.Date,
                                items.RefNo,
                                items.BranchID,
                                items.IsDraft,
                                items.DraftID,
                                items.VendorName,
                                items.GrossAmt,
                                items.TaxAmt,
                                items.NetAmt,
                            ]).draw(false);
                        });
                        //TblDraftData.column(5).visible(false);
                        //TblDraftData.column(6).visible(false);
                    }
                }
                if (nMode == 5) {
                    $("#dvCash").html("₹ 0.00");
                    $("#dvBank").html("₹ 0.00");
                    var pmdata = eval(data);
                    if (pmdata.length > 0) {
                        $("#dvCash").html("₹ " + pmdata[0].Balance);
                        $("#dvBank").html("₹ " + pmdata[1].Balance);
                    }
                }
                if (nMode == 6) {
                    arrTrans = [];
                    $('#cmbQAtransaction').find("option").remove();
                    $('#cmbQAtransaction').append($('<option/>', {
                        value: 0,
                        text: "-- Select --",                        
                    }));
                    var transdata = eval(data);
                    if (transdata.length > 0) {
                        $.each(transdata, function (i, items) {
                            $('#cmbQAtransaction').append($('<option/>', {
                                value: items.TransID,
                                text: items.TransName,
                                name: items.DocPrefix
                            }));
                            arrTrans.push(items);
                        });
                    } else {
                        //showErrorSnackbar("You dont have any Transaction permissions");
                    }
                }
            }
        });
    }
    $('#cmbQAtransaction').change(function (e) {
        var selval = e.target.value;
        if (selval > 0) {
            var ftrans = arrTrans.filter(tr => tr.TransID == selval)
            if (ftrans.length > 0) {
                $("#txtQAdocid").val(ftrans[0].DocPrefix);
            }
        } else {
            $("#txtQAdocid").val("");
        }
    });
    $("#txtQAdocid1").change(function (e) {
    //$("#txtQAdocid").keydown(function (e) {
        //if (e.key === "Enter") {
            $("#divErrDocID").html("");
            var val = e.target.value;
            if (val.includes("/")) {
                //var ftrans = arrTrans.filter(tr => tr.DocPrefix.includes(val))
                //console.log(ftrans);
                let filtered = arrTrans.filter(item =>
                    item.DocPrefix.toLowerCase().includes(val.toLowerCase())
                );
                if (filtered.length > 0) {
                    $("#txtQAdocid").val(filtered[0].DocPrefix);
                    $('#cmbQAtransaction').val(filtered[0].TransID);
                } else {
                    //no trans found
                    $("#divErrDocID").html("No Transaction found");
                    $('#cmbQAtransaction').val(0);
                }
            } else {

            }
        //}
    });
    $("#btnQAClear").click(function () {
        $("#divErrDocID").html("");
        $("#txtQAdocid").val("");
        $('#cmbQAtransaction').val(0);
    });
    $("#btnQASubmit").click(function () {
        $("#divErrDocID,#divErrTransName").html("");
        if ($('#cmbQAtransaction').val() == 0) {
            $("#divErrTransName").html("Select Transaction");
        }
        else if ($('#txtQAdocid').val() == "") {
            $("#divErrTransName").html("Doc ID should not be empty");
        }
        else {
            var dTransID = $('#cmbQAtransaction').val();
            var DocID = $('#txtQAdocid').val();
            QuickAccessDocument(dTransID, DocID);
        }        
    });
    function QuickAccessDocument(dTransID, DocID) {
        $.ajax({
            url: Aurl + "quicaccessdocument/validate",
            type: 'get',
            contentType: 'json',
            data: { TransID: dTransID, strDocID: DocID },
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                $.each(data, function (i, items) {
                    if (items.MsgID == "0") {
                        if (dTransID == 1) {
                            window.open(
                                'PurchaseBill?name=Vd%2B%2BrU8QQpt1lN1iIJW1a%2FK0VGZeYK0pqK2Sc7MnuHQ%3D&strFormID=jJOtHsRVwYECOhoiBc69dA%3D%3D&TypeID=BOII5FUynjpl5RZJJ8nW1g%3d%3d&TranID=' + items.ID,
                                '_blank'
                            );
                        }
                        if (dTransID == 2) {
                            window.open(
                                'AutomaticIndent?name=w2ZCPJkGFF0AoGvRO1%2BMNrYg%2FTlGSP7RFKOTKnKk7TZy%2BjK6iu0iUfEo8qMSw%2BYi&strFormID=jJOtHsRVwYECOhoiBc69dA%3D%3D&TypeID=BOII5FUynjpl5RZJJ8nW1g%3d%3d&TranID=' + items.ID,
                                '_blank'
                            );
                        }
                        if (dTransID == 3) {
                            window.open(
                                'PurchaseOrder?name=Vd%2B%2BrU8QQpt1lN1iIJW1a5vMQ8aDbizObKKScceojgs%3D&strFormID=jJOtHsRVwYECOhoiBc69dA%3D%3D&TypeID=BOII5FUynjpl5RZJJ8nW1g%3d%3d&TranID=' + items.ID,
                                '_blank'
                            );
                        }
                       
                        
                        if (dTransID == 12) {
                            window.open(
                                'PurchaseReturn?name=Vd%2B%2BrU8QQpt1lN1iIJW1a4zfOkO06OcdMkE6UiXKDWE%3D&strFormID=jJOtHsRVwYECOhoiBc69dA%3D%3D&TypeID=BOII5FUynjpl5RZJJ8nW1g%3d%3d&TranID=' + items.ID,
                                '_blank'
                            );
                        }
                        if (dTransID == 13) {
                            window.open(
                                'InventoryAdjustment?name=i3DMZtc%2FTn0UH9DhV75tUuopguddgZuQmQzrgq7DF2pb%2BgzoOuIpBbtZod7IAoud&strFormID=jJOtHsRVwYECOhoiBc69dA%3D%3D&TypeID=BOII5FUynjpl5RZJJ8nW1g%3d%3d&TranID=' + items.ID,
                                '_blank'
                            );
                        }
                        if (dTransID == 14) {
                            window.open(
                                'Quotation?name=BTQgLv%2BebY48FN9pEezgnyVrVumuVVzPVnoCFOjqIsU%3D&strFormID=jJOtHsRVwYECOhoiBc69dA%3D%3D&TypeID=BOII5FUynjpl5RZJJ8nW1g%3d%3d&TranID=' + items.ID,
                                '_blank'
                            );
                        }
                        if (dTransID == 15) {
                            window.open(
                                'Invoice?name=KUGYxS%2BKhoQB3%2FYrx1I0cQ%3D%3D&strFormID=jJOtHsRVwYECOhoiBc69dA%3D%3D&TypeID=BOII5FUynjpl5RZJJ8nW1g%3d%3d&TranID=' + items.ID,
                                '_blank'
                            );
                        }
                        if (dTransID == 16) {
                            window.open(
                                'SalesReturn?name=6%2B9sxOBkg1PjlBjpubNIcRsbDdS%2F%2BKzbighA08XDWD0%3D&strFormID=EvsdnH%2BUlJpTVhFYh%2Bi13g%3D%3D&TypeID=BOII5FUynjpl5RZJJ8nW1g%3d%3d&TranID=' + items.ID,
                                '_blank'
                            );
                        }     
                        //if (dTransID == 17) {
                        //    window.open(
                        //        'SalesReturn?name=cPfu941CFnux5sU80vV6w6mcrcNWP7Vs7hhrLOCLYgo%3D&strFormID=WHYf4alVgNJY%2FX917pnZ3w%3D%3D&TypeID=BOII5FUynjpl5RZJJ8nW1g%3d%3d&TranID=' + items.ID,
                        //        '_blank'
                        //    );
                        //}
                        if (dTransID == 19) {
                            window.open(
                                'CollectionPayment?name=V5BIclDO7YSWXMUYe9qSUbB92jlocOM14lUepH77xc4%3D&strFormID=NyU15GCpL%2FZR9n8fK57WAg%3D%3D&TypeID=BOII5FUynjpl5RZJJ8nW1g%3d%3d&TranID=' + items.ID,
                                '_blank'
                            );
                        }
                        if (dTransID == 18) {
                            window.open(
                                'CollectionPayment?name=w3tjkQAA1vr%2BSnaRJEKUVw%3D%3D&strFormID=IXL1NOfIxouMMmMKvHxKbA%3D%3D&TypeID=BOII5FUynjpl5RZJJ8nW1g%3d%3d&TranID=' + items.ID,
                                '_blank'
                            );
                        }

                                                
                    } else {
                        showErrorSnackbar("Doc ID not matched. Enter correct Doc ID");
                    }
                });
            }
        });
    }
    getCollectionData(1);
    function getCollectionData(FType) {
        $.ajax({
            url: Aurl + "homescreendraft/get",
            type: 'get',
            contentType: 'json',
            data: { Mode: 3, Trans: FType },
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                var colldata = eval(data);
                $('#tblCollectionDetail').DataTable({
                    scrollY: "250px",
                    scrollX: true,
                    scrollCollapse: true,
                    paging: false,
                    info:false,
                    destroy: true,
                    data: colldata,
                    fixedColumns: false,
                    searching: false,
                    ordering: false,
                    sorting: false,
                    columns: [
                        { "data": "PaymentMode", "autoWidth": true, className: "dt-body-left" },
                        { "data": "ColAmt", "autoWidth": true, className: "dt-body-right" },
                    ],

                });
                tblCollectionDetail = $('#tblCollectionDetail').DataTable();
                $("#cmbTimeFilter").val(FType);
            }
        });
    }
    getChequeData();
    function getChequeData() {
        $.ajax({
            url: Aurl + "homescreendraft/get",
            type: 'get',
            contentType: 'json',
            data: { Mode: 4, Trans: "" },
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                var chqdata = eval(data);
                $('#tblChequeDetail').DataTable({
                    scrollY: "250px",
                    scrollX: true,
                    scrollCollapse: true,
                    paging: false,
                    info: false,
                    destroy: true,
                    data: chqdata,
                    fixedColumns: false,
                    searching: false,
                    ordering: false,
                    sorting: false,
                    columns: [
                        { "data": "DateType", "autoWidth": true, className: "dt-body-left" },
                        { "data": "Counts", "autoWidth": true, className: "dt-body-center" },
                        { "data": "collAmt", "autoWidth": true, className: "dt-body-right" },
                    ],
                });
                tblChequeDetail = $('#tblChequeDetail').DataTable();
            }
        });
    }
    //$('#cmbTimeFilter').on('change', function (e) {
    $(document).on("change", "#cmbTimeFilter", function (e) {
    //$('#tblCollectionDetail').on('change', '#cmbTimeFilter', function (e) {
        var Selval = e.target.value;
        getCollectionData(Selval);
    })

    $('#tblDraftCount tbody').on('dblclick', 'td', function () {
        rowdata = TblDraftCount.row($(this).parents('tr')).data();
        var ID = rowdata[0];
        var Name = rowdata[2];
        var Trans = rowdata[1];
        $("#txtTransID").val(ID); $("#txtTransName").val(Trans);
        $("#lblPopupheading").text(Name);
        GetData(2, ID);
        modal.style.display = "block";
    });
    $('#tblDraftData tbody').on('dblclick', 'td', function () {
        rowdata = TblDraftData.row($(this).parents('tr')).data();
        var TransID = rowdata[0];
        var ID = rowdata[1];
        var TransMode = rowdata[2];
        var docprefix = rowdata[3];
        var trn = $("#txtTransName").val();
        //alert("ID : " + ID + ", Trans : " + TransMode + ", Name : " + trn);
        if (TransID == 1) {
            window.open(
                'PurchaseBill?name=' + trn + '&strFormID=' + TransMode + '&TypeID=' + TransMode + '&TranID=' + ID,
                '_blank'
            );
        } else if (TransID == 2) {
            window.open(
                'AutomaticIndent?name=' + trn + '&strFormID=' + TransMode + '&TypeID=' + TransMode + '&TranID=' + ID,
                '_blank'
            );
        } else if (TransID == 3) {
            window.open(
                'PurchaseOrder?name=' + trn + '&strFormID=' + TransMode + '&TypeID=' + TransMode + '&TranID=' + ID,
                '_blank'
            );
        } else if (TransID == 15) {
            window.open(
                'Invoice?name=' + trn + '&strFormID=' + TransMode + '&TypeID=' + TransMode + '&TranID=' + ID,
                '_blank'
            );
        } else if (TransID == 14) {
            window.open(
                'Quotation?name=' + trn + '&strFormID=' + TransMode + '&TypeID=' + TransMode + '&TranID=' + ID,
                '_blank'
            );
        }
        else if (TransID == 16 || TransID == 17) {
            window.open(
                'SalesReturn?name=' + trn + '&strFormID=' + docprefix + '&TypeID=' + TransMode + '&TranID=' + ID,
                '_blank'
            );
        }
    });    
    var arrVarTrans = [], arrPartyData = [], nVariantTransID = 0;
    GetVariantData(1);
    function GetVariantData(nMode, nID = 0) {
        $.ajax({
            url: Aurl + "transactionvariant/gettrans",
            type: 'get',
            contentType: 'json',
            data: { Mode: nMode, PartyType: nID },
            xhrFields: {
                withCredentials: true
            },
            async: false,
            success: function (data) {
                if (data.length > 0) {
                    if (nMode == 1) {
                        arrVarTrans = [];
                        $('#cmbVariantTransaction').find("option").remove();
                        $('#cmbVariantTransaction').append($('<option/>', {
                            value: 0,
                            text: "-- Select --",
                        }));
                        $.each(eval(data), function (i, items) {
                            var al = {
                                "Transaction": items.Name,
                                "TypeID": items.ID,
                                "DocPrefix": items.DocPrefix,
                                "TransID": items.TransID,
                            }
                            arrVarTrans.push(al);
                            $('#cmbVariantTransaction').append($('<option/>', {
                                value: items.ID,
                                text: items.Name,
                                name: items.DocPrefix
                            }));
                        });
                        console.log(eval(data));
                    }
                    else if (nMode == 2) {
                        arrPartyData = [];
                        $.each(eval(data), function (i, items) {
                            var al = {
                                "label": items.Name,
                                "id": items.ID,
                            }
                            arrPartyData.push(al);
                        });
                        $("#txtVariantPartyName").autocomplete({
                            minLength: 0,
                            source: arrPartyData,
                            //autoFocus: true,
                            //focus: function (event, ui) {
                            //    $("#txtName").val(ui.item.label);
                            //    return false;
                            //},
                            select: function (event, ui) {
                                $("#txtPartyID").val(ui.item.id);
                                $("#txtVariantPartyName").val(ui.item.label);
                                //$("#txtRemarks").val(ui.item.id);
                                return false;
                            },
                        }).autocomplete("instance")._renderItem = function (ul, item) {
                            return $("<li class='each'>")
                                .append("<div class='acItem'><span class='name'>" +
                                    item.label + "</span></div>")
                                .appendTo(ul);
                        };
                    }

                }
                else {
                    showErrorSnackbar("No Records Found");
                }
            }
            , error: function (data) {
                if (data.status == "401") {
                    var msg = data.responseJSON.Message;
                    ////showErrorSnackbar(msg + " Logout and Login again.");
                }
            }
        });
    }
    $('#cmbVariantTransaction').change(function (e) {
        var ID = e.target.value;
        if (ID > 0) {
            var ftrans = arrVarTrans.filter(tr => tr.TypeID == ID)
            if (ftrans.length > 0) {
                nVariantTransID = ftrans[0].TransID;
                $("#txtVariantDocID").val(ftrans[0].DocPrefix);
            }
            PType = (ID == 1 || ID == 2 || ID == 3) ? 1 : 2;
            GetVariantData(2, PType);
        } else {
            $("#txtVariantDocID").val("");
            nVariantTransID = 0;
            showErrorSnackbar("Select Transaction");
        }
    });
    $('#btnVariantClear').click(function (e) {
        ClearVariantForm();
    });
    function ClearVariantForm() {
        GetVariantData(1);
        $(".clrdivs").html("");
        $("#txtVariantDocID,#txtVariantPartyName").val("");
        $("#cmbVariantTransaction").focus();
    }
    $("#btnVariantSubmit").click(function () {
        $(".clrdivs").html("");
        var IsValid = true;
        if ($("#cmbVariantTransaction").val() == 0) {
            IsValid = false;
            $("#divErrVariantTransName").html("Select Transaction");
            showErrorSnackbar("Select Transaction");
        }
        if ($("#txtPartyID").val() == 0 || $("#txtPartyID").val() == "") {
            IsValid = false;
            $("#divErrVariantPartyName").html("Select valid party");
            showErrorSnackbar("Select valid party");
        }
        if ($("#txtVariantDocID").val() == "") {
            IsValid = false;
            $("#divErrVariantDocID").html("Doc ID should not be empty");
            showErrorSnackbar("Doc ID should not be empty");
        }
        if (IsValid) {
            var DocID = $("#txtVariantDocID").val()
            var dTransID = nVariantTransID;
            var VariantType = $("#cmbVariantTransaction").val();
            $.ajax({
                url: Aurl + "quicaccessdocument/validate",
                type: 'get',
                contentType: 'json',
                data: { TransID: dTransID, strDocID: DocID },
                xhrFields: {
                    withCredentials: true
                },
                success: function (data) {
                    $.each(data, function (i, items) {
                        if (items.MsgID == "0") {
                            if (VariantType == 1) {// Inv to Qtn
                                window.open(
                                    'Quotation?name=BTQgLv%2BebY48FN9pEezgnyVrVumuVVzPVnoCFOjqIsU%3D&strFormID=jJOtHsRVwYECOhoiBc69dA%3D%3D&TypeID=ydRRTTxkdt6Trx91pX1%2BcA%3D%3D&TranID=' + items.ID + '&TransVariantID=' + VariantType,
                                    '_blank'
                                );
                            }
                            if (VariantType == 2) {// Inv to Sales Return                                
                                window.open(                                    
                                    'SalesReturn?name=6%2B9sxOBkg1PjlBjpubNIcRsbDdS%2F%2BKzbighA08XDWD0%3D&strFormID=EvsdnH%2BUlJpTVhFYh%2Bi13g%3D%3D&TypeID=ydRRTTxkdt6Trx91pX1%2BcA%3D%3D&TranID=' + items.ID + '&TransVariantID=' + VariantType + '&PartyID=' + $("#txtPartyID").val(),
                                    '_blank'
                                );
                            }
                            if (VariantType == 3) {// Inv to Damage Return    
                                window.open(
                                    'SalesReturn?name=cPfu941CFnux5sU80vV6w6mcrcNWP7Vs7hhrLOCLYgo%3D&strFormID=WHYf4alVgNJY%2FX917pnZ3w%3D%3D&TypeID=ydRRTTxkdt6Trx91pX1%2BcA%3D%3D&TranID=' + items.ID + '&TransVariantID=' + VariantType + '&PartyID=' + $("#txtPartyID").val(),
                                    '_blank'
                                );
                            }
                        }
                    });
                }
            });                       
        }
    });
</script>
