
@{
    ViewBag.Title = "Print Profile Config";
}

<link href="~/Content/bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/navbar.css" rel="stylesheet" />
<link href="~/Content/dataTables.dataTables.2.2.2.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<script src="~/Scripts/bootstrap.min.js"></script>
<script src="~/Scripts/jquery-3.7.1.js"></script>
<script src="~/Scripts/jquery-ui.js"></script>
<script src="~/Scripts/Validation.js"></script>
<script src="~/Scripts/datatable.js"></script>
<script src="~/Scripts/dataTables.2.2.2.js"></script>
<script src="~/Scripts/js/refreshtoken.js"></script>
<style>
    each {
        border-bottom: 1px solid #555;
        padding: 3px 0;
    }

    .acItem .name {
        font-size: 14px;
        font-family: Arial, Helvetica, sans-serif;
    }

    .acItem .desc {
        font-size: 10px;
        font-family: Arial, Helvetica, sans-serif;
        color: #555;
    }

    .ui-autocomplete {
        max-height: 245px;
        overflow-y: auto;
        overflow-x: hidden;
    }

    td {
        font-size: 11px;
    }

    input[type=number] {
        text-align: right;
    }

        input[type=number]::placeholder {
            text-align: left;
        }
    /* Chrome, Safari, Edge, Opera */
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    /* Firefox */
    input[type=number] {
        -moz-appearance: textfield;
    }
    /* The Modal (background) */
    .modalBatch {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 10; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    /* Modal Content/Box */
    @@media only screen and (min-width: 600px) {
        .modalBatch-content {
            background-color: #ffffff;
            margin: 3% auto; /* 15% from the top and centered */
            padding: 10px;
            border: 1px solid #888;
            width: 35%; /* Could be more or less, depending on screen size */
            height: 70%;
            top: 5%;
            overflow: auto;
        }
    }

    @@media only screen and (max-width: 600px) {
        .modalBatch-content {
            background-color: #ffffff;
            margin: 10% auto; /* 15% from the top and centered */
            padding: 25px;
            border: 1px solid #888;
            width: 99%; /* Could be more or less, depending on screen size */
            height: 80%;
            top: 20%;
            overflow: auto;
        }
    }
    /* The Close Button */
    .closefg {
        color: #aaa;
        float: right;
        font-size: 10px;
        font-weight: bold;
    }

        .closefg:hover,
        .closefg:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

    .form-label {
        position: relative;
        display: block;
        clear: both;
        max-width: 500px;
        margin: 0 auto;
    }

    .labelup {
        -webkit-transform: translateY(50%);
        -moz-transform: translateY(-50%);
        -ms-transform: translateY(-50%);
        -o-transform: translateY(-50%);
        transform: translateY(50%);
        -webkit-transition: all 0.2s ease-in-out;
        -moz-transition: all 0.2s ease-in-out;
        transition: all 0.2s ease-in-out;
        position: absolute;
        top: -40%;
        left: 1em;
        background: #fffefe;
        color: #2b2828;
        font-size: 0.90em;
        cursor: text;
        pointer-events: none;
        font-family: sans-serif;
    }

    .switch {
        position: relative;
        display: inline-block;
        width: 35px;
        height: 18px;
    }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #f00;
        -webkit-transition: .4s;
        transition: .4s;
    }

        .slider:before {
            position: absolute;
            content: "";
            height: 15px;
            width: 15px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

    input:checked + .slider {
        background-color: #0bee2b;
    }

    input:focus + .slider {
        box-shadow: 0 0 1px #2196F3;
    }

    input:checked + .slider:before {
        -webkit-transform: translateX(15px);
        -ms-transform: translateX(15px);
        transform: translateX(15px);
    }

    /* Rounded sliders */
    .slider.round {
        border-radius: 34px;
    }

        .slider.round:before {
            border-radius: 50%;
        }
</style>
<body>
    @*<h4 id="MainHeading">Users</h4>
        <hr />*@
    <h4 id="MainHeading">Print Profile Config</h4>
    <hr />
    <div class="toastBox"></div>
    <div id="dvMainTable">
        @*<div class="col-xs-12 col-sm-12 col-md-3 col-lg-3"></div>*@
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <table class="table table-bordered" id="tblMasterData" width="100%">
                <thead>
                    <tr class="trclrforcolheader">
                        <th style="text-align:center;font-size: 12px;width:0%;">TransID</th>
                        <th style="text-align:center;font-size: 12px;width:0%;">ConfigID</th>
                        <th style="text-align:center;font-size: 12px;width:5%;">#</th>
                        <th style="text-align:center;font-size: 12px;width:35%;">Transaction Name</th>
                        <th style="text-align:center;font-size: 12px;width:15%;">Profile Name</th>
                        <th style="text-align:center;font-size: 12px;width:20%;">Set Default</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
                <tfoot>
                    <tr>
                        <th colspan="6" align="right">
                            <div style="padding-top:0px" align="right">
                                <button type="button" class="btn btn-danger" id="btnClear"><span class="glyphicon glyphicon-refresh"> Clear</span></button>
                                <button type="button" class="btn btn-success" id="btnSave"><span class="glyphicon glyphicon-saved"> Save</span></button>
                            </div>
                        </th>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
    
</body>
<script type="text/javascript">
    var Table = $('#tblMasterData').DataTable({pageLength: ItemsperPage,lengthMenu: [[10, 20, 50, 100, -1], [10, 20, 50, 100, "All"]],
        "bFilter": true,
        "bSearchable": true,
        "bInfo": true,
        "bPaginate": true,
        "ordering": false,
        scrollY: "400px",
        scrollX: true,
        scrollCollapse: true,
        "columnDefs": [{ "targets": [0, 1], "visible": false }, { "targets": [2,5], "class": "text-center" }, { "targets": [2], width: "2%" }
            , { "targets": [3], width: "10%" }, { "targets": [4], width: "12%" }, { "targets": [5], width: "2%" }],
    });
    
    var Aurl = '@Session["APIurl"]';
    var arrData = [];
    var UID = '@Session["LoginUserID"]';
    var RID = '@Session["RoleID"]';
    var nMode = 1;
    var FID = 1;// $("#txtFormID").val();
    InitiateData();
    function InitiateData() {
        Table.clear().draw(); Table.clear().draw();
        $.ajax({
            url: Aurl + "printprofileconfig/get",
            type: 'GET',
            datatype: 'json',
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                $.each(eval(data), function (i, items) {
                    var IsAct = items.DefaultConfig == 1 ? "checked" : "";
                    Table.row.add([
                        items.TransID,
                        items.ConfigID,
                        (i + 1),
                        '<label for="chkSF' + i + '">' + items.TransName + '</label>',
                        '<label for="chkSF' + i + '">' + items.ConfigName +'</label>',
                        '<input type="checkbox" class="chkdefault" name="SetDefault" id="chkSF' + i + '" ' + IsAct +'/>',
                    ]).draw(false);
                });
            }
        });
    }
    $('#tblMasterData tbody').on('click', '.chkdefault', function (r) {
        var id = r.target.id;
        var name = r.target.name;
        var vals = r.target.value;
        var ischk = $(this).is(":checked");                
        var currrowdata = Table.row($(this).parents('tr')).data();
        var TransID = currrowdata[0];
        var ConfigID = currrowdata[1];
        //showErrorSnackbar();
        $("#tblMasterData tbody tr").each(function () {
            rowdata = Table.row($(this)).data();
            if (TransID == rowdata[0]) {
                $(this).find("input").each(function (index) {
                    $(this).prop("checked", false);
                });
            }
        });
        $("#" + id).prop("checked", ischk);
    });    
    $('#btnClear').click(function (e) {
        if (ClearcfFocus != 3) { ClearConfirmDialogMsg("Do you want to clear?"); } else { ClearForm(); }
    });
    function ClearForm() {
        InitiateData();
    }
    $("#btnSave").click(function () {
        $(".clrdiv").html("");
        if (cfFocus != 3) {
            ConfirmDialogMsg("Do you want to save data?");
        } else {
            SaveData();
        }
    });
    function SaveData(Mode, DeviceID, UserID)
    {
        $("#btnSave").prop("disabled", true);
        var lstProfiles = [];
        $("#tblMasterData tbody tr").each(function () {
            rowdata = Table.row($(this)).data();
            var nTransID = rowdata[0];
            var nConfigID = rowdata[1];
            var ischk = false;
            $(this).find("input").each(function (index) {
                ischk = $(this).is(":checked") ? 1 : 0;
            });
            var prof = {
                "TransID": nTransID,
                "ConfigID": nConfigID,
                "DefaultConfig": ischk,
                "UserID": UID
            }
            lstProfiles.push(prof);
        });
        $.ajax({
            url: Aurl + "printprofileconfig/save",
            type: 'POST',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(lstProfiles),
            cache: false,
            processData: false,
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                $("#btnSave").prop("disabled", false);
                $.each(data, function (i, items) {
                    if (items.MsgID == 0) {
                        showSuccessSnackbar(items.Message);
                        ClearForm();
                    }
                    else {
                        $("#dvErrorName").html(items.Message);
                        showErrorSnackbar(items.Message);
                        //alert(items.Message);
                    }
                });
            }, error: function (data) {
                $("#btnSave").prop("disabled", false);
                if (data.status == "401") {
                    var msg = data.responseJSON.Message;
                    //showErrorSnackbar(msg + " Logout and Login again.");
                }
            }
        });
        InitiateData();
    }

</script>