
@{
    ViewBag.Title = "Print Profile Config";
}

<link href="~/Content/bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/navbar.css" rel="stylesheet" />
<link href="~/Content/dataTables.dataTables.2.2.2.css" rel="stylesheet" />
<link rel="stylesheet" href="~/Content/jquery-ui.css">

<script src="~/Scripts/bootstrap.min.js"></script>
<script src="~/Scripts/jquery-3.7.1.js"></script>
<script src="~/Scripts/jquery-ui.js"></script>
<script src="~/Scripts/Validation.js"></script>
<script src="~/Scripts/datatable.js"></script>
<script src="~/Scripts/dataTables.2.2.2.js"></script>
<script src="~/Scripts/js/refreshtoken.js"></script>
<style>
   
    td {
        font-size: 11px;
    }

    input[type=number] {
        text-align: right;
    }

        input[type=number]::placeholder {
            text-align: left;
        }
    /* Chrome, Safari, Edge, Opera */
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    /* Firefox */
    input[type=number] {
        -moz-appearance: textfield;
    }   
</style>
<body>
    @*<h4 id="MainHeading">Users</h4>
        <hr />*@
    <h4 id="MainHeading">Print Profile Config</h4>
    <hr />
    <div class="toastBox"></div>
    <div id="dvMainTable">
        @*<div class="col-xs-12 col-sm-12 col-md-3 col-lg-3"></div>*@
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <table class="table table-bordered" id="tblMasterData" width="100%">
                <thead>
                    <tr class="trclrforcolheader">
                        <th style="text-align:center;font-size: 12px;width:0%;">TransID</th>
                        <th style="text-align:center;font-size: 12px;width:0%;">ConfigID</th>
                        <th style="text-align:center;font-size: 12px;width:5%;">#</th>
                        <th style="text-align:center;font-size: 12px;width:35%;">Transaction Name</th>
                        <th style="text-align:center;font-size: 12px;width:15%;">Profile Name</th>
                        <th style="text-align:center;font-size: 12px;width:20%;">Set Default</th>
                        <th style="text-align:center;font-size: 12px;width:20%;">Auto Mail</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
                <tfoot>
                    <tr>
                        <th colspan="7" align="right">
                            <div style="padding-top:0px" align="right">
                                <button type="button" class="btn btn-danger" id="btnClear"><span class="glyphicon glyphicon-refresh"> Clear</span></button>
                                <button type="button" class="btn btn-success" id="btnSave"><span class="glyphicon glyphicon-saved"> Save</span></button>
                            </div>
                        </th>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
    
</body>
<script type="text/javascript">
    var Table = $('#tblMasterData').DataTable({pageLength: ItemsperPage,lengthMenu: [[10, 20, 50, 100, -1], [10, 20, 50, 100, "All"]],
        "bFilter": true,
        "bSearchable": true,
        "bInfo": true,
        "bPaginate": true,
        "ordering": false,
        scrollY: "400px",
        scrollX: true,
        scrollCollapse: true,
        "columnDefs": [{ "targets": [0, 1], "visible": false }, { "targets": [2,5,6], "class": "text-center" },],
    });
    
    var Aurl = '@Session["APIurl"]';
    var arrData = [];
    var UID = '@Session["LoginUserID"]';
    var RID = '@Session["RoleID"]';
    var nMode = 1;
    var FID = 1;// $("#txtFormID").val();
    InitiateData();
    function InitiateData() {
        Table.clear().draw(); Table.clear().draw();
        $.ajax({
            url: Aurl + "printprofileconfig/get",
            type: 'GET',
            datatype: 'json',
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                $.each(eval(data), function (i, items) {
                    var IsAct = items.DefaultConfig == 1 ? "checked" : "";
                    var IsAutoMail = items.AutoMail == 1 ? "checked" : "";
                    Table.row.add([
                        items.TransID,
                        items.ConfigID,
                        (i + 1),
                        '<label for="chkSF' + i + '">' + items.TransName + '</label>',
                        '<label for="chkSF' + i + '">' + items.ConfigName +'</label>',
                        '<input type="checkbox" class="chkdefault" name="SetDefault" id="chkSF' + i + '" ' + IsAct + '/>',
                        '<input type="checkbox" class="chkautomail" name="AutoMail" id="chkAM' + i + '" ' + IsAutoMail + '/>',
                    ]).draw(false);
                });
            }
        });
    }
    $('#tblMasterData tbody').on('click', '.chkdefault', function (r) {
        var id = r.target.id;
        var name = r.target.name;
        var vals = r.target.value;
        var ischk = $(this).is(":checked");                
        var currrowdata = Table.row($(this).parents('tr')).data();
        var TransID = currrowdata[0];
        var ConfigID = currrowdata[1];
        //showErrorSnackbar();
        $("#tblMasterData tbody tr").each(function () {
            rowdata = Table.row($(this)).data();
            if (TransID == rowdata[0]) {
                $(this).find("input").each(function (index) {
                    $(this).prop("checked", false);
                });
            }
        });
        $("#" + id).prop("checked", ischk);
    });    
    $('#btnClear').click(function (e) {
        if (ClearcfFocus != 3) { ClearConfirmDialogMsg("Do you want to clear?"); } else { ClearForm(); }
    });
    function ClearForm() {
        InitiateData();
    }
    $("#btnSave").click(function () {
        $(".clrdiv").html("");
        if (cfFocus != 3) {
            ConfirmDialogMsg("Do you want to save data?");
        } else {
            SaveData();
        }
    });
    function SaveData(Mode, DeviceID, UserID)
    {
        $("#btnSave").prop("disabled", true);
        var lstProfiles = [];
        $("#tblMasterData tbody tr").each(function () {
            rowdata = Table.row($(this)).data();
            var nTransID = rowdata[0];
            var nConfigID = rowdata[1];
            var ischk = false, IsAutomail = false;
            $(this).find("input").each(function (index) {
                let fieldName = $(this).attr("name");
                if (fieldName == "SetDefault")
                    ischk = $(this).is(":checked") ? 1 : 0;
                if (fieldName == "AutoMail")
                    IsAutomail = $(this).is(":checked") ? 1 : 0;
            });
            var prof = {
                "TransID": nTransID,
                "ConfigID": nConfigID,
                "DefaultConfig": ischk,
                "AutoMail": IsAutomail,
                "UserID": UID
            }
            lstProfiles.push(prof);
        });
        $.ajax({
            url: Aurl + "printprofileconfig/save",
            type: 'POST',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(lstProfiles),
            cache: false,
            processData: false,
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                $("#btnSave").prop("disabled", false);
                $.each(data, function (i, items) {
                    if (items.MsgID == 0) {
                        showSuccessSnackbar(items.Message);
                        ClearForm();
                    }
                    else {
                        $("#dvErrorName").html(items.Message);
                        showErrorSnackbar(items.Message);
                        //alert(items.Message);
                    }
                });
            }, error: function (data) {
                $("#btnSave").prop("disabled", false);
                if (data.status == "401") {
                    var msg = data.responseJSON.Message;
                    //showErrorSnackbar(msg + " Logout and Login again.");
                }
            }
        });
        InitiateData();
    }

</script>