@model ShineWeb.Models.SingleMasterModel
@{
    ViewBag.Title = ViewData["FormName"];
}
<link href="~/Content/chosen.min.css" rel="stylesheet" />
<link href="~/Content/bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/navbar.css" rel="stylesheet" />
<link href="~/Content/buttonTop.css" rel="stylesheet" />
<link href="~/Content/dataTables.dataTables.2.2.2.css" rel="stylesheet" />
<link rel="stylesheet" href="~/Content/jquery-ui.css">

<script src="~/Scripts/bootstrap.min.js"></script>
<script src="~/Scripts/jquery-1.10.2.min.js"></script>
<script src="~/Scripts/jquery-3.7.1.js"></script>
<script src="~/Scripts/jquery-ui.js"></script>
<script src="~/Scripts/js/refreshtoken.js"></script>
<script src="~/Scripts/chosen.jquery.min.js"></script>
<script src="~/Scripts/jquerychoose.min.js"></script>
<script src="~/Scripts/dataTables.2.2.2.js"></script>
<header>
    <link rel="stylesheet" href="~/Content/index.css">
</header>

<style>
    th, td {
        white-space: nowrap;
    }

    .toolbar, .dt-search {
        float: right;
    }

    .gdInput {
        width: 100%;
        height: 25px;
        border-width: 0 0 0.1px 0;
        border-color: #e0d6d6;
    }

    .trtext-line {
        border: none;
        border-bottom: 1px #000000;
    }

    div.dataTables_wrapper {
        width: 100%;
        margin: 0 auto;
    }

    td {
        font-size: 11px;
    }

    input[type=number] {
        text-align: right;
    }

        input[type=number]::placeholder {
            text-align: left;
        }
    /* Chrome, Safari, Edge, Opera */
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    /* Firefox */
    input[type=number] {
        -moz-appearance: textfield;
    }
    /* The Modal (background) */
    .modalBatch {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 10; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    /* Modal Content/Box */
    @@media only screen and (min-width: 600px) {
        .modalBatch-content {
            background-color: #ffffff;
            margin: 3% auto; /* 15% from the top and centered */
            padding: 10px;
            border: 1px solid #888;
            width: 75%; /* Could be more or less, depending on screen size */
            height: 70%;
            top: 5%;
            overflow: auto;
        }
    }

    @@media only screen and (max-width: 600px) {
        .modalBatch-content {
            background-color: #ffffff;
            margin: 10% auto; /* 15% from the top and centered */
            padding: 25px;
            border: 1px solid #888;
            width: 95%; /* Could be more or less, depending on screen size */
            height: 80%;
            top: 20%;
            overflow: auto;
        }
    }
    /* The Close Button */
    .closefg {
        color: #aaa;
        float: right;
        font-size: 10px;
        font-weight: bold;
    }

        .closefg:hover,
        .closefg:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

    .modalProdInfo {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 10; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    /* Modal Content/Box */
    @@media only screen and (min-width: 600px) {
        .modalProdInfo-content {
            background-color: #ffffff;
            margin: 3% auto; /* 15% from the top and centered */
            padding: 10px;
            border: 1px solid #888;
            width: 75%; /* Could be more or less, depending on screen size */
            height: 70%;
            top: 5%;
            overflow: auto;
        }
    }

    @@media only screen and (max-width: 600px) {
        .modalProdInfo-content {
            background-color: #ffffff;
            margin: 10% auto; /* 15% from the top and centered */
            padding: 25px;
            border: 1px solid #888;
            width: 95%; /* Could be more or less, depending on screen size */
            height: 80%;
            top: 20%;
            overflow: auto;
        }
    }
    /* The Close Button */
    .closePinfo {
        color: #aaa;
        float: right;
        font-size: 10px;
        font-weight: bold;
    }

        .closePinfo:hover,
        .closePinfo:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

    /* Style the tab */
    .tab {
        overflow: hidden;
        border: 1px solid #ccc;
        background-color: #f1f1f1;
    }

        /* Style the buttons inside the tab */
        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.5s;
            font-size: 17px;
        }

            /* Change background color of buttons on hover */
            .tab button:hover {
                background-color: #ddd;
            }

            /* Create an active/current tablink class */
            .tab button.active {
                background-color: #ccc;
            }

    /* Style the tab content */
    .tabcontent {
        display: none;
        /*padding: 6px 12px;*/
        border: none;
        border-top: none;
    }

    .form-label {
        position: relative;
        display: block;
        clear: both;
        max-width: 500px;
        margin: 0 auto;
    }

    .labelup {
        -webkit-transform: translateY(50%);
        -moz-transform: translateY(-50%);
        -ms-transform: translateY(-50%);
        -o-transform: translateY(-50%);
        transform: translateY(50%);
        -webkit-transition: all 0.2s ease-in-out;
        -moz-transition: all 0.2s ease-in-out;
        transition: all 0.2s ease-in-out;
        position: absolute;
        top: -40%;
        left: 1em;
        background: #fffefe;
        color: #2b2828;
        font-size: 1em;
        cursor: text;
        pointer-events: none;
        font-family: sans-serif;
    }

    .labelupfortextarea {
        -webkit-transform: translateY(50%);
        -moz-transform: translateY(-50%);
        -ms-transform: translateY(-50%);
        -o-transform: translateY(-50%);
        transform: translateY(50%);
        -webkit-transition: all 0.2s ease-in-out;
        -moz-transition: all 0.2s ease-in-out;
        transition: all 0.2s ease-in-out;
        position: absolute;
        top: -18%;
        left: 1em;
        background: #fffefe;
        color: #2b2828;
        font-size: 1em;
        cursor: text;
        pointer-events: none;
        font-family: sans-serif;
    }

    .footerAction {
        position: fixed;
        right: 0;
        bottom: 0;
        width: 85%;
        color: white;
        background-color: azure;
    }
    /*input:focus + .labelup,
    input:not(:placeholder-shown) + .labelup, textarea:focus + .labelup, textarea:not(:placeholder-shown) + .labelup {
        top: -35%;
        font-size: .9em;
        padding: 0 .3em;
        background: #F9F9F9;
        color: #000000;
    }*/
    .clsProd {
        position: fixed;
        right: 1%;
        bottom: 8%;
        width: 30%;
        height: 45%;
        color: black;
        background-color: #c2f6b5;
        z-index: 1000;
    }

    .each {
        border-bottom: 1px solid #555;
        padding: 3px 0;
    }

    .acItem .name {
        font-size: 14px;
        font-family: Arial, Helvetica, sans-serif;
    }

    .acItem .desc {
        font-size: 10px;
        font-family: Arial, Helvetica, sans-serif;
        color: #555;
    }

    .ui-autocomplete {
        max-height: 245px;
        overflow-y: auto;
        overflow-x: hidden;
    }
</style>
<body>
    <div class="row" style="margin-bottom:50px;">
        @Html.HiddenFor(model => model.FormName, new { @autocomplete = "off", @class = "form-control", @id = "txtFormName" })
        <h4 id="MainHeading">@ViewData["FormName"]</h4>
        <div class="toastBox"></div>
        <hr class="style14" />
        <div class="col-md-12" align="center">
            <div align="center">
                @*<h4>
                &nbsp;
                <b>Filter Type</b>
            </h4>*@
                <label class="radio-inline" style="font-size:15px;color:brown"><input type="radio" name="rdoFilter" id="rdoAssignedInvoice" checked /><b> <b>Assigned Invoices</b></b></label>
                <label class="radio-inline" style="font-size: 15px; color: brown"><input type="radio" name="rdoFilter" id="rdoCustomer" /> <b><b>Customer</b></b></label>
                @*<label class="radio-inline" style="font-size:15px"><input type="radio" name="rdoFilter" id="rdoUDNWise" /><b> <b>UDN</b></b></label>*@
            </div>
            <br />
            <table cellpadding="0" id="tblParam">
                <tbody>
                    @*<tr class="clstrdocudn" >
                    <td class="paddingtd" align="right" style="color:deepskyblue;">@Html.Label(" Doc ID or UDN :", new { @class = "clrWhite", @id = "lblDocorUDN" })&#x2003;</td>
                    <td colspan="2">
                        <div class="input-group">
                            <span class="input-group-addon"><span class="glyphicon glyphicon-file"></span></span>
                            <input type="text" id="txtDocNoUDN" class="form-control" placeholder="Enter Searching ID..." />
                        </div>
                        <div style="color:red;padding-top:5px;padding-left:5px;" id="divErrorOnDocUDN"></div>
                    </td>
                </tr>*@
                    <tr>
                        @Html.HiddenFor(model => model.TransType, new { @autocomplete = "off", @class = "form-control", @id = "txtTransType" })
                        @Html.HiddenFor(model => model.TransID, new { @autocomplete = "off", @class = "form-control", @id = "txtTransID" })
                        <td class="paddingtd" align="right" style="color:deepskyblue;">@Html.Label(" Beat :", new { @class = "clrWhite" })&#x2003;</td>
                        <td colspan="2">
                            <div class="input-group">
                                <span class="input-group-addon"><span class="glyphicon glyphicon-map-marker"></span></span>
                                <select class="form-control FormclrcmbField" id="cmbBeatName">
                                    <option value="0">Select</option>
                                </select>
                            </div>
                            <div style="color:red;padding-top:5px;padding-left:5px;" id="divErrorOnBeatName" class="clrdivs"></div>
                        </td>
                    </tr>
                    <tr>

                        <td class="paddingtd" align="right" style="color:deepskyblue;">@Html.Label(" SalesMan :", new { @class = "clrWhite" })&#x2003;</td>
                        <td colspan="2">
                            <div class="input-group">
                                <span class="input-group-addon"><span class="glyphicon glyphicon-user"></span></span>
                                <select class="form-control FormclrcmbField" id="cmbSalesManName">
                                    <option value="0">Select</option>
                                </select>
                            </div>
                            <div style="color:red;padding-top:5px;padding-left:5px;" id="divErrorOnSalesManName" class="clrdivs"></div>
                        </td>
                    </tr>
                    <tr>
                        <td class="paddingtd" align="right" style="color:deepskyblue;">@Html.Label("* Customer :", new { @class = "clrWhite" })&#x2003;</td>
                        <td colspan="2">
                            <input id="txtCustomerID" hidden />
                            <div class="input-group">
                                <span class="input-group-addon" id="Custinfo"><span class="glyphicon glyphicon-info-sign"></span></span>
                                <input type="text" class="form-control FormclrField" id="txtCustomerName" />
                            </div>
                            <div style="color:red;padding-top:5px;padding-left:5px;" id="divErrorOnCustName" class="clrdivs"></div>
                        </td>
                    </tr>
                    @*<tr>
                    <td></td>
                    <td colspan="1">
                        <div class="input-group">
                            <button class="form-control btn btn-warning AllowSHow" id="btnGetSurrCustomers" style="align-content:center"><span class="glyphicon glyphicon-map-marker"></span>&nbsp;Surrounding Customers</button>
                        </div>
                    </td>
                    <td id="tdlocpin">
                        <img id="imgLocGP" src="~/Images/locpin/greenlocipin.jpg" style="height:20px;width:20px" />
                        <img id="imgLocRP" src="~/Images/locpin/redlocipin.jpg" style="height:20px;width:20px" />
                    </td>
                </tr>*@
                    <tr>
                        <td class="paddingtd" align="right" style="color:deepskyblue;">@Html.Label("* Coll Amt :", new { @class = "clrWhite" })&#x2003;</td>
                        <td colspan="2">
                            <div class="input-group">
                                <span class="input-group-addon">&#x2009;<span class="fa fa-inr"></span>&#x2009;</span>
                                <input type="number" class="form-control FormclrField" id="txtCollAmt" placeholder="Enter Collected Amt..." />

                            </div>
                            <div style="color:red;padding-top:5px;padding-left:5px;" id="divErrorOnCollAmt" class="clrdivs"></div>
                        </td>
                    </tr>

                    <tr>
                        <td class="paddingtd" align="right" style="color:deepskyblue;">@Html.Label("* Pay Mode :", new { @class = "clrWhite" })&#x2003;</td>
                        <td colspan="2">
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-list"></i></span>
                                <select class="form-control FormclrcmbField" id="cmbPaymentMode"></select>
                            </div>
                            <div style="color:red;padding-top:5px;padding-left:5px;" id="divErrorOnPaymentMode" class="clrdivs"></div>
                        </td>
                    </tr>
                    <tr>
                        <td class="paddingtd" align="right" style="color:deepskyblue;">@Html.Label("* PM No :", new { @class = "clrWhite" })&#x2003;</td>
                        <td colspan="2">
                            <div class="input-group">
                                <span class="input-group-addon"><span class="glyphicon glyphicon-edit"></span></span>
                                <input type="number" class="form-control FormclrField" id="txtChequeNo" placeholder="Cheque or NEFT" maxlength="6" oninput="javascript: if (this.value.length > this.maxLength) { this.value = this.value.slice(0, this.maxLength); }" />
                            </div>
                            <div style="color:red;padding-top:5px;padding-left:5px;" id="divErrorOnChequeNo" class="clrdivs"></div>
                        </td>
                    </tr>

                    <tr>
                        <td class="paddingtd" align="right" style="color:deepskyblue;">@Html.Label("* PM Date :", new { @class = "clrWhite" })&#x2003;</td>
                        <td colspan="2">
                            <div class="input-group">
                                <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
                                <input type="date" class="form-control FormclrField" id="dtpChequeDate" placeholder="Cheque or NEFT Date" />
                            </div>
                            <div style="color:red;padding-top:5px;padding-left:5px;" id="divErrorOnChequeDate" class="clrdivs"></div>
                        </td>
                    </tr>
                    <tr>
                        <td class="paddingtd" align="right" style="color:deepskyblue;">@Html.Label("* Bank A/c No:", new { @class = "clrWhite" })&#x2003;</td>
                        <td colspan="2">
                            <div class="input-group">
                                <span class="input-group-addon"><span class="glyphicon glyphicon-edit"></span></span>
                                <select class="form-control FormclrcmbField" id="cmbBankACNo"></select>
                            </div>
                            <div style="color:red;padding-top:5px;padding-left:5px;" id="divErrorOnBankACNo" class="clrdivs"></div>
                        </td>

                    </tr>
                    <tr>
                        <td class="paddingtd" align="right" style="color:deepskyblue;">@Html.Label("* Bank Name :", new { @class = "clrwhite" })&#x2003;</td>
                        <td colspan="2">
                            <div class="input-group">
                                <span class="input-group-addon"><span class="glyphicon glyphicon-home"></span></span>
                                <select class="form-control FormclrcmbField" id="cmbBankName"></select>
                            </div>
                            <div style="color:red;padding-top:5px;padding-left:5px;" id="divErrorOnBankName" class="clrdivs"></div>
                        </td>
                    </tr>
                    <tr>
                        <td class="paddingtd" align="right" style="color:deepskyblue;">@Html.Label("IFSC Code :", new { @class = "clrwhite" })&#x2003;</td>
                        <td colspan="2">
                            <div class="input-group">
                                <span class="input-group-addon"><span class="glyphicon glyphicon-edit"></span></span>
                                <input type="text" class="form-control FormclrField" id="txtifsc" placeholder="Enter IFSC Code" style="text-transform: uppercase;" maxlength="11" />
                            </div>
                            <div style="color:red;padding-top:5px;padding-left:5px;" id="divErrorOnIfsc" class="clrdivs"></div>
                        </td>
                    </tr>
                    <tr>
                        <td class="paddingtd" align="right" style="color:deepskyblue;">@Html.Label("Adv / OS :", new { @class = "clrWhite" })&#x2003;</td>
                        <td colspan="2" style="font-weight:bold;font-size:inherit;">@Html.Label("0", new { @class = "clrWhite", @id = "lblCustAdvAmt" })</td>
                    </tr>
                    <tr>
                        <td class="paddingtd" align="right" style="color: deepskyblue;" hidden="hidden">@Html.Label("Latitude :", new { @class = "clrWhite" })&#x2003;</td>
                        <td colspan="2" hidden="hidden">
                            <div class="input-group">
                                <span class="input-group-addon"><span class="glyphicon glyphicon-map-marker"></span></span>
                                <input type="number" class="form-control FormclrField" id="txtLatitude" />
                            </div>
                            <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrorOnCusLatitude" class="clrdivs"></div>
                        </td>
                    </tr>
                    <tr>
                        <td class="paddingtd" align="right" style="color: deepskyblue;" hidden="hidden">@Html.Label("Longtitude :", new { @class = "clrWhite" })&#x2003;</td>
                        <td colspan="2" hidden="hidden">
                            <div class="input-group">
                                <span class="input-group-addon"><span class="glyphicon glyphicon-map-marker"></span></span>
                                <input type="number" class="form-control FormclrField" id="txtLongtitude" />
                            </div>
                            <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrorOnCusLongtitude" class="clrdivs"></div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <hr class="style14" />
            <div class="col-md-12" align="center">
                <table align="center">
                    <tbody>
                        <tr>
                            <td>
                                <button id="btnClear" type="button" class="btn btn-danger"><span class="glyphicon glyphicon-refresh" style="color:white"></span>&#x2009;Clear</button>
                            </td>
                            <td>
                                <button id="btnSave" type="button" class="btn btn-success"><span class="glyphicon glyphicon-save" style="color:white"></span>&#x2009;Save</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <hr class="style14" />
            <span style="text-align:center;font-weight:bold;color:deepskyblue" id="divBalanceTop"></span>
            <table align="center" id="tblAdjDocInfo" class="table table-hover table-bordered" cellspacing="0" width="100%">
                <thead>
                    <tr>
                        <th style="background-color:deepskyblue;color:white;text-align:center;font-size:12px;width:0%;">ID</th>
                        <th style="background-color:deepskyblue;color:white;text-align:center;font-size:12px;width:0%;">Docprefix</th>
                        <th style="background-color:deepskyblue;color:white;text-align:center;font-size:12px;width:0%;">AssignID</th>
                        <th style="background-color:deepskyblue;color:white;text-align:center;font-size:12px;width:2%;">#</th>
                        <th style="background-color:deepskyblue;color:white;text-align:center;font-size:12px;width:83%;">Info</th>
                        <th style="background-color:deepskyblue;color:white;text-align:center;font-size:12px;width:5%;">Bal</th>
                        <th style="background-color:deepskyblue;color:white;text-align:center;font-size:12px;width:5%;">Amt Adj</th>
                        <th style="background-color:deepskyblue;color:white;text-align:center;font-size:12px;width:5%;">Otr Chgr</th>
                    </tr>
                </thead>                
            </table>
            <span style="text-align:center;font-weight:bold;color:deepskyblue" id="divBalanceBottom"></span>
        </div>
        <!-- The Modal -->
        <div id="myModalCust" class="modalCust">
            <!-- Modal content -->
            <div class="modalCust-content">
                <span class="closeCust">&times;</span>
                <label style="color:brown"> These Customers are Surrounding you.</label>
                Current Location :<label id="lblCurrLocation"> </label>
                <hr />
                <div>
                    <div style="color:red;padding-top:5px;padding-left:5px;text-align:center" id="divErrorOnPopupSurrCust"></div>
                    <table align="center" id="tblCustomers" class="table table-hover table-bordered" width="100%">
                        <thead>
                            <tr>
                                <th style="background-color: deepskyblue;color:white;text-align:center;font-size: 12px;width:90%">Customer Name</th>
                                <th style="background-color: deepskyblue;color:white;text-align:center;font-size: 12px;width:10%">Distance</th>
                            </tr>
                        </thead>
                    </table>
                </div>
                <hr />
                <div align="right">
                    @*<button id="btnExport2" type="button" class="btn btn-info" style="height:30px; width:100px" hidden><span class="glyphicon glyphicon-export" style="color: white"></span>&#x2009;Export</button>*@
                    <button id="btnClsModel" type="button" class="btn btn-danger" style="height:30px; width:80px"> Close </button>
                </div>
            </div>

        </div>
        <a href="javascript:" id="return-to-top"><i class="icon-chevron-up"></i></a>
    </div>
</body>
<script type="text/javascript">
        var UID = '@Session["LoginUserID"]';
var Aurl = '@Session["APIurl"]';
var DefBranch = '@Session["DefaultBranch"]';
    var DecVal = '@Session["DecimalValues"]';
    var rdoCheckedID = 1;
   var modal = document.getElementById("myModalCust");
   var span = document.getElementsByClassName("closeCust")[0];
   span.onclick = function () {
       modal.style.display = "none";
   }
   $('#btnClsModel').click(function () {
       modal.style.display = "none";
   });
    modal.style.display = "none";
    var Table = $('#tblAdjDocInfo').DataTable({
        "bFilter": false,
        "bLengthChange": false,
        "bInfo": false,
        "bPaginate": false,
        "ordering": false,
        scrollY: "500px",
        scrollX: true,
        scrollCollapse: true,
        "columnDefs": [{ "targets": [0, 1,2], "visible": false, searchable: false, ordering: false }]
    });
    var CustTable = $('#tblCustomers').DataTable({
        "bFilter": true,
        "bSearchable": true,
        "bInfo": true,
        "bPaginate": true,
        "ordering": false,
        //"selected":true,
    });
    $(window).scroll(function () {
        if ($(this).scrollTop() >= 200) {        // If page is scrolled more than 50px
            $('#return-to-top').fadeIn(200);    // Fade in the arrow
        } else {
            $('#return-to-top').fadeOut(200);   // Else fade out the arrow
        }
    });
    $('#return-to-top').click(function () {      // When arrow is clicked
        $('body,html').animate({
            scrollTop: 0                       // Scroll to top of body
        }, 500);
    });
    $("#txtChequeNo,#cmbBankACNo,#cmbBankName,#txtifsc,#dtpChequeDate").prop("disabled", true);
    $('#divBalanceTop').html('Col Amt : 0  ;  Bal : 0');
    $('#divBalanceBottom').html('Col Amt : 0  ;  Bal : 0');
    GetData(1, UID);
    var arrParty = [],arrBankAccountData = [];
    function GetData(nMode, strID = null, strSalesmanID = null) {
        $.ajax({
            url: Aurl + "mobilecollection/getdata",
            type: 'get',
            contentType: 'json',
            data: {
                Mode: nMode, ID: strID, SalesmanID: strSalesmanID, FilterType: rdoCheckedID
            },
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                if (nMode == 1) {
                    arrBankAccountData = [];
                    //cmbPaymentMode,cmbBankACNo,cmbBankName
                    $('#cmbBeatName,#cmbSalesManName,#cmbPaymentMode,#cmbBankACNo,#cmbBankName').find("option").remove();
                    $('#cmbBeatName,#cmbSalesManName,#cmbPaymentMode,#cmbBankACNo,#cmbBankName').append($('<option/>', {
                        value: 0,
                        text: "-- Select --",
                    }));
                    $.each(data, function (i, items) {
                        if (items.FType == 1) {
                            $('#cmbSalesManName').append($('<option/>', {
                                value: items.ID,
                                text: items.Name,
                            }));
                        }
                        if (items.FType == 2) {
                            $('#cmbBeatName').append($('<option/>', {
                                value: items.ID,
                                text: items.Name,
                            }));
                        }
                        if (items.FType == 3) {
                            $('#cmbPaymentMode').append($('<option/>', {
                                value: items.ID,
                                text: items.Name,
                            }));
                        }
                        if (items.FType == 4) {
                            var BADetails = (items.Code).split('|');
                            var BAInfo = {
                                "ID": items.ID,
                                "AccNo": items.Name,
                                "BankID": BADetails[1],
                                "IFSC": BADetails[2],
                                "DefYN": BADetails[0],
                            }
                            if (BADetails[0] == "1") {
                                DefBankAcc = items.ID;
                            }
                            arrBankAccountData.push(BAInfo);
                            $('#cmbBankACNo').append($('<option/>', {
                                value: items.ID,
                                text: items.Name,
                            }));
                        }
                        if (items.FType == 5) {
                            $('#cmbBankName').append($('<option/>', {
                                value: items.ID,
                                text: items.Name,
                            }));
                        }
                        if (items.FType == 6) {
                            //console.log("Beat : " + items.Code + " ,Salesman : " + items.Name);
                            $('#cmbSalesManName').val(items.Name);
                            $('#cmbBeatName').val(items.Code);
 
                        }
                    });
                    setTimeout(() => {
                        GetData(2, $('#cmbBeatName').val(), $('#cmbSalesManName').val());
                    }, 500);
                }
                else if (nMode == 2) {
                    arrParty = [];
                    $.each(data, function (i, items) {
                        if (items.FType == 7) {
                            var Prod = {
                                "label": items.Code + " | " + items.Name,
                                "name": items.Name,
                                "code": items.Code,
                                "id": items.ID,
                            }
                            arrParty.push(Prod);
                        }
                    });
                    SetAutlistforFields("txtCustomerName", arrParty);
                }
                else if (nMode == 4) {
                    var custjsdata = data;// JSON.parse(data);
                    $('#tblAdjDocInfo').DataTable({
                        scrollY: "500px",
                        scrollX: true,
                        scrollCollapse: true,
                        paging: false,
                        destroy: true,
                        data: custjsdata,
                        fixedColumns: false,
                        ordering: true,
                        searching: true,
                        sorting: true,
                        columns: [
                            { "data": "ID", "autoWidth": true, "visible": false, className: "dt-body-left" },
                            { "data": "Docprefix", "autoWidth": true, "visible": false, className: "dt-body-left" },
                            { "data": "AssignInvoiceID", "autoWidth": true, "visible": false, className: "dt-body-left" },
                            {
                                className: "dt-body-center",
                                "mRender": function (data, type, value, meta) {
                                    var rowIndex = (meta.row + 1);
                                    var _action = rowIndex;
                                    return _action;
                                },
                            },
                            {
                                className: "dt-body-left",
                                "mRender": function (data, type, value, meta) {
                                    var _action = 'Doc ID : <b >' + value.Docid + '</b><br/>Doc Date : ' + value.Docdate + '<br/>Ref No : ' + value.Refno + '<br/>Net Amount : ' + value.NetAmt;
                                    var lblData = '<label>' + _action +'</label>';
                                    return _action;
                                },
                            },
                            {
                                className: "dt-body-right",
                                "mRender": function (data, type, value, meta) {
                                    var rowIndex = meta.row;
                                    var fids = 'dgvInvBalance_' + rowIndex;
                                    var lblData = '<label name="Balance">' + value.Balance + '</label>';
                                    return lblData;
                                },
                            },
                            {
                                className: "dt-body-right",
                                "mRender": function (data, type, value, meta) {
                                    var rowIndex = meta.row;
                                    var fids = 'dgvInvAdjAmt_' + rowIndex;
                                    var _action = '<input type="number" class="dgvAdjAmount" name="AdjAmount" id="' + fids + '" value="0" style="text-align:right;width:55px;"maxlength = "16"/>';
                                    return _action;
                                },
                            },
                            {
                                className: "dt-body-right",
                                "mRender": function (data, type, value, meta) {
                                    var rowIndex = meta.row;
                                    var fids = 'dgvInvOtherCharge_' + rowIndex;
                                    var _action = '<input type="number" class="dgvOtherCharge" name="OtherCharge" id="' + fids + '" value="0" style="text-align:right;width:55px;"maxlength = "16"/>';
                                    return _action;
                                },
                            },
                        ],
                    });
                    Table = $('#tblAdjDocInfo').DataTable();
                    if (Table.rows().count() == 0) {
                        showErrorSnackbar("No records found")
                    }
                }
            }, error: function (data) {
                if (data.status == "401") {
                    var msg = data.responseJSON.Message;
                    ////showErrorSnackbar(msg + " Logout and Login again.");
                }
            }
        });
    }
    $('#cmbBankACNo').on('change', function (e) {
        if ($('#cmbBankACNo').val() > 0) {
            var md = arrBankAccountData.filter(t => t.ID == $('#cmbBankACNo').val());
            $("#txtifsc").val(md[0].IFSC);
            $("#cmbBankName").val(md[0].BankID);
        } else {
            $("#txtifsc").val('');
            $("#cmbBankName").val(0);
        }
    });
    $('#cmbBeatName,#cmbSalesManName').change(function () {
        $(".clrdivs").html("");
        $("txtCustomerName").val();
        GetData(2, $('#cmbBeatName').val(), $('#cmbSalesManName').val());
    });
    function SetAutlistforFields(FieldID, arryvalue) {
        if (arryvalue.length == 0) {
            showErrorSnackbar("No customer found");
        }
        $("#" + FieldID).autocomplete({
            minLength: 0,
            source: arryvalue,
            select: function (event, ui) {
                $("#" + FieldID).val(ui.item.name);
                if (FieldID == "txtCustomerName") {
                    //customer info function
                    $("#txtCustomerID").val(ui.item.id);
                    GetData(4, ui.item.id, $('#cmbSalesManName').val())
                }
                return false;
            },
        }).autocomplete("instance")._renderItem = function (ul, item) {
            return $("<li class='each'>")
                .append("<div class='acItem'><span class='name'>" +
                    item.label + "</span></div>")
                .appendTo(ul);
        };
    }

    $('#cmbPaymentMode').change(function () {
        $("#txtChequeNo,#cmbBankName,#txtifsc,#cmbBankACNo,#dtpChequeDate").prop("disabled", true);
        $("#txtChequeNo,#txtifsc,#dtpChequeDate").val('');
        $("#cmbBankName,#cmbBankACNo").val(0);
        var paymode = $('#cmbPaymentMode').val();
        if (paymode == 1) {
            $("#txtChequeNo,#cmbBankName,#txtifsc,#cmbBankACNo,#dtpChequeDate").prop("disabled", true);
            $("#txtChequeNo,#txtifsc,#dtpChequeDate").val('');
            $("#cmbBankName,#cmbBankACNo").val(0);
        }
        else if (paymode == 2) {//CHEQUE
            //GetAutolistBankNames("CHEQUE_BOOK_BNK");
            $("#txtChequeNo,#dtpChequeDate,#cmbBankName,#txtifsc,#cmbBankACNo").prop("disabled", false);
            $('#cmbBankACNo').prop("disabled", true);
            //$('#cmbBankName').prop("disabled", true);
            $("#txtChequeNo,#txtifsc,#dtpChequeDate").val('');
            $("#cmbBankName,#cmbBankACNo").val(0);
        }
        else if (paymode == 4) {
            //GetAutolistBankNames("CHEQUE_BOOK_BNK");
            $('#cmbBankACNo,#txtChequeNo').prop("disabled", false);
            $("#txtChequeNo,#txtifsc,#dtpChequeDate").val('');
            $("#cmbBankName,#cmbBankACNo").val(0);
        }
    });
    
    //rdoAssignedInvoice,rdoCustomer
    $('#rdoCustomer').click(function () {
        rdoCheckedID = 2;
        GetData(2, $('#cmbBeatName').val(), $('#cmbSalesManName').val());
        //clearCollection(true);
    });
    $('#rdoAssignedInvoice').click(function () {
        rdoCheckedID = 1;
        //clearCollection(true);
        GetData(2, 0, $('#cmbSalesManName').val());
    });
    $(document).on("change", ".dgvAdjAmount,.dgvOtherCharge", function (e) {
        CalculateBalanceAmt();
    });
    function CalculateBalanceAmt() {
        var isGO = false;
        var totcollAmt = parseFloat($('#txtCollAmt').val());
        var eachAdjAmt = 0, balanceAmt = 0, otherChrg = 0;
        $('#tblAdjDocInfo tr td input').each(function (i, items) {
            if (i % 2 == 0) {
                if (items.value > 0) {
                    isGO = true;
                    eachAdjAmt = parseFloat(eachAdjAmt) + parseFloat(items.value);
                }
            }
            else {
                if (isGO) {
                    otherChrg = parseFloat(otherChrg) + (parseFloat(items.value) > 0 ? parseFloat(items.value) : 0);
                }
            }
        });
        balanceAmt = parseFloat(totcollAmt) - (parseFloat(eachAdjAmt) + parseFloat(otherChrg));
        $('#divBalanceTop').html('Coll Amt : ' + totcollAmt.toString() + '  ;  Bal : ' + balanceAmt.toString());
        $('#divBalanceBottom').html('Coll Amt : ' + totcollAmt.toString() + '  ;  Bal : ' + balanceAmt.toString());
    }
    function adjamtValidation() {
        var isValid = false;
        var isNoRowAffected = false;
        $('#divErrorMessage').html('');
        var rowIndex = 1;
        var adjamt = 0, balance = 0;
        $('#tblAdjDocInfo tr td input').each(function (i, items) {
            if (i % 2 == 0) {
                if (items.value > 0) {
                    isValid = true;
                    isNoRowAffected = true;
                    adjamt = parseFloat(items.value);
                    balance = parseFloat(items.name);
                }
            }
            else {
                var OtherCharg = parseFloat(items.value);
                adjamt = adjamt + (OtherCharg < 0 ? (OtherCharg * -1) : 0)
                if (adjamt > balance) {
                    showErrorSnackbar('Error in Row ' + rowIndex.toString() + ' - Adj amt should be (<=) bal amt');
                    isValid = false;
                    return isValid;
                }
                rowIndex++;
            }
        });
        if (!isNoRowAffected) showErrorSnackbar('Atleast one row need to adj');
        return isValid;
    }
    function SaveValidation() {
        var IsValid = true;
        $(".clrdivs").html("");
        if ($('#txtCustomerName').val() == '') {
            IsValid = false;
            $('#divErrorOnCustName').html('* Customer Name should not be empty');
            $('#txtCustomerName').focus();
            showErrorSnackbar("Customer Name should not be empty");
        }
        else {
            const exists = arrParty.filter(c => c.name == $("#txtCustomerName").val().trim());
            if (exists.length == 0) {
                IsValid = false;
                $("#divErrorOnCustName").html("Select Party Name from list");
                showErrorSnackbar("Select Party Name from list");
            }
        }
        if ($('#txtCollAmt').val() == "" || $('#txtCollAmt').val() <= 0) {
            IsValid = false;
            $("#divErrorOnCollAmt").html("Enter valid Collected value");
            showErrorSnackbar("Enter valid Collected value");
        }
        
        if ($('#cmbPaymentMode').val() == 0) {
            IsValid = false;
            $('#divErrorOnPaymentMode').html('* Select Payment Mode');
            $('#cmbPaymentMode').focus();
        }
        else {
            var PMID = $('#cmbPaymentMode').val();
            // $("#txtChequeNo,#cmbBankName,#txtifsc,#cmbBankACNo,#dtpChequeDate").prop("disabled", true);
            if (PMID == 2) {
                if ($('#txtChequeNo').val() == '') {
                    IsValid = false;
                    $('#divErrorOnChequeNo').html('* Cheque No Should not be empty');
                    showErrorSnackbar("Cheque No Should not be empty");
                    $('#txtChequeNo').focus();
                }
                else {
                    if ($('#txtChequeNo').val().length != 6) {
                        IsValid = false;
                        $('#divErrorOnChequeNo').html('* Cheque No Should not be 6 digits');
                        showErrorSnackbar("Cheque No Should not be 6 digits");
                        $('#txtChequeNo').focus();
                    }
                }
                if ($('#dtpChequeDate').val() == '') {
                    IsValid = false;
                    $('#divErrorOnChequeDate').html('* Cheque Date Should not be empty');
                    showErrorSnackbar("Cheque Date Should not be empty");
                    $('#dtpChequeDate').focus();
                }
                if ($('#txtifsc').val() != '') {
                    divErrorOnIfsc
                    var val = IFSCValidation($('#txtifsc'), $('#divErrorOnIfsc'));
                    if (!val)
                        IsValid = false;                    
                }
            }
            else if (PMID == 4) {
                if ($('#cmbBankACNo').val() == 0) {
                    IsValid = false;
                    $('#divErrorOnCustName').html('* Select Bank A/c No');
                    showErrorSnackbar("Select Bank A/c No");
                    $('#cmbBankACNo').focus();
                }
            }
        }        
        return IsValid;
    }   
    function SaveData() {
        $("#btnSave").prop("disabled", true);
        var arrAmtAdjDocs = [];
        var totamt = 0;
        var collAmt = parseFloat($('#txtCollAmt').val());
        $('#tblAdjDocInfo tbody tr').each(function (i, items) {
            var rowdata = Table.row($(this)).data();
            var RowIndex = Table.row($(this)).index();
            var GridID = rowdata.ID;//[0];
            var GridDocprefix = rowdata.Docprefix;//[1];
            var GridDocID = rowdata.Docid;//[1];
            var GridDocDate = rowdata.Docdate;//[2];
            var GridRefNo = rowdata.Refno;
            var GridNetAmt = rowdata.NetAmt;
            var AssignID = rowdata.AssignInvoiceID
            var Adjamt = 0, Otherchrg = 0, Balance = 0;
            $(this).find("input").each(function (index) {
                const fieldName = $(this).attr("name");
                const fieldID = $(this).attr("id");
                if (fieldName == "AdjAmount") {
                    Adjamt = $(this).val();
                }
                if (fieldName == "OtherCharge") {
                    Otherchrg = $(this).val();
                }
            });
            $(this).find("label").each(function (index) {
                const fieldName = $(this).attr("name");
                const fieldID = $(this).attr("id");
                if (fieldName == "Balance") {
                    Balance = $(this).text();
                }
            });
            if (Adjamt > 0) {
                totamt = parseFloat(totamt) + parseFloat(Adjamt) + (parseFloat(Otherchrg) < 0 ? 0 : parseFloat(Otherchrg));
                var docs = {
                    "ID": GridID,
                    "Docprefix": GridDocprefix,
                    "Docid": GridDocID,
                    "Docdate": GridDocDate,
                    "Refno": GridRefNo,
                    "NetAmt": GridNetAmt,
                    "Balance": Balance,
                    "Amtadj": Adjamt,
                    "Ohtercharges": Otherchrg,
                    "AssignInvoiceID": AssignID
                }
                arrAmtAdjDocs.push(docs)
            }
        });
        if (collAmt >= totamt) {
            var advamt = parseFloat(collAmt) - parseFloat(totamt);
            lstTrans = {
                BeatID: $('#cmbBeatName').val(),
                SalesManID: $('#cmbSalesManName').val(),
                CustomerID: $('#txtCustomerID').val(),
                lstadjdocs: arrAmtAdjDocs,
                "Flags": 1,
                "UserID": UID,
                "collectedamt": $('#txtCollAmt').val(),
                "PaymentmodeID": $('#cmbPaymentMode').val(),
                "Chequedate": $('#dtpChequeDate').val(),
                "Chequeno": $('#txtChequeNo').val(),
                "BankID": $('#cmbBankName').val(),
                "Bankname": $('#cmbBankName option:selected').text(),
                "ifsc": $('#txtifsc').val(),
                "AdvAmt": advamt,
                "BankACno": $('#cmbBankACNo').val(),
                "BankACID": $('#cmbBankACNo option:selected').text(),
                "CusLatitude": $('#txtLatitude').val(),
                "CusLongtitude": $('#txtLongtitude').val(),
                "TransType": 1,// $('#txtTransType').val(),
                "TransID": 0,//$('#txtTransID').val()         
            };
            $.ajax({
                url: Aurl + "mobilecollection/save",
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(lstTrans),
                cache: false,
                processData: false,
                xhrFields: {
                    withCredentials: true
                },
                success: function (data) {
                    $("#btnSave").prop("disabled", false);
                    $.each(data, function (i, items) {
                        if (items.MsgID == 0) {
                            //alert(items.Message);
                            showSuccessSnackbar(items.Message);
                            ClearForm();
                        }
                        else {
                            //$("#dvErrorName").html(items.Message);
                            //alert(items.Message);
                            showErrorSnackbar(items.Message);
                        }
                    });
                }
            });
        }
        else {
            arrAmtAdjDocs = [];
            showErrorSnackbar('Adj amt should be less than or equal to coll amt');
        }
    }
    $("#btnClear").click(function () {
        //ClearForm();
        if (cfFocus != 3) { ClearConfirmDialogMsg("Do you want to clear?"); } else { ClearForm(); }
    });
    $("#btnSave").click(function () {
        if (cfFocus != 3) {
            if (SaveValidation() && adjamtValidation()) {
                ConfirmDialogMsg("Do you want to save data?");
            }
        } else {
            if (SaveValidation() && adjamtValidation()) {
                SaveData();
            }
        }
    });  
    function ClearForm() {
        $(".FormclrField").val("");
        $(".FormclrcmbField").val(0);
        $(".clrdivs").html("");
        GetData(1, UID);
        Table.clear().draw();
        arrAmtAdjDocs = [];
        $('#divBalanceTop').html('Col Amt : 0  ;  Bal : 0');
        $('#divBalanceBottom').html('Col Amt : 0  ;  Bal : 0');
        Table.search('').columns().search('').draw();
        $('.chosen-Manuf').val('').trigger('chosen:updated');
        $('.chosen-Category').val('').trigger('chosen:updated');
    }
</script>