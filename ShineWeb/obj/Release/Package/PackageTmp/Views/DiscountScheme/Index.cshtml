@model ShineWeb.Models.SingleMasterModel
@{
    ViewBag.Title = ViewData["FormName"];
}
<link href="~/Content/bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/dataTables.bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/navbar.css" rel="stylesheet" />
<link href="~/Content/buttonTop.css" rel="stylesheet" />
<link href="~/Content/dataTables.dataTables.2.2.2.css" rel="stylesheet" />
@*<link rel="stylesheet" href="~/Content/jquery-ui.css">*@

<script src="~/Scripts/bootstrap.min.js"></script>
<script src="~/Scripts/jquery-1.10.2.min.js"></script>
<script src="~/Scripts/jquery-3.7.1.js"></script>
<script src="~/Scripts/jquery-ui.js"></script>
<script src="~/Scripts/datatable.js"></script>
<script src="~/Scripts/dataTables.2.2.2.js"></script>
<script src="~/Scripts/js/refreshtoken.js"></script>
<header>
    <link rel="stylesheet" href="~/Content/index.css">
</header>
<style>
    .gdInput {
        width: 100%;
        height: 25px;
        border-width: 0 0 0.1px 0;
        border-color: #e0d6d6;
    }
/*
    .each {
        border-bottom: 1px solid #555;
        padding: 3px 0;
    }

    .acItem .name {
        font-size: 14px;
        font-family: Arial, Helvetica, sans-serif;
    }

    .acItem .desc {
        font-size: 10px;
        font-family: Arial, Helvetica, sans-serif;
        color: #555;
    }

    .ui-autocomplete {
        max-height: 245px;
        overflow-y: auto;
        overflow-x: hidden;
    }*/

    th, td {
        white-space: nowrap;
    }

    .trtext-line {
        border: none;
        border-bottom: 1px #000000;
    }

    div.dataTables_wrapper {
        width: 100%;
        margin: 0 auto;
    }

    td {
        font-size: 11px;
    }

    input[type=number] {
        text-align: right;
    }

        input[type=number]::placeholder {
            text-align: left;
        }
    /* Chrome, Safari, Edge, Opera */
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    /* Firefox */
    input[type=number] {
        -moz-appearance: textfield;
    }

    /* Style the tab */
    .tab {
        overflow: hidden;
        border: 1px solid #ccc;
        background-color: #f1f1f1;
    }

        /* Style the buttons inside the tab */
        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.5s;
            font-size: 17px;
        }

            /* Change background color of buttons on hover */
            .tab button:hover {
                background-color: #ddd;
            }

            /* Create an active/current tablink class */
            .tab button.active {
                background-color: #ccc;
            }

    /* Style the tab content */
    .tabcontent {
        display: none;
        /*padding: 6px 12px;*/
        border: none;
        border-top: none;
    }

    .form-label {
        position: relative;
        display: block;
        clear: both;
        max-width: 500px;
        margin: 0 auto;
    }

    .labelup {
        -webkit-transform: translateY(50%);
        -moz-transform: translateY(-50%);
        -ms-transform: translateY(-50%);
        -o-transform: translateY(-50%);
        transform: translateY(50%);
        -webkit-transition: all 0.2s ease-in-out;
        -moz-transition: all 0.2s ease-in-out;
        transition: all 0.2s ease-in-out;
        position: absolute;
        top: -40%;
        left: 1em;
        background: #fffefe;
        color: #2b2828;
        font-size: 1em;
        cursor: text;
        pointer-events: none;
        font-family: sans-serif;
    }

    .labelupfortextarea {
        -webkit-transform: translateY(50%);
        -moz-transform: translateY(-50%);
        -ms-transform: translateY(-50%);
        -o-transform: translateY(-50%);
        transform: translateY(50%);
        -webkit-transition: all 0.2s ease-in-out;
        -moz-transition: all 0.2s ease-in-out;
        transition: all 0.2s ease-in-out;
        position: absolute;
        top: -18%;
        left: 1em;
        background: #fffefe;
        color: #2b2828;
        font-size: 1em;
        cursor: text;
        pointer-events: none;
        font-family: sans-serif;
    }

    .footerAction {
        position: fixed;
        right: 0;
        bottom: 0;
        width: 85%;
        color: white;
        background-color: azure;
    }
    /*input:focus + .labelup,
    input:not(:placeholder-shown) + .labelup, textarea:focus + .labelup, textarea:not(:placeholder-shown) + .labelup {
        top: -35%;
        font-size: .9em;
        padding: 0 .3em;
        background: #F9F9F9;
        color: #000000;
    }*/
    .clsProd {
        position: fixed;
        right: 1%;
        bottom: 8%;
        width: 30%;
        height: 45%;
        color: black;
        background-color: #c2f6b5;
        z-index: 1000;
    }

    .switch {
        position: relative;
        display: inline-block;
        width: 35px;
        height: 18px;
    }

        .switch input {
            opacity: 0;
            width: 0;
            height: 10px;
        }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #fb7708;
        -webkit-transition: .4s;
        transition: .4s;
    }

        .slider:before {
            position: absolute;
            content: "";
            height: 15px;
            width: 15px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

    input:checked + .slider {
        background-color: #2964ef;
    }

    input:focus + .slider {
        box-shadow: 0 0 1px #2196F3;
    }

    input:checked + .slider:before {
        -webkit-transform: translateX(15px);
        -ms-transform: translateX(15px);
        transform: translateX(15px);
    }

    /* Rounded sliders */
    .slider.round {
        border-radius: 34px;
    }

        .slider.round:before {
            border-radius: 50%;
        }
    .modalProdInfo {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 10; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    /* Modal Content/Box */
    @@media only screen and (min-width: 600px) {
        .modalProdInfo-content {
            background-color: #ffffff;
            margin: 3% auto; /* 15% from the top and centered */
            padding: 1px;
            border: 1px solid #888;
            width: 75%; /* Could be more or less, depending on screen size */
            height: 70%;
            top: 5%;
            overflow: auto;
        }
    }

    @@media only screen and (max-width: 600px) {
        .modalProdInfo-content {
            background-color: #ffffff;
            margin: 10% auto; /* 15% from the top and centered */
            padding: 5px;
            border: 1px solid #888;
            width: 95%; /* Could be more or less, depending on screen size */
            height: 80%;
            top: 20%;
            overflow: auto;
        }
    }
    /* The Close Button */
    .closePinfo {
        color: #aaa;
        float: right;
        font-size: 10px;
        font-weight: bold;
    }

        .closePinfo:hover,
        .closePinfo:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
</style>

<body>

    @Html.HiddenFor(model => model.Add, new { @autocomplete = "off", @class = "form-control", @id = "txtAddID" })
    @Html.HiddenFor(model => model.Modify, new { @autocomplete = "off", @class = "form-control", @id = "txtModifyID" })
    @Html.HiddenFor(model => model.View, new { @autocomplete = "off", @class = "form-control", @id = "txtViewID" })
    @Html.HiddenFor(model => model.Variant, new { @autocomplete = "off", @class = "form-control", @id = "txtVariantID" })
    @Html.HiddenFor(model => model.FormName, new { @autocomplete = "off", @class = "form-control", @id = "txtFormName" })
    @Html.HiddenFor(model => model.ID, new { @autocomplete = "off", @class = "form-control FormclrField", @id = "txtID" })
    @Html.HiddenFor(model => model.TransType, new { @autocomplete = "off", @class = "form-control", @id = "txtTransType" })
    @Html.HiddenFor(model => model.FormID, new { @autocomplete = "off", @class = "form-control", @id = "txtFormID" })
    <h4 id="MainHeading">@ViewData["FormName"]</h4>
    <hr />
    <div class="toastBox"></div>

    <div id="dvDocuments">
        <div style="width:100%;">

        </div>
        @*<button id="btnLoadDraft" class="btn btn-primary"><span class="glyphicon glyphicon-download-alt	" style="color: white"></span>&#x2009;Load Draft Data</button>*@
        <button id="btnAdd" class="btn btn-info"><span class="glyphicon glyphicon-plus" style="color: white"></span>&#x2009;Add</button>
        <hr />
        <div id="dvMainTable">
            <table class="table table-bordered" id="tblMasterData" width="100%">
                <thead>
                    <tr class="trclrforcolheader">
                        <th style="text-align:center;font-size: 12px;width:0%;">ID</th>
                        <th style="text-align:center;font-size: 12px;width:30%;">Name</th>
                        <th style="text-align:center;font-size: 12px;width:10%;">No.of Customers</th>
                        <th style="text-align:center;font-size: 12px;width:10%;">No.of Products</th>
                        <th style="text-align:center;font-size: 12px;width:15%;">From Date</th>
                        <th style="text-align:center;font-size: 12px;width:15%;">To Date</th>
                        <th style="text-align:center;font-size: 12px;width:10%;">Replace Exists</th>
                        <th style="text-align:center;font-size: 12px;width:10%;">Active</th>
                        <th style="text-align:center;font-size: 12px;width:10%;">User</th>
                        <th style="text-align:center;font-size: 12px;width:3%;" title="Edit">
                            <span class="glyphicon glyphicon-pencil" style="font-size:16px">
                            </span>
                        </th>

                        <th style="text-align:center;font-size: 12px;width:3%;" title="View">
                            <span class="glyphicon glyphicon-eye-open" style="font-size:16px">
                            </span>
                        </th>
                        <th style="text-align:center;font-size: 12px;width:4%;" title="Variant">
                            <span class="glyphicon glyphicon-file" style="font-size:12px">
                            </span>
                        </th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>

    <div id="dvMain">
        <div class="row">
            <div class="col-sm-12 col-md-12 col-lg-12">
                <table>
                    <tr>

                        <td style="border:none;" width="20%">
                            <div class="toggle">
                                <input type="radio" name="FilterData" id="rdoCustomer" checked="checked" />
                                <label for="rdoCustomer">Customer </label>
                                <input type="radio" name="FilterData" id="rdoProduct" />
                                <label for="rdoProduct">Product</label>
                            </div>
                        </td>
                        <td style="border:none;padding-right:7px;" width="30%">
                            <span class="form-label">
                                <input class="form-control FormclrField" type="text" id="txtName" placeholder=""
                                                       onbeforeinput="return AlphaNumericBeforeInput(event, this,'#divErrName')"
                                                        oninput="sanitizeAlphaNumeric(this, '#divErrName')"/>
                                <label class="labelup" for="txtCode"> Name</label>
                            </span>
                            <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrName" class="clrdivs"></div>
                        </td>
                        <td style="border:none;padding-right:7px;" width="10%">
                            <span class="form-label">
                                <input class="form-control FormclrField" type="date" id="dtpFFrom" placeholder="">
                                <label class="labelup" for="txtCode"> From</label>
                            </span>
                            <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrFFrom" class="clrdivs"></div>
                        </td>
                        <td style="border:none;padding-right:7px;" width="10%">

                            <span class="form-label">
                                <input class="form-control FormclrField" type="date" id="dtpFTo" placeholder="">
                                <label class="labelup" for="txtCode"> To</label>
                            </span>
                            <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrFTo" class="clrdivs"></div>
                        </td>
                        <td style="border:none;padding-right:7px;" width="10%">
                            <input style="font-size:14px;" type="checkbox" id="chkReplaceExists">
                            <label for="chkReplaceExists" style="font-size:14px;">Replace Exists</label>
                        </td>
                        <td style="border:none;padding-right:7px;" width="5%">
                            <input style="font-size:14px;" type="checkbox" id="chkActive">
                            <label for="chkActive" style="font-size:14px;">Active</label>
                        </td>
                        <td width="15%">
                        </td>
                    </tr>
                </table>
            </div>
            <hr />
        </div>
        <div>
            <div id="dvGrid1" align="center">
                <div class="row">
                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                        <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
                            <fieldset>
                                <legend>Customer Filters</legend>
                                <table width="100%">
                                    <tr class="bgclrfortr">
                                        <td style="border:none;" colspan="2">
                                            <div>
                                                <span class="form-label">
                                                    <input class="form-control FormclrField txtCustFilterField" type="text" id="txtCustomerType" placeholder=""
                                                       onbeforeinput="return AlphaNumericBeforeInput(event, this,'#dvErrdivErrCustomerTypeorCode')"
                                                        oninput="sanitizeAlphaNumeric(this, '#divErrCustomerType')"/>
                                                    <label class="labelup" for="txtCode"> Cutomer Type</label>
                                                </span>
                                                <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrCustomerType" class="clrdivs"></div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="bgclrfortr">
                                        <td style="border:none;" colspan="2">
                                            <div>
                                                <span class="form-label">
                                                    <input class="form-control FormclrField txtCustFilterField" type="text" id="txtBeat" placeholder=""
                                                       onbeforeinput="return AlphaNumericBeforeInput(event, this,'#divErrBeat')"
                                                        oninput="sanitizeAlphaNumeric(this, '#divErrBeat')"/>
                                                    <label class="labelup" for="txtCode"> Beat</label>
                                                </span>
                                                <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrBeat" class="clrdivs"></div>
                                            </div>
                                        </td>
                                    </tr>

                                    <tr class="bgclrfortr">
                                        <td style="border:none;" colspan="2">
                                            <div>
                                                <span class="form-label">
                                                    <input class="form-control FormclrField txtCustFilterField" type="text" id="txtSalesman" placeholder=""
                                                       onbeforeinput="return AlphaNumericBeforeInput(event, this,'#divErrSalesman')"
                                                        oninput="sanitizeAlphaNumeric(this, '#divErrSalesman')"/>
                                                    <label class="labelup" for="txtCode"> Salesman</label>
                                                </span>
                                                <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrSalesman" class="clrdivs"></div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="bgclrfortr">
                                        <td style="border:none;" colspan="2">
                                            <div>
                                                <span class="form-label">
                                                    <input class="form-control FormclrField txtCustFilterField" type="text" id="txtCustomer" placeholder=""
                                                       onbeforeinput="return AlphaNumericBeforeInput(event, this,'#divErrCustomer')"
                                                        oninput="sanitizeAlphaNumeric(this, '#divErrCustomer')"/>
                                                    <label class="labelup" for="txtCode">Customer</label>
                                                </span>
                                            </div>
                                            <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrCustomer" class="clrdivs"></div>
                                        </td>
                                    </tr>
                                    
                                    <tr class="bgclrfortr">
                                        <td style="border:none;" align="right">
                                            <button class="form-control btn btn-danger" id="btnClearCustomerFilter">
                                                Clear
                                            </button>
                                        </td>
                                        <td style="border:none;" align="right">
                                            <button class="form-control btn btn-info" id="btnLoadCustomerFilter">
                                                Load
                                            </button>
                                        </td>
                                    </tr>
                                </table>
                            </fieldset>
                        </div>
                        <div class="col-xs-12 col-sm-12 col-md-9 col-lg-9">
                            <table class="table table-bordered" id="tblCustomers" width="100%">
                                <thead>
                                    <tr>
                                        <th colspan="5" align="left">
                                            <button class="btn btn-primary" id="btnAddCustomers"><span class="glyphicon glyphicon-plus"></span>Add</button>
                                            <button class="btn btn-info" id="btnViewCustomers"><span class="glyphicon glyphicon-eye-open"></span> View</button>
                                        </th>
                                    </tr>
                                    <tr>
                                        <th style="text-align:center;font-size: 12px;width:0%;" class="trclrforcolheader">ID</th>
                                        <th style="text-align:center;font-size: 12px;width:3%;" class="trclrforcolheader"><input id="chkSelectAllCustomers" type="checkbox" /></th>
                                        <th style="text-align:center;font-size: 12px;width:2%;" class="trclrforcolheader">#</th>
                                        <th style="text-align:center;font-size: 12px;width:10%; padding-right:10px;" class="trclrforcolheader">Customer Code</th>
                                        <th style="text-align:center;font-size: 12px;width:10%; padding-right: 1px;" class="trclrforcolheader">Customer Name</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div id="dvGrid2" align="center">

                <div class="row">
                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                        <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
                            <fieldset>
                                <legend>Product Filters</legend>
                                <table width="100%">
                                    <tr class="bgclrfortr">
                                        <td style="border:none;" colspan="2">
                                            <div>
                                                <span class="form-label">
                                                    <input tabindex="4" class="form-control FormclrField txtProdFilterField" type="text" id="txtManuf" placeholder=""
                                                       onbeforeinput="return AlphaNumericBeforeInput(event, this,'#divErrorOnManuf')"
                                                        oninput="sanitizeAlphaNumeric(this, '#divErrorOnManuf')"/>
                                                    <label class="labelup" for="txtMfr">Manufacturer</label>
                                                </span>
                                                <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrorOnManuf" class="clrdivs"></div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="bgclrfortr">
                                        <td style="border:none;" colspan="2">
                                            <div>
                                                <span class="form-label">
                                                    <input tabindex="5" class="form-control FormclrField txtProdFilterField" type="text" id="txtBrand" placeholder=""
                                                       onbeforeinput="return AlphaNumericBeforeInput(event, this,'#divErrorOnBrand')"
                                                        oninput="sanitizeAlphaNumeric(this, '#divErrorOnBrand')"/>
                                                    <label class="labelup" for="txtBrand">Brand</label>
                                                </span>
                                                <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrorOnBrand" class="clrdivs"></div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="bgclrfortr">
                                        <td style="border:none;" colspan="2">
                                            <div>
                                                <span class="form-label">
                                                    <input tabindex="6" class="form-control FormclrField txtProdFilterField" type="email" id="txtCategory" placeholder=""
                                                       onbeforeinput="return AlphaNumericBeforeInput(event, this,'#divErrorOnCategory')"
                                                        oninput="sanitizeAlphaNumeric(this, '#divErrorOnCategory')"/>
                                                    <label class="labelup" for="txtCategory">Category</label>
                                                </span>
                                                <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrorOnCategory" class="clrdivs"></div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="bgclrfortr">
                                        <td style="border:none;" colspan="2">
                                            <div>
                                                <span class="form-label">
                                                    <input class="form-control FormclrField txtProdFilterField" type="text" id="txtProduct" placeholder=""
                                                       onbeforeinput="return AlphaNumericBeforeInput(event, this,'#divErrProduct')"
                                                        oninput="sanitizeAlphaNumeric(this, '#divErrProduct')"/>
                                                    <label class="labelup" for="txtCode">Product</label>
                                                </span>
                                            </div>
                                            <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrProduct" class="clrdivs"></div>
                                        </td>
                                    </tr>
                                    <tr class="bgclrfortr">
                                        <td style="border: none;" align="right">
                                            <button class="form-control btn btn-danger" id="btnClearProductFilter">
                                                Clear
                                            </button>
                                        </td>
                                        <td style="border: none;" align="right">
                                            <button class="form-control btn btn-info" id="btnLoadProductFilter">
                                                Load
                                            </button>
                                        </td>
                                    </tr>
                                </table>
                            </fieldset>
                        </div>
                        <div class="col-xs-12 col-sm-12 col-md-9 col-lg-9">
                            <table class="table table-bordered row-border order-column" id="tblProducts" width="100%">
                                <thead>
                                    <tr>
                                        <th colspan="5" align="left">
                                            <button class="btn btn-primary" id="btnAddProduct"><span class="glyphicon glyphicon-plus"></span>Add</button>
                                            <button class="btn btn-info" id="btnViewProducts"><span class="glyphicon glyphicon-eye-open"></span> View</button>
                                        </th>
                                        <th>
                                            <span class="form-label">
                                                <input class="gdInput FormclrField txtsettag" txttag="0" type="number" id="txtProdDiscPern" placeholder="" style="align-content:flex-end">
                                                @*<label class="labelup" for="txtCode">Prod %</label>*@
                                            </span>
                                            <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrProdDiscPern" class="clrdivs"></div>
                                        </th>
                                        <th>
                                            <span class="form-label">
                                                <input class="gdInput FormclrField txtsettag" txttag="0" type="number" id="txtProdDiscAmount" placeholder="" style="align-content:flex-end">
                                                @*<label class="labelup" for="txtCode">Prod ₹</label>*@
                                            </span>
                                            <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrProdDiscAmount" class="clrdivs"></div>
                                        </th>
                                        <th>
                                            <span class="form-label">
                                                <input class="gdInput FormclrField txtsettag" txttag="0" type="number" id="txtTradeDiscPern" placeholder="" style="align-content:flex-end">
                                                @*<label class="labelup" for="txtCode">Trade %</label>*@
                                            </span>
                                            <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrTradeDiscPern" class="clrdivs"></div>
                                        </th>
                                        <th>
                                            <span class="form-label">
                                                <input class="gdInput FormclrField txtsettag" txttag="0" type="number" id="txtTradeDiscAmount" placeholder="" style="align-content:flex-end">
                                                @*<label class="labelup" for="txtCode">Trade ₹</label>*@
                                            </span>
                                            <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrTradeDiscAmount" class="clrdivs"></div>
                                        </th>
                                    </tr>
                                    <tr>
                                        <th style="text-align:center;font-size: 12px;width:0%;" class="trclrforcolheader">ID</th>
                                        <th style="text-align:center;font-size: 12px;width:3%;" class="trclrforcolheader"><input id="chkSelectAllProduct" type="checkbox" /></th>
                                        <th style="text-align:center;font-size: 12px;width:2%;" class="trclrforcolheader">#</th>
                                        <th style="text-align:center;font-size: 12px;width:10%; padding-right:10px;" class="trclrforcolheader">Product Code</th>
                                        <th style="text-align:center;font-size: 12px;width:10%; padding-right: 1px;" class="trclrforcolheader">Product Name</th>
                                        <th style="text-align: center; font-size: 12px; width: 8%; padding-right: 10px;" title="Product Discount Percentage" class="trclrforcolheader">Prod %</th>
                                        <th style="text-align: center; font-size: 12px; width: 8%; padding-right: 10px;" title="Product Discount Amount" class="trclrforcolheader">Prod ₹</th>
                                        <th style="text-align: center; font-size: 12px; width: 8%; padding-right: 10px;" title="Trade Discount Percentage" class="trclrforcolheader">Trade %</th>
                                        <th style="text-align: center; font-size: 12px; width: 8%; padding-right: 10px;" title="Trade Discount Amount" class="trclrforcolheader">Trade ₹</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footerAction modal-footer">
            <div style="padding-right:20px" align="right">
                @*<button id="btnChkPM">Check PM</button>*@
                @*<button type="button" class="btn clrforpdf" id="btnPDF"><i class='fa-regular fa-file-pdf' style='color:white'></i> PDF</button>
                    <button type="button" class="btn clrforpreview" id="btnPreview"><span class="glyphicon glyphicon-print"> Preview</span></button>*@
                <button type="button" class="btn btn-danger" id="btnClear"><span class="glyphicon glyphicon-refresh"> Clear</span></button>
                <button type="button" class="btn btn-success" id="btnSave"><span class="glyphicon glyphicon-saved"> Save</span></button>
                <button type="button" class="btn btn-warning" id="btnClose"><span class="glyphicon glyphicon-remove"> Close</span></button>
            </div>
        </div>
    </div>
    <div class="modalProdInfo" id="myModalPinfo">
        <div class="modal-dialog" style="width:auto;">
            <div class="modalProdInfo-content">
                <!-- Modal Header -->
                <div class="modal-header">
                    <button type="button" class="closePinfo">&times;</button>
                    <h5 class="modal-title" style="color:black" id="lblPopupheading"></h5>
                    @*<hr />*@
                </div>
                <!-- Modal body -->
                <div class="modal-body">
                    <div style="padding-top:2px">
                        
                        <div id="dvCustomers" style="width:100%;padding-bottom:7px">
                            <table class="table table-bordered" id="tblCustomersView" width="100%">
                                <thead>
                                    <tr>
                                        <th style="text-align:center;font-size: 12px;width:0%;" class="trclrforcolheader">ID</th>
                                        <th style="text-align:center;font-size: 12px;width:3%;" class="trclrforcolheader"><input id="chkSelectAllCustomersView" type="checkbox" /></th>
                                        <th style="text-align:center;font-size: 12px;width:2%;" class="trclrforcolheader">#</th>
                                        <th style="text-align:center;font-size: 12px;width:10%; padding-right:10px;" class="trclrforcolheader">Customer Code</th>
                                        <th style="text-align:center;font-size: 12px;width:10%; padding-right: 1px;" class="trclrforcolheader">Customer Name</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                        <div id="dvProducts" style="width:100%;padding-bottom:7px">
                            <table class="table table-bordered row-border order-column" id="tblProductsView" width="100%">
                                <thead>
                                    <tr>
                                        <th colspan="5" align="left">

                                        </th>
                                        <th>
                                            <span class="form-label">
                                                <input class="gdInput FormclrField txtsettag" txttag="0" type="number" id="txtProdDiscPernView" placeholder="" style="align-content:flex-end">
                                                @*<label class="labelup" for="txtCode">Prod %</label>*@
                                            </span>
                                            <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrProdDiscPernView" class="clrdivs"></div>
                                        </th>
                                        <th>
                                            <span class="form-label">
                                                <input class="gdInput FormclrField txtsettag" txttag="0" type="number" id="txtProdDiscAmountView" placeholder="" style="align-content:flex-end">
                                                @*<label class="labelup" for="txtCode">Prod ₹</label>*@
                                            </span>
                                            <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrProdDiscAmountView" class="clrdivs"></div>
                                        </th>
                                        <th>
                                            <span class="form-label">
                                                <input class="gdInput FormclrField txtsettag" txttag="0" type="number" id="txtTradeDiscPernView" placeholder="" style="align-content:flex-end">
                                                @*<label class="labelup" for="txtCode">Trade %</label>*@
                                            </span>
                                            <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrTradeDiscPernView" class="clrdivs"></div>
                                        </th>
                                        <th>
                                            <span class="form-label">
                                                <input class="gdInput FormclrField txtsettag" txttag="0" type="number" id="txtTradeDiscAmountView" placeholder="" style="align-content:flex-end">
                                                @*<label class="labelup" for="txtCode">Trade ₹</label>*@
                                            </span>
                                            <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrTradeDiscAmountv" class="clrdivs"></div>
                                        </th>
                                    </tr>
                                    <tr>
                                        <th style="text-align:center;font-size: 12px;width:0%;" class="trclrforcolheader">ID</th>
                                        <th style="text-align:center;font-size: 12px;width:3%;" class="trclrforcolheader"><input id="chkSelectAllProductView" type="checkbox" /></th>
                                        <th style="text-align:center;font-size: 12px;width:2%;" class="trclrforcolheader">#</th>
                                        <th style="text-align:center;font-size: 12px;width:10%; padding-right:10px;" class="trclrforcolheader">Product Code</th>
                                        <th style="text-align:center;font-size: 12px;width:10%; padding-right: 1px;" class="trclrforcolheader">Product Name</th>
                                        <th style="text-align: center; font-size: 12px; width: 8%; padding-right: 10px;" title="Product Discount Percentage" class="trclrforcolheader">Prod %</th>
                                        <th style="text-align: center; font-size: 12px; width: 8%; padding-right: 10px;" title="Product Discount Amount" class="trclrforcolheader">Prod ₹</th>
                                        <th style="text-align: center; font-size: 12px; width: 8%; padding-right: 10px;" title="Trade Discount Percentage" class="trclrforcolheader">Trade %</th>
                                        <th style="text-align: center; font-size: 12px; width: 8%; padding-right: 10px;" title="Trade Discount Amount" class="trclrforcolheader">Trade ₹</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
                <!-- Modal footer -->
                <div class="modal-footer" style="background-color:skyblue">
                    <div style="padding-top:0px" align="right">
                        @*<button tabindex="4" type="button" class="btn btn-danger" id="btnPinfoClear"><span class="glyphicon glyphicon-refresh"> Clear</span></button>*@
                        <button tabindex="3" type="button" class="btn btn-success" id="btnViewpopupaccept"><span class="glyphicon glyphicon-saved"> Accept</span></button>
                        <button tabindex="5" type="button" class="btn btn-warning" id="btnViewpopupclose"><span class="glyphicon glyphicon-remove"> Close</span></button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script type="text/javascript">
    //document.body.style.zoom = "85%";
    $("#txtDocID").prop("disabled", true);
    //dvDocuments,
    $("#dvMain").hide();
    $(".FormBtField").prop("disabled", true);
    
    //var Table = $('#tblMasterData').DataTable({pageLength: ItemsperPage,lengthMenu: [[10, 20, 50, 100, -1], [10, 20, 50, 100, "All"]],
    //    "bFilter": true,
    //    "bSearchable": true,
    //    "bInfo": true,
    //    "bPaginate": true,
    //    "ordering": false,
    //    scrollY: "400px",
    //    scrollX: true,
    //    scrollCollapse: true,
    //    "columnDefs": [{ "targets": [0], "visible": false, searchable: false }, { "targets": [1], "width": "40%" }, { "targets": [2], "width": "5%", "class": "text-center" },
    //        { "targets": [3, 4], "width": "10%" }, { "targets": [5, 6, 7, 8], "class": "text-center", "width": "5%" }],
    //});
    //
    var TableCustomers = $('#tblCustomers').DataTable({
        paging: false,
        searching: true,
        info: false,
        ordering: true,
        scrollY: "250px",
        scrollX: true,
        scrollCollapse: true,
        "columnDefs": [{ "targets": [0], "visible": false, searchable: false, ordering: false }, { "targets": [1,2], "width": "5%" }, { "targets": [3], "width": "20%" }
            , { "targets": [4], "width": "70%" }, { "targets": [1,2], "class": "text-center" }]
    });
    var TableCustomersView = $('#tblCustomersView').DataTable({
        paging: false,
        searching: true,
        info: false,
        ordering: true,
        scrollY: "250px",
        scrollX: true,
        scrollCollapse: true,
        "columnDefs": [{ "targets": [0], "visible": false, searchable: false, ordering: false }, { "targets": [1, 2], "width": "5%" }, { "targets": [3], "width": "20%" }
            , { "targets": [4], "width": "70%" }, { "targets": [1, 2], "class": "text-center" }]
    });
    
    var TableProducts = $('#tblProducts').DataTable({
        paging: false,
        searching: true,
        info: false,
        ordering: true,
        scrollY: "250px",
        scrollX: true,
        scrollCollapse: true,
        "columnDefs": [{ "targets": [0], "visible": false, searchable: false, ordering: false }, { "targets": [1], "width": "5%" }, { "targets": [2], "width": "5%" }
            , { "targets": [3], "width": "10%" }, { "targets": [4], "width": "30%" }, { "targets": [5, 6, 7, 8], "width": "10%" }, { "targets": [1, 2], "class": "text-center" }]
    });
    var TableProductsView = $('#tblProductsView').DataTable({
        paging: false,
        searching: true,
        info: false,
        ordering: true,
        scrollY: "250px",
        scrollX: true,
        scrollCollapse: true,
        "columnDefs": [{ "targets": [0], "visible": false, searchable: false, ordering: false }, { "targets": [1], "width": "5%" }, { "targets": [2], "width": "5%" }
            , { "targets": [3], "width": "10%" }, { "targets": [4], "width": "30%" }, { "targets": [5, 6, 7, 8], "width": "10%" }, { "targets": [1, 2], "class": "text-center" }]
    });
    
    var modalPinfo = document.getElementById("myModalPinfo");
    var spanpif = document.getElementsByClassName("closePinfo")[0];
    spanpif.onclick = function () {
        modalPinfo.style.display = "none";
    }
    $('#btnViewpopupclose').click(function (e) {
        modalPinfo.style.display = "none";
    });
    
    setDate("dtpFFrom", 0);
    setDate("dtpFTo", 0);
    //dvGrid1,dvGrid2,rdoCustomer,rdoProduct
    $("#dvGrid2").hide();
    $("#rdoProduct").click(function () {
        $("#dvGrid2,.ProdDiscs").show();
        $("#dvGrid1").hide();

    });
    $("#rdoCustomer").click(function () {
        $("#dvGrid1").show();
        $("#dvGrid2,.ProdDiscs").hide();
    });
   
    var nDocPrefix = $("#txtFormID").val();
    var UID = '@Session["LoginUserID"]';
    var Aurl = '@Session["APIurl"]';
    var DecVal = '@Session["DecimalValues"]';
    var DefBranch = '@Session["DefaultBranch"]';
    var ConfigRoundtype = '@Session["RoundoffType"]';
    var ConfigRoundvalue = '@Session["RoundoffValue"]';
    var VisaPern = '@Session["VisaPern"]';
    var BatchMode = 0; // 0 - New product, 1 - Edit Product
    var nTransMode = 1, nIsDraft = 0;

    GetData(1);

if ($("#txtAddID").val() == 0) {
    $("#trAdd").hide();
    $("#btnAdd").hide();
    }
    if ($("#txtModifyID").val() == 0 && $("#txtViewID").val() == 0 && $("#txtVariantID").val() == 0 && $("#txtAddID").val() == 1) {
        $("#dvMainTable").hide();
    }    

    $("#btnAdd").click(function () {
        //dvDocuments,
        nTransMode = 1;
        $("#dvMain").show();
        $("#dvDocuments").hide();
        ClearForm();
    })
    $("#btnClose").click(function () {
        if (ClosecfFocus != 3) { CloseConfirmDialogMsg("Do you want to close?"); } else { CloseForm(); }
    });

    function CloseForm() {
        $("#dvMain").hide();
        $("#dvDocuments").show();
        $("#MainHeading").text($("#txtFormName").val());
        //GetData(rdo1 ? 6 : 10);
        GetData(2)
    }
    $('input[type=number]').focusin(function (e) {
        $(this).select();
    });
    function SetTagZero() {
        var inputs = $(".txtsettag");
        for (var i = 0; i < inputs.length; i++) {
            var field = $(inputs[i]);
            var FID = field[0].id;
            if (FID != "")
                updateInputColumn(FID, 0);
        }
        inputs = $(".lblsettag");
        for (var i = 0; i < inputs.length; i++) {
            var field = $(inputs[i]);
            var FID = field[0].id;
            if (FID != "") {
                updateLabelColumn(FID, 0);
            }
        }
    }
    function updateLabelColumn(labelID, netValue) {
        //const label = document.getElementById(`dgvProdGross${rowId}`);
        const label = document.getElementById(labelID);
        label.setAttribute('lbltag', netValue.toFixed(4));
        label.innerText = netValue.toFixed(DecVal);
        label.title = netValue.toFixed(4);
    }
    function updateInputColumn(inputID, netValue) {
        //const label = document.getElementById(`dgvProdGross${rowId}`);
        const input = document.getElementById(inputID);
        var value = netValue != "" ? netValue : 0;
        input.setAttribute('txttag', parseFloat(value).toFixed(4));
        input.value = parseFloat(value).toFixed(DecVal);
        input.title = netValue;
    }
    $(".txtsettag").focusin(function (e) {
        var id = e.target.id;
        const val = document.getElementById(id).getAttribute("txttag");
        $("#" + id).val(val);
        $("#" + id).select();
        txtValuechanged = false;
    });
    $(".txtsettag").blur(function (e) {
        var val = e.target.value;
        var id = e.target.id;
        if (id == "txtTradeDiscPern") {
            console.log("3. Tr Disc : " + val);
        }
        if (!txtValuechanged)
            updateInputColumn(id, val);
    });
    $('#tblCustomers tbody').on('focusin', 'td>.txtsettag', function (e) {
        // .clsdgvTag
        var id = e.target.id;
        var name = e.target.name;
        var value = e.target.value;
        //getTagValue(id, name);
        const val = document.getElementById(id).getAttribute("txttag");
        $("#" + id).val(val);
        $("#" + id).select();
        ProdGridChange = false;
    });
    var ProdGridChange = false;
    $('#tblCustomers tbody').on('blur', 'td>.txtsettag', function (e) {
        // .clsdgvTag
        var id = e.target.id;
        var name = e.target.name;
        var value = e.target.value;
        //setTagValue(id, name, value);
        if (!ProdGridChange) {
            updateInputColumn(id, e.target.value);
        }
    });

    $('#tblProducts tbody').on('focusin', 'td>.txtsettag', function (e) {
        // .clsdgvTag
        var id = e.target.id;
        var name = e.target.name;
        var value = e.target.value;
        //getTagValue(id, name);
        const val = document.getElementById(id).getAttribute("txttag");
        $("#" + id).val(val);
        $("#" + id).select();
        ProdGridChange = false;
    });

    $('#tblProducts tbody').on('blur', 'td>.txtsettag', function (e) {
        // .clsdgvTag
        var id = e.target.id;
        var name = e.target.name;
        var value = e.target.value;
        //setTagValue(id, name, value);
        if (!ProdGridChange) {
            updateInputColumn(id, e.target.value);
        }
        //CalculateBatchGrid();
    });

    var BatchRID = 0, ProductRID = 0;
    function ReorderSerialNo() {
        var sNo = 0;
        $("#tblCustomers tbody tr").each(function () {
            $(this).find("p").each(function (index) {
                vals = (sNo + 1);
                $(this).text(vals);
            });
            sNo++;
        });
        //$("#tblCustomers").DataTable().ajax.reload();
    }

    function Scrolltoid(id) {
        //window.scrollTo(id[0].offsetLeft, id[0].offsetTop);
        window.scrollTo({ left: 0, top: document.body.scrollHeight, behavior: "smooth" });
    }   
    
    //$("#txtProdDiscPern,#txtProdDiscPernView").change(function (e) {
    $(document).on("change", "#txtProdDiscPern,#txtProdDiscPernView", function (e) {
        txtValuechanged = true;
        var id = e.target.id;
        var val = e.target.value;
        var name = e.target.name;
        const PDiscAmt = id == "txtProdDiscPern" ? document.getElementById("txtProdDiscAmount").getAttribute("txttag") : 
            document.getElementById("txtProdDiscAmountView").getAttribute("txttag");
        var Tbl = id == "txtProdDiscPern" ? "tblProducts" : "tblProductsView";
        if (PDiscAmt == 0) {
            if (val <= 100) {
                updateInputColumn(id, val);
                $("#" + Tbl +" tbody tr").each(function () {
                    $(this).find("input").each(function (index) {
                        const fieldName = $(this).attr("name");
                        const fieldID = $(this).attr("id");
                        if (fieldName == "ProdDiscPern") {
                            updateInputColumn(fieldID, val);
                        }
                    });
                });
            } else {
                $("#" + Tbl + " tbody tr").each(function () {
                    $(this).find("input").each(function (index) {
                        const fieldName = $(this).attr("name");
                        const fieldID = $(this).attr("id");
                        if (fieldName == "ProdDiscPern") {
                            updateInputColumn(fieldID, 0);
                        }
                    });
                });
                updateInputColumn(id, 0);
                showErrorSnackbar("Product % should be lessthan 100 only")
            }
        }
        else {
            $("#" + Tbl + " tbody tr").each(function () {
                $(this).find("input").each(function (index) {
                    const fieldName = $(this).attr("name");
                    const fieldID = $(this).attr("id");
                    if (fieldName == "ProdDiscPern") {
                        updateInputColumn(fieldID, 0);
                    }
                });
            });
            updateInputColumn(id, 0);
            showErrorSnackbar("Product Discount Amount already given.");
        }
    });

    //disc amt begin
    //$("#txtProdDiscAmount,#txtProdDiscAmountView").change(function (e) {
    $(document).on("change", "#txtProdDiscAmount,#txtProdDiscAmountView", function (e) {
        txtValuechanged = true;
        var id = e.target.id;
        var val = e.target.value;
        var name = e.target.name;
        const PDiscPern = id == "txtProdDiscAmount" ? document.getElementById("txtProdDiscPern").getAttribute("txttag") :
            document.getElementById("txtProdDiscPernView").getAttribute("txttag");
        var Tbl = id == "txtProdDiscAmount" ? "tblProducts" : "tblProductsView";
        if (PDiscPern == 0) {
            updateInputColumn(id, val);
            $("#" + Tbl + " tbody tr").each(function () {
                $(this).find("input").each(function (index) {
                    const fieldName = $(this).attr("name");
                    const fieldID = $(this).attr("id");
                    if (fieldName == "ProdDiscAmt") {
                        updateInputColumn(fieldID, val);
                    }
                });
            });
        }
        else {
            $("#" + Tbl + " tbody tr").each(function () {
                $(this).find("input").each(function (index) {
                    const fieldName = $(this).attr("name");
                    const fieldID = $(this).attr("id");
                    if (fieldName == "ProdDiscAmt") {
                        updateInputColumn(fieldID, 0);
                    }
                });
            });
            updateInputColumn(id, 0);
            showErrorSnackbar("Product Discount % already given.");
        }
    });
    //dis amt end
    //
    //$("#txtTradeDiscPern,#txtTradeDiscPernView").change(function (e) {
    $(document).on("change", "#txtTradeDiscPern,#txtTradeDiscPernView", function (e) {
        txtValuechanged = true;
        var id = e.target.id;
        var val = e.target.value;
        var name = e.target.name;
        const TDiscAmt = id == "txtTradeDiscPern" ? document.getElementById("txtTradeDiscAmount").getAttribute("txttag") :
            document.getElementById("txtTradeDiscAmountView").getAttribute("txttag");
        var Tbl = id == "txtTradeDiscPern" ? "tblProducts" : "tblProductsView";
        if (TDiscAmt == 0) {
            if (val <= 100) {
                updateInputColumn(id, val);
                $("#" + Tbl + " tbody tr").each(function () {
                    $(this).find("input").each(function (index) {
                        const fieldName = $(this).attr("name");
                        const fieldID = $(this).attr("id");
                        if (fieldName == "TradeDiscPern") {
                            updateInputColumn(fieldID, val);
                        }
                    });
                });
            } else {
                $("#" + Tbl + " tbody tr").each(function () {
                    $(this).find("input").each(function (index) {
                        const fieldName = $(this).attr("name");
                        const fieldID = $(this).attr("id");
                        if (fieldName == "TradeDiscPern") {
                            updateInputColumn(fieldID, 0);
                        }
                    });
                });
                updateInputColumn(id, 0);
                showErrorSnackbar("Trade % should be lessthan 100 only")
            }
        }
        else {
            $("#" + Tbl + " tbody tr").each(function () {
                $(this).find("input").each(function (index) {
                    const fieldName = $(this).attr("name");
                    const fieldID = $(this).attr("id");
                    if (fieldName == "TradeDiscPern") {
                        updateInputColumn(fieldID, 0);
                    }
                });
            });
            updateInputColumn(id, 0);
            showErrorSnackbar("Trade Discount Amount already given.");
        }
    });
    //
    //disc amt begin
    //$("#txtTradeDiscAmount,#txtTradeDiscAmountView").change(function (e) {
    $(document).on("change", "#txtTradeDiscAmount,#txtTradeDiscAmountView", function (e) {
        txtValuechanged = true;
        var id = e.target.id;
        var val = e.target.value;
        var name = e.target.name;
        const PDiscPern = id == "txtTradeDiscAmount" ? document.getElementById("txtTradeDiscPern").getAttribute("txttag") :
            document.getElementById("txtTradeDiscPernView").getAttribute("txttag");
        var Tbl = id == "txtTradeDiscAmount" ? "tblProducts" : "tblProductsView";
        if (PDiscPern == 0) {
            updateInputColumn(id, val);
            $("#" + Tbl + " tbody tr").each(function () {
                $(this).find("input").each(function (index) {
                    const fieldName = $(this).attr("name");
                    const fieldID = $(this).attr("id");
                    if (fieldName == "TradeDiscAmt") {
                        updateInputColumn(fieldID, val);
                    }
                });
            });
        }
        else {
            $("#" + Tbl + " tbody tr").each(function () {
                $(this).find("input").each(function (index) {
                    const fieldName = $(this).attr("name");
                    const fieldID = $(this).attr("id");
                    if (fieldName == "TradeDiscAmt") {
                        updateInputColumn(fieldID, 0);
                    }
                });
            });
            updateInputColumn(id, 0);
            showErrorSnackbar("Trade Discount % already given.");
        }
    });
    //dis amt end
    $('#tblProduct tbody').on('change', '.ProdDiscPern1', function (e) {
        var id = e.target.id;
        var val = e.target.value;
        var name = e.target.name;
        ProdGridChange = true;
        updateInputColumn(id, val);        
    });
    //$("#tblCustomers").change(function (e) {
    var txtValuechanged = false;

function setDate(FieldID,Type) {
    $.ajax({
         url: "@Url.Action("setdate", "Home")",
        type: 'get',
        contentType: 'json',
        data: { TypeID: Type },
        success: function (data) {
            $.each(data, function (i, items) {
                //$("#" + FieldID).attr("max", items.MaxDate);
                //$("#" + FieldID).attr("min", items.MinDate);
                $("#" + FieldID).val(items.Value);
            });
        }
    })
    }
    var Table = $('#tblMasterData').DataTable();
    AllShemeData();
    function AllShemeData() {
        $.ajax({
            url: Aurl + "discountscheme/getalldata",
            type: "GET",
            datatype: "JSON",
            xhrFields: {
                withCredentials: true
            },
            data: { Mode: 2, Name: "" },
            success: function (data) {
                var discountschemejsdata = eval(data);
                var searchValue = '';
                if ($.fn.DataTable.isDataTable('#tblMasterData')) {
                    searchValue = $('#tblMasterData').DataTable().search(); // get current search term
                }
                $('#tblMasterData').DataTable({pageLength: ItemsperPage,lengthMenu: [[10, 20, 50, 100, -1], [10, 20, 50, 100, "All"]],
                    scrollY: "450px",
                    scrollX: true,
                    scrollCollapse: true,
                    paging: true,
                    destroy: true,
                    data: discountschemejsdata,
                    fixedColumns: false,
                    searching: true,
                    ordering: true,
                    sorting: false,
                    //"pagingType": "full_numbers",
                    columns: [
                        { "data": "ID", "autoWidth": true, "visible": false, className: "dt-body-left" },
                        { "data": "Name", "autoWidth": true, className: "dt-body-left" },
                        { "data": "CustomerCount", "autoWidth": true, className: "dt-body-center" },
                        { "data": "ProductCount", "autoWidth": true, className: "dt-body-center" },
                        { "data": "FromDate", "autoWidth": true, className: "dt-body-right" },
                        { "data": "ToDate", "autoWidth": true, className: "dt-body-right" },
                        { "data": "ReplaceExists", "autoWidth": true, className: "dt-body-center" },
                        { "data": "Active", "autoWidth": true, className: "dt-body-center" },
                        {
                            className: "dt-body-center",
                            "mRender": function (data, type, value) {
                                var _action = '<label title="' + value.CDate + '">' + value.CBy + '</label>';
                                return _action;
                            }
                        },
                        {
                            className: "dt-body-center",
                            "mRender": function (data, type, value) {
                                var _action = '<a href="javascript:void(0) style="cursor: pointer;"><span class="glyphicon glyphicon-pencil clsEdit" style="font-size:16px" title="Edit"></span></a>';
                                return _action;
                            },
                            "visible": $("#txtModifyID").val() == 0 ? false : true
                        },
                        {
                            className: "dt-body-center",
                            "mRender": function (data, type, value) {
                                var _action = '<a href="javascript:void(0) style="cursor: pointer;"><span class="glyphicon glyphicon-eye-open clsView" style="font-size:16px" title="View"></span></a>';
                                return _action;
                            },
                            "visible": $("#txtViewID").val() == 0 ? false : true
                        },
                        {
                            className: "dt-body-center",
                            "mRender": function (data, type, value) {
                                var _action = '<a href="javascript:void(0)" class= "clsVariant" style = "font-size:12px" > <span class="glyphicon glyphicon-file clsVariant" style="font-size:12px" title="Variant"></span></a>';
                                return _action;
                            },
                            "visible": $("#txtVariantID").val() == 0 ? false : true
                        }
                    ],
                    initComplete: function () {
                        // Re-apply search value after table is fully initialized
                        this.api().search(searchValue).draw();
                    }
                });
                Table = $('#tblMasterData').DataTable();
            }
        });
        
    }
    //var TableCustomers = $('#tblCustomers').DataTable();
    GetData(2);
    var arrCustType = [], arrBeat = [], arrSalesman = [], arrCustomer = [], arrManuf = [], arrBrand = [], arrCategory = [], arrProduct = [], arrNameData = [];   
    function GetData(nMode, strName = null) {
        $.ajax({
            url: Aurl + "discountscheme/get",
            type: 'get',
            contentType: 'json',
            data: { Mode: nMode, Name: strName},
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                if (nMode == 1) {
                    arrCustType = [], arrBeat = [], arrSalesman = [], arrCustomer = [], arrManuf = [], arrBrand = [], arrCategory = [], arrProduct = [];                    
                    $.each(data, function (i, items) {
                        if (items.FType == 1) {
                            var val = {
                                "label": items.Name,
                                "name": items.Name,
                                "id": items.ID,
                            }
                            arrManuf.push(val);                            
                        }
                        if (items.FType == 2) {
                            var val = {
                                "label": items.Name,
                                "name": items.Name,
                                "id": items.ID,
                            }
                            arrBrand.push(val);    
                        }
                        if (items.FType == 3) {
                            var val = {
                                "label": items.Name,
                                "name": items.Name,
                                "id": items.ID,
                            }
                            arrCategory.push(val);    
                        }
                        if (items.FType == 4) {
                            var val = {
                                "label": items.Name,
                                "name": items.Name,
                                "id": items.ID,
                            }
                            arrProduct.push(val);    
                        }
                        if (items.FType == 5) {
                            var val = {
                                "label": items.Name,
                                "name": items.Name,
                                "id": items.ID,
                            }
                            arrCustType.push(val);
                        }
                        if (items.FType == 6) {
                            var val = {
                                "label": items.Name,
                                "name": items.Name,
                                "id": items.ID,
                            }
                            arrBeat.push(val);
                        }
                        if (items.FType == 7) {
                            var val = {
                                "label": items.Name,
                                "name": items.Name,
                                "id": items.ID,
                            }
                            arrSalesman.push(val);
                        }
                        if (items.FType == 8) {
                            var val = {
                                "label": items.Name,
                                "name": items.Name,
                                "id": items.ID,
                            }
                            arrCustomer.push(val);
                        }
                    });
                    SetAutlistforFields();
                }
                if (nMode == 2) {
                    arrNameData = [];
                    //Table.draw().clear();
                    $.each(data, function (i, items) {                       
                        var al = {
                            "label": items.Name,
                            "id": items.ID,
                        }
                        arrNameData.push(al);
                        //Table.row.add([
                        //    items.ID,
                        //    items.Name,
                        //    items.ReplaceExists,
                        //    items.FromDate,
                        //    items.ToDate,
                        //    items.Active,
                        //    '<a href="javascript:void(0) style="cursor: pointer;"><span class="glyphicon glyphicon-pencil clsEdit" style="font-size:16px" title="Edit"></span></a>',
                        //    '<a href="javascript:void(0) style="cursor: pointer;"><span class="glyphicon glyphicon-eye-open clsView" style="font-size:16px" title="View"></span></a>',
                        //    '<a href="javascript:void(0)" class= "clsVariant" style = "font-size:12px" > <span class="glyphicon glyphicon-file clsVariant" style="font-size:12px" title="Variant"></span></a>',
                        //]).draw(false);
                    });
                    $("#txtName").autocomplete({
                        minLength: 0,
                        source: arrNameData,                        
                        select: function (event, ui) {                           
                            return false;
                        },
                    }).autocomplete("instance")._renderItem = function (ul, item) {
                        return $("<li class='each'>")
                            .append("<div class='acItem'><span class='name'>" +
                                item.label + "</span></div>")
                            .appendTo(ul);
                    };
                }
                if (nMode == 3) {
                    /*TableCustomers.draw().clear(); TableCustomers.draw().clear();*/
                    //TableProducts.draw().clear(); TableProducts.draw().clear();
                    var isDisable = nTransMode == 3 ? "disabled" : "";
                    $.each(data, function (i, items) {
                        $("#dtpFFrom").val(items.FromDate); $("#dtpFTo").val(items.ToDate);
                        $("#chkReplaceExists").prop("checked", items.ReplaceExists == "True");
                        $("#chkActive").prop("checked", items.Active == "True");

                        if (nTransMode != 1) {
                            $("#txtName").val(items.Name);
                            $("#txtID").val(items.ID);
                        } else {
                            $("#txtName").val("");
                            $("#txtID").val("");
                        }
                        //for (var j = 0; j < items.lstSchemeCustomer.length; j++) {
                        //    TableCustomers.row.add([
                        //        items.lstSchemeCustomer[j].CustomerID,
                        //        '<input type="checkbox" id="chkCustomerCheck' + j + '"  name="CustomerCheck" checked ' + isDisable +'/>',
                        //        (j + 1),
                        //        '<label name="CustomerCode" id="dgvCustCode' + j + '">' + items.lstSchemeCustomer[j].Code + '</label>',
                        //        '<label name="CustomerName" id="dgvCustName' + j + '">' + items.lstSchemeCustomer[j].Name + '</label>',
                        //    ]).draw(false);
                        //}
                        //for (var k = 0; k < items.lstSchemeProduct.length; k++) {
                        //    TableProducts.row.add([
                        //        items.lstSchemeProduct[k].ProductID,
                        //        '<input type="checkbox" id="chkProductsCheck' + k + '"  name="ProductsCheck" checked ' + isDisable +'/>',
                        //        (k + 1),
                        //        '<label name="ProductCode" id="dgvProdCode' + k + '">' + items.lstSchemeProduct[k].Code + '</label>',
                        //        '<label name="ProductName" id="dgvProdName' + k + '">' + items.lstSchemeProduct[k].Name + '</label>',
                        //        '<input type="number" txttag="' + items.lstSchemeProduct[k].ProdDiscPern + '" title="' + items.lstSchemeProduct[k].ProdDiscPern + '" value="' + parseFloat(items.lstSchemeProduct[k].ProdDiscPern).toFixed(DecVal) + '" name="ProdDiscPern"  class="txtsettag ProdDiscPern gdInput"  id="dgvProdDiscPern' + k + '"  min="0" max="100" ' + isDisable +'/>',// oninput="maxCheckGrid2(this)"
                        //        '<input type="number"  txttag="' + items.lstSchemeProduct[k].ProdDiscAmt + '" title="' + items.lstSchemeProduct[k].ProdDiscAmt + '" value="' + parseFloat(items.lstSchemeProduct[k].ProdDiscAmt).toFixed(DecVal) + '" name="ProdDiscAmt"  class="txtsettag ProdDiscAmt gdInput"  id="dgvProdDiscAmt' + k + '"  min="0" ' + isDisable +'/>',
                        //        '<input type="number" txttag="' + items.lstSchemeProduct[k].TradeDiscPern + '" title="' + items.lstSchemeProduct[k].TradeDiscPern + '" value="' + parseFloat(items.lstSchemeProduct[k].TradeDiscPern).toFixed(DecVal) + '" name="TradeDiscPern"  class="txtsettag TradeDiscPern gdInput"  id="dgvTradeDiscPern' + k + '"  min="0" max="100" ' + isDisable +'/>',// oninput="maxCheckGrid2(this)"
                        //        '<input type="number" txttag="' + items.lstSchemeProduct[k].TradeDiscAmt + '" title="' + items.lstSchemeProduct[k].TradeDiscAmt + '" value="' + parseFloat(items.lstSchemeProduct[k].TradeDiscAmt).toFixed(DecVal) + '" name="TradeDiscAmt"  class="txtsettag TradeDiscAmt gdInput"  id="dgvTradeDiscAmt' + k + '"  min="0" ' + isDisable +'/>',
                        //    ]).draw(false);
                        //}                        
                    });
                    var custjsdata = JSON.parse(data[0].lstCustomers);                    
                    $('#tblCustomers').DataTable({
                        scrollY: "250px",
                        scrollX: true,
                        scrollCollapse: true,
                        paging: false,
                        destroy: true,
                        data: custjsdata,
                        fixedColumns: false,
                        searching: true,
                        ordering: true,
                        sorting: false,
                        columns: [
                            { "data": "CustomerID", "autoWidth": true, "visible": false, className: "dt-body-left" },
                            {                               
                                className: "dt-body-center",
                                "mRender": function (data, type, value, meta) {
                                    var rowIndex = meta.row;
                                    var checkboxId = 'chkCustomerCheck_' + rowIndex;//value.CustomerID
                                    var _action = '<input type="checkbox" id="' + checkboxId +'"  name="CustomerCheck" checked ' + isDisable + ' style="" />';
                                    return _action;
                                },
                            },
                            {
                                className: "dt-body-center",
                                "mRender": function (data, type, value, meta) {
                                    var rowIndex = (meta.row+1);
                                    var _action = rowIndex;
                                    return _action;
                                },
                            },
                            {
                                className: "dt-body-left",
                                "mRender": function (data, type, value, meta) {
                                    var rowIndex = meta.row;
                                    var checkboxId = 'dgvCustCode_' + rowIndex;//value.CustomerID
                                    var _action = '<label name="CustomerCode" id="' + checkboxId + '">' + value.Code + '</label>';
                                    return _action;
                                },
                            },
                            {
                                className: "dt-body-left",
                                "mRender": function (data, type, value, meta) {
                                    var rowIndex = meta.row;
                                    var checkboxId = 'dgvCustName_' + rowIndex;//value.CustomerID
                                    var _action = '<label name="CustomerName" id="' + checkboxId + '">' + value.Name + '</label>';
                                    return _action;
                                },
                            },
                            //{ "data": "Code", "autoWidth": true, className: "dt-body-left" },
                            //{ "data": "Name", "autoWidth": true, className: "dt-body-left" }                            
                            
                        ],
                    });
                    TableCustomers = $('#tblCustomers').DataTable();

                    var prodjsdata = JSON.parse(data[0].lstProducts);
                    $('#tblProducts').DataTable({
                        scrollY: "250px",
                        scrollX: true,
                        scrollCollapse: true,
                        paging: false,
                        destroy: true,
                        data: prodjsdata,
                        fixedColumns: false,
                        searching: true,
                        ordering: true,
                        sorting: false,
                        columns: [
                            { "data": "ProductID", "autoWidth": true, "visible": false, className: "dt-body-left" },
                            {
                                className: "dt-body-center",
                                "mRender": function (data, type, value, meta) {
                                    var rowIndex = meta.row;
                                    var checkboxId = 'chkProductsCheck_' + rowIndex;//value.CustomerID
                                    var _action = '<input type="checkbox" id="' + checkboxId + '"  name="CustomerCheck" checked ' + isDisable + ' style="" />';
                                    return _action;
                                },
                            },
                            {
                                className: "dt-body-center",
                                "mRender": function (data, type, value, meta) {
                                    var rowIndex = (meta.row + 1);
                                    var _action = rowIndex;
                                    return _action;
                                },
                            },
                            //{ "data": "Code", "autoWidth": true, className: "dt-body-left" },
                            //{ "data": "Name", "autoWidth": true, className: "dt-body-left" },
                            {
                                className: "dt-body-left",
                                "mRender": function (data, type, value, meta) {
                                    var rowIndex = meta.row;
                                    var checkboxId = 'dgvProdCode_' + rowIndex;//value.CustomerID
                                    var _action = '<label name="ProductCode" id="' + checkboxId + '">' + value.Code + '</label>';
                                    return _action;
                                },
                            },
                            {
                                className: "dt-body-left",
                                "mRender": function (data, type, value, meta) {
                                    var rowIndex = meta.row;
                                    var checkboxId = 'dgvProdName_' + rowIndex;//value.CustomerID
                                    var _action = '<label name="ProductName" id="' + checkboxId + '">' + value.Name + '</label>';
                                    return _action;
                                },
                            },
                            {
                                className: "dt-body-right",
                                "mRender": function (data, type, value, meta) {
                                    var rowIndex = meta.row;
                                    var fid = 'chkProductsDiscPern_' + rowIndex;
                                    var _action = '<input type="number" txttag="' + value.ProdDiscPern + '" title="' + value.ProdDiscPern + '" value="' + parseFloat(value.ProdDiscPern).toFixed(DecVal) + '" name="ProdDiscPern"  class="txtsettag ProdDiscPern gdInput"  id="' + fid + '"  min="0" max="100" ' + isDisable + '/>';
                                    return _action;
                                },
                            },
                            {
                                className: "dt-body-right",
                                "mRender": function (data, type, value, meta) {
                                    var rowIndex = meta.row;
                                    var fid = 'chkProductsDiscAmt_' + rowIndex;
                                    var _action = '<input type="number" txttag="' + value.ProdDiscAmt + '" title="' + value.ProdDiscAmt + '" value="' + parseFloat(value.ProdDiscAmt).toFixed(DecVal) + '" name="ProdDiscAmt"  class="txtsettag ProdDiscAmt gdInput"  id="' + fid + '"  min="0" max="100" ' + isDisable + '/>';
                                    return _action;
                                },
                            },
                            {
                                className: "dt-body-right",
                                "mRender": function (data, type, value, meta) {
                                    var rowIndex = meta.row;
                                    var fid = 'chkTradeDiscPern_' + rowIndex;
                                    var _action = '<input type="number" txttag="' + value.TradeDiscPern + '" title="' + value.TradeDiscPern + '" value="' + parseFloat(value.TradeDiscPern).toFixed(DecVal) + '" name="TradeDiscPern"  class="txtsettag TradeDiscPern gdInput"  id="' + fid + '"  min="0" max="100" ' + isDisable + '/>';
                                    return _action;
                                },
                            },
                            {
                                className: "dt-body-right",
                                "mRender": function (data, type, value, meta) {
                                    var rowIndex = meta.row;
                                    var fid = 'chkTradeDiscAmt_' + rowIndex;
                                    var _action = '<input type="number" txttag="' + value.TradeDiscAmt + '" title="' + value.TradeDiscAmt + '" value="' + parseFloat(value.TradeDiscAmt).toFixed(DecVal) + '" name="TradeDiscAmt"  class="txtsettag TradeDiscAmt gdInput"  id="' + fid + '"  min="0" max="100" ' + isDisable + '/>';
                                    return _action;
                                },
                            },
                        ],
                    });
                    TableProducts = $('#tblProducts').DataTable();
                }
            }
        });
    }

    function maxCheckGrid1(object) {
        if (parseFloat(object.value) > parseFloat(object.max))
        {
            showErrorSnackbar("Amount Mismatched");
            updateInputColumn(object.id, 0);
        }
        else if (parseFloat(object.value) < 0)
        {
            showErrorSnackbar("Amount Shold be greater than Zero");
            updateInputColumn(object.id, 0);
        }
        calculateGrid1Value();
    }
    function maxCheckGrid2(object) {
        var dTotAdjAmt = parseFloat(document.getElementById("txtTotAdjustmentAmount").getAttribute("txttag"));
        if (parseFloat(dTotAdjAmt) > 0) {
            showErrorSnackbar("Amount Mismatched. Adjustment Amount should be greater than zero");
            updateInputColumn(object.id, 0);
        }
        else if (parseFloat(object.value) > parseFloat(object.max)) {
            showErrorSnackbar("Amount Mismatched");
            updateInputColumn(object.id, 0);
        }
        else if (parseFloat(object.value) < 0) {
            showErrorSnackbar("Amount Shold be greater than Zero");
            updateInputColumn(object.id, 0);
        }
        calculateGrid2Value();
    }
    //$('#chkSelectAllCustomers').click(function () {
    $(document).on("click", "#chkSelectAllCustomers", function () {
        var IsChk = $('#chkSelectAllCustomers').is(':checked');
        //alert(IsChk);
        $('#tblCustomers tr td input').each(function (i, items) {
            items.checked = IsChk;
        });
    });
    $('#chkSelectAllCustomersView').click(function () {
        var IsChk = $('#chkSelectAllCustomersView').is(':checked');
        //alert(IsChk);
        $('#tblCustomersView tr td input').each(function (i, items) {
            items.checked = IsChk;
        });
    });
    //$('#chkSelectAllProduct').click(function () {
    $(document).on("click", "#chkSelectAllProduct", function () {
        var IsChk = $('#chkSelectAllProduct').is(':checked');
        //alert(IsChk);
        $('#tblProducts tr td input').each(function (i, items) {
            items.checked = IsChk;
        });
    });
    $('#chkSelectAllProductView').click(function () {
        var IsChk = $('#chkSelectAllProductView').is(':checked');
        //alert(IsChk);
        $('#tblProductsView tr td input').each(function (i, items) {
            items.checked = IsChk;
        });
    });
    //$("#btnAddCustomers").click(function () {
    $(document).on("click", "#btnAddCustomers", function () {
            var chkanyone = false, IsValid = true, AlreadyExists = false;
            if (TableCustomers.rows().count() > 0) {
                $('#tblCustomers tbody tr').each(function () {
                    $(this).css("color", "black");
                    rowdata = TableCustomers.row($(this)).data();
                    nCustID = rowdata[0];
                    var currrowchecked = false;
                    $(this).find("input[type=checkbox]").each(function (index) {
                        if ($(this).is(":checked")) {
                            chkanyone = true;
                            currrowchecked = true;
                        }
                    });
                    if (currrowchecked) {
                        var existcust = ArrSelectCustomers.filter(t => t.CustomerID == nCustID).length > 0;
                        if (existcust) {
                            $(this).css("color", "red");
                            AlreadyExists = true;
                        }
                    }
                });
                if (!chkanyone) {
                    showErrorSnackbar("Check anyone customer");
                    IsValid = false;
                }
                if (AlreadyExists) {
                    showErrorSnackbar("This Customers already added");
                    IsValid = false;
                }
                if (IsValid) {
                    addSelectCustomersinArray();
                }
            }
            else {
                showErrorSnackbar("No data found");
            }
        });

   $("#btnViewpopupaccept").click(function () {    
        var WhatCheck = $("#rdoCustomer").is(":checked") ? 1 : 2;
        if (WhatCheck == 1) {//customer view accept
            ArrSelectCustomers = [];
            var nCustID = 0;
            $("#tblCustomersView tbody tr").each(function () {
                var allValues = {};
                var chekdoc = false;
                rowdata = TableCustomersView.row($(this)).data();
                nCustID = rowdata[0];
                var strCode = "", strName = "";
                $(this).find("label").each(function (index) {
                    const fieldName = $(this).attr("name");
                    const fieldID = $(this).attr("id");
                    if (fieldName == "CustomerCode") {
                        strCode = $(this).text();
                    }
                    if (fieldName == "CustomerName") {
                        strName = $(this).text();
                    }
                });
                $(this).find("input[type=checkbox]").each(function (index) {
                    chekdoc = $(this).is(":checked");
                });
                if (chekdoc) {
                    var listCustomer = {
                        "CustomerID": nCustID,
                        "Code": strCode,
                        "Name": strName,
                    }
                    ArrSelectCustomers.push(listCustomer);
                }
            });
            TableCustomersView.draw().clear(); TableCustomersView.draw().clear();
            if (ArrSelectCustomers.length == 0) {
                $("#btnViewCustomers").hide();
            }
        } else {//product view accept
            ArrSelectProducts = [];
            $("#tblProductsView tbody tr").each(function () {
                var allValues = {};
                var chekdoc = false;
                rowdata = TableProductsView.row($(this)).data();
                var nProdID = rowdata[0];
                var strCode = "", Name = "", dProdDiscPern = "0", dProdDiscAmt = "0", dTradeDiscPern = "0", dTradeDiscAmt = "0";
                $(this).find("label").each(function (index) {
                    const fieldName = $(this).attr("name");
                    const fieldID = $(this).attr("id");
                    if (fieldName == "ProductCode") {
                        strCode = $(this).text();
                    }
                    if (fieldName == "ProductName") {
                        strName = $(this).text();
                    }
                });
                $(this).find("input[type=number]").each(function (index) {
                    const fieldName = $(this).attr("name");
                    const fieldID = $(this).attr("id");
                    if (fieldName == "ProdDiscPern") {
                        dProdDiscPern = $(this).attr("txttag");
                    }
                    if (fieldName == "ProdDiscAmt") {
                        dProdDiscAmt = $(this).attr("txttag");
                    }
                    if (fieldName == "TradeDiscPern") {
                        dTradeDiscPern = $(this).attr("txttag");
                    }
                    if (fieldName == "TradeDiscAmt") {
                        dTradeDiscAmt = $(this).attr("txttag");
                    }
                });
                $(this).find("input[type=checkbox]").each(function (index) {
                    chekdoc = $(this).is(":checked");
                });
                if (chekdoc) {
                    var listProducts = {
                        "ProductID": nProdID,
                        "Code": strCode,
                        "Name": strName,
                        "ProdDiscPern": dProdDiscPern,
                        "ProdDiscAmt": dProdDiscAmt,
                        "TradeDiscPern": dTradeDiscPern,
                        "TradeDiscAmt": dTradeDiscAmt,
                    }
                    ArrSelectProducts.push(listProducts);
                }
            });
            $("#chkSelectAllProduct").prop("checked", false);
            TableProductsView.draw().clear(); TableProductsView.draw().clear();
            if (ArrSelectProducts.length == 0) {
                $("#btnViewProducts").hide();
            }
        }
        updateInputColumn("txtProdDiscPernView", 0); updateInputColumn("txtProdDiscAmountView", 0);
        updateInputColumn("txtTradeDiscPernView", 0); updateInputColumn("txtTradeDiscAmountView", 0);
        modalPinfo.style.display = "none";
    });
    
    //$("#btnViewCustomers").click(function () { 
    $(document).on("click", "#btnViewCustomers", function () {
        if (ArrSelectCustomers.length > 0) {
            $("#dvProducts").hide(); $("#dvCustomers").show();
            $("#lblPopupheading").text("Customers");
            TableCustomersView.draw().clear(); TableCustomersView.draw().clear();
            for (var i = 0; i < ArrSelectCustomers.length; i++) {
                TableCustomersView.row.add([
                    ArrSelectCustomers[i].CustomerID,
                    '<input type="checkbox" id="chkCustomerCheckview' + i + '"  name="ViewCustomerCheck" checked/>',
                    (i + 1),
                    '<label name="CustomerCode" id="dgvViewCustCode' + i + '">' + ArrSelectCustomers[i].Code + '</label>',
                    '<label name="CustomerName" id="dgvViewCustName' + i + '">' + ArrSelectCustomers[i].Name + '</label>',
                ]).draw(false);
            }
            modalPinfo.style.display = "block";            
            $("#chkSelectAllCustomersView").prop("checked", true);
        } else {
            modalPinfo.style.display = "none";
            showErrorSnackbar("No customers found");
        }
    });
    $("#btnViewCustomers").hide();
    var ArrSelectCustomers = [];
    function addSelectCustomersinArray() {        
        var nCustID = 0;
        $("#tblCustomers tbody tr").each(function () {
            var allValues = {};
            var chekdoc = false;
            rowdata = TableCustomers.row($(this)).data();
            nCustID = rowdata.CustomerID;
            var strCode = "", strName = "";
            $(this).find("label").each(function (index) {
                const fieldName = $(this).attr("name");
                const fieldID = $(this).attr("id");
                if (fieldName == "CustomerCode") {
                    strCode = $(this).text();
                }
                if (fieldName == "CustomerName") {
                    strName = $(this).text();
                }
            });
            $(this).find("input[type=checkbox]").each(function (index) {
                chekdoc = $(this).is(":checked");
            });
            if (chekdoc) {
                var listCustomer = {
                    "CustomerID": nCustID,
                    "Code": strCode,
                    "Name": strName,
                }
                ArrSelectCustomers.push(listCustomer);
            }
        });
        TableCustomers.draw().clear(); TableCustomers.draw().clear();
        if (ArrSelectCustomers.length > 0) {
            $("#btnViewCustomers").show();
        }
        $("#chkSelectAllCustomers").prop("checked", false);
    }
    //$("#btnAddProduct").click(function () {
    $(document).on("click", "#btnAddProduct", function () {
        var chkanyone = false, IsValid = true, AlreadyExists = false;
        if (TableProducts.rows().count() > 0) {
            $('#tblProducts tbody tr').each(function () {
                $(this).css("color", "black");
                rowdata = TableProducts.row($(this)).data();
                var nProdid = rowdata[0];
                var currrowchecked = false;
                $(this).find("input[type=checkbox]").each(function (index) {
                    if ($(this).is(":checked")) {
                        chkanyone = true;
                        currrowchecked = true;
                    }
                });
                if (currrowchecked) {
                    var existcust = ArrSelectProducts.filter(t => t.ProductID == nProdid).length > 0;
                    if (existcust) {
                        $(this).css("color", "red");
                        AlreadyExists = true;
                    }
                }
            });
            if (!chkanyone) {
                showErrorSnackbar("Check anyone product");
                IsValid = false;
            }
            if (AlreadyExists) {
                showErrorSnackbar("This Products already added");
                IsValid = false;
            }
            if (IsValid) {
                addSelectProductsinArray();
            }
        }
        else {
            showErrorSnackbar("No data found");
        }
    });
    $("#btnViewProducts").hide();
    var ArrSelectProducts = [];
    function addSelectProductsinArray() {       
        $("#tblProducts tbody tr").each(function () {
            var allValues = {};
            var chekdoc = false;
            rowdata = TableProducts.row($(this)).data();
            var nProdID = rowdata.ProductID;//[0];
            var strCode = "", strName = "", dProdDiscPern = "0", dProdDiscAmt = "0", dTradeDiscPern = "0", dTradeDiscAmt = "0";
            $(this).find("label").each(function (index) {
                const fieldName = $(this).attr("name");
                const fieldID = $(this).attr("id");
                if (fieldName == "ProductCode") {                    
                    strCode = $(this).text();
                    console.log("Code : ", strCode);
                }
                if (fieldName == "ProductName") {
                    strName = $(this).text();
                    console.log("Name : ", strName);
                }
            });
            $(this).find("input[type=number]").each(function (index) {
                const fieldName = $(this).attr("name");
                const fieldID = $(this).attr("id");
                if (fieldName == "ProdDiscPern") {
                    dProdDiscPern = $(this).attr("txttag");
                }
                if (fieldName == "ProdDiscAmt") {
                    dProdDiscAmt = $(this).attr("txttag");
                }
                if (fieldName == "TradeDiscPern") {
                    dTradeDiscPern = $(this).attr("txttag");
                }
                if (fieldName == "TradeDiscAmt") {
                    dTradeDiscAmt = $(this).attr("txttag");
                }
            });
            $(this).find("input[type=checkbox]").each(function (index) {
                chekdoc = $(this).is(":checked");
            });
            if (chekdoc) {
                var listProducts = {
                    "ProductID": nProdID,
                    "Code": strCode,
                    "Name": strName,
                    "ProdDiscPern": dProdDiscPern,
                    "ProdDiscAmt": dProdDiscAmt,
                    "TradeDiscPern": dTradeDiscPern,
                    "TradeDiscAmt": dTradeDiscAmt,
                }
                ArrSelectProducts.push(listProducts);
            }
        });
        $("#chkSelectAllProduct").prop("checked", false);
        TableProducts.draw().clear(); TableProducts.draw().clear();
        if (ArrSelectProducts.length > 0) {
            $("#btnViewProducts").show();
        }
        updateInputColumn("txtProdDiscPern", 0); updateInputColumn("txtProdDiscAmount", 0);
        updateInputColumn("txtTradeDiscPern", 0); updateInputColumn("txtTradeDiscAmount", 0);
    }
    //$("#btnViewProducts").click(function () {
    $(document).on("click", "#btnViewProducts", function () {
        if (ArrSelectProducts.length > 0) {
            $("#dvProducts").show(); $("#dvCustomers").hide();
            $("#lblPopupheading").text("Products");
            TableProductsView.draw().clear(); TableProductsView.draw().clear();
            for (var i = 0; i < ArrSelectProducts.length; i++) {
                TableProductsView.row.add([
                    ArrSelectProducts[i].ProductID,
                    '<input type="checkbox" id="ViewchkProductsCheck' + i + '"  name="ProductsCheck" checked/>',
                    (i + 1),
                    '<label name="ProductCode" id="dgvViewProdCode' + i + '">' + ArrSelectProducts[i].Code + '</label>',
                    '<label name="ProductName" id="dgvViewProdName' + i + '">' + ArrSelectProducts[i].Name + '</label>',
                    '<input type="number" txttag="' + ArrSelectProducts[i].ProdDiscPern + '" title="' + ArrSelectProducts[i].ProdDiscPern + '" value="' + parseFloat(ArrSelectProducts[i].ProdDiscPern).toFixed(DecVal) + '" name="ProdDiscPern"  class="txtsettag ProdDiscPern gdInput"  id="dgvViewProdDiscPern' + i + '"  min="0" max="100"/>',// oninput="maxCheckGrid2(this)"
                    '<input type="number"  txttag="' + ArrSelectProducts[i].ProdDiscAmt + '" title="' + ArrSelectProducts[i].ProdDiscAmt + '" value="' + parseFloat(ArrSelectProducts[i].ProdDiscAmt).toFixed(DecVal) + '" name="ProdDiscAmt"  class="txtsettag ProdDiscAmt gdInput"  id="dgvViewProdDiscAmt' + i + '"  min="0"/>',
                    '<input type="number" txttag="' + ArrSelectProducts[i].TradeDiscPern + '" title="' + ArrSelectProducts[i].TradeDiscPern + '" value="' + parseFloat(ArrSelectProducts[i].TradeDiscPern).toFixed(DecVal) + '" name="TradeDiscPern"  class="txtsettag TradeDiscPern gdInput"  id="dgvViewTradeDiscPern' + i + '"  min="0" max="100"/>',// oninput="maxCheckGrid2(this)"
                    '<input type="number" txttag="' + ArrSelectProducts[i].TradeDiscAmt + '" title="' + ArrSelectProducts[i].TradeDiscAmt + '" value="' + parseFloat(ArrSelectProducts[i].TradeDiscAmt).toFixed(DecVal) + '" name="TradeDiscAmt"  class="txtsettag TradeDiscAmt gdInput"  id="dgvViewTradeDiscAmt' + i + '"  min="0"/>',
                ]).draw(false);
            }
            modalPinfo.style.display = "block";
            $("#chkSelectAllProductView").prop("checked", true);
        } else {
            modalPinfo.style.display = "none";
            showErrorSnackbar("No products found");
        }
    });

    $('#btnLoadProductFilter,#btnLoadCustomerFilter').click(function (e) {
        GetFilterData(1);
    });
    function GetFilterData(ClickType = 0) {//arrVendorName,divErrFTo,divErrFFrom,divErrFParty
        var IsValid = true;
        $(".clrdivs").html("");
        //rdoCustomer,rdoProduct
        var rdoChkID = $("#rdoCustomer").is(":checked") ? 1 : 2;
        var strCustTypeorManuf = '', strBeatorBrand = '', strSalesmanorCategory = '',
            strCustomerorProduct = '';
        if (rdoChkID == 1) // customer 
        {
            //txtCustomerType - divErrCustomerType,txtBeat - divErrBeat, txtSalesman - divErrSalesman,txtCustomer - divErrCustomer
            if ($("#txtCustomerType").val() != "") {
                var pd = arrCustType.filter(t => t.name == $("#txtCustomerType").val().trim());
                const exists = pd.length > 0;
                if (!exists) {
                    IsValid = false;
                    $("#divErrCustomerType").html("Select Customer Type from list");
                }
                else {
                    strCustTypeorManuf = $("#txtCustomerType").val().trim();
                }
            }
            if ($("#txtBeat").val() != "") {
                var pd = arrBeat.filter(t => t.name == $("#txtBeat").val().trim());
                const exists = pd.length > 0;
                if (!exists) {
                    IsValid = false;
                    $("#divErrBeat").html("Select Beat Name from list");
                }
                else {
                    strBeatorBrand = $("#txtBeat").val().trim();
                }
            }
            if ($("#txtSalesman").val() != "") {
                var pd = arrSalesman.filter(t => t.name == $("#txtSalesman").val().trim());
                const exists = pd.length > 0;
                if (!exists) {
                    IsValid = false;
                    $("#divErrSalesman").html("Select Salesman Name from list");
                }
                else {
                    strSalesmanorCategory = $("#txtSalesman").val().trim();
                }
            }
            if ($("#txtCustomer").val() != "") {
                var pd = arrCustomer.filter(t => t.name == $("#txtCustomer").val().trim());
                const exists = pd.length > 0;
                if (!exists) {
                    IsValid = false;
                    $("#divErrCustomer").html("Select Customer Name from list");
                }
                else {
                    strCustomerorProduct = $("#txtCustomer").val().trim();
                }
            }
        }
        else if (rdoChkID == 2)// Product
        {
            //txtManuf - divErrorOnManuf,txtBrand - divErrorOnBrand,txtCategory - divErrorOnCategory,txtProduct - divErrProduct
            if ($("#txtManuf").val() != "") {
                var pd = arrManuf.filter(t => t.name == $("#txtManuf").val().trim());
                const exists = pd.length > 0;
                if (!exists) {
                    IsValid = false;
                    $("#divErrCustomerType").html("Select Manufacturer Name from list");
                }
                else {
                    strCustTypeorManuf = $("#txtManuf").val().trim();
                }
            }
            if ($("#txtBrand").val() != "") {
                var pd = arrBrand.filter(t => t.name == $("#txtBrand").val().trim());
                const exists = pd.length > 0;
                if (!exists) {
                    IsValid = false;
                    $("#divErrorOnBrand").html("Select Brand Name from list");
                }
                else {
                    strBeatorBrand = $("#txtBrand").val().trim();
                }
            }
            if ($("#txtCategory").val() != "") {
                var pd = arrCategory.filter(t => t.name == $("#txtCategory").val().trim());
                const exists = pd.length > 0;
                if (!exists) {
                    IsValid = false;
                    $("#divErrorOnCategory").html("Select Category Name from list");
                }
                else {
                    strSalesmanorCategory = $("#txtCategory").val().trim();
                }
            }
            if ($("#txtProduct").val() != "") {
                var pd = arrProduct.filter(t => t.name == $("#txtProduct").val().trim());
                const exists = pd.length > 0;
                if (!exists) {
                    IsValid = false;
                    $("#divErrProduct").html("Select Product Name from list");
                }
                else {
                    strCustomerorProduct = $("#txtProduct").val().trim();
                }
            }
        }
        if (IsValid) {            
            $.ajax({
                url: Aurl + "discountscheme/getfilterdata",
                type: 'get',
                contentType: 'json',
                data: {
                    Mode: 4, Type: rdoChkID, CustTypeorManuf: strCustTypeorManuf,
                    BeatorBrand: strBeatorBrand, SalesmanorCategory: strSalesmanorCategory,
                    CustomerorProduct: strCustomerorProduct
                },
                xhrFields: {
                    withCredentials: true
                },
                success: function (data) {                                        
                    if (rdoChkID == 1) {
                        var custjsdata = eval(data);
                        console.log(custjsdata);
                        $('#tblCustomers').DataTable({
                            scrollY: "250px",
                            scrollX: true,
                            scrollCollapse: true,
                            paging: false,
                            destroy: true,
                            data: custjsdata,
                            fixedColumns: false,
                            searching: true,
                            ordering: true,
                            sorting: false,
                            columns: [
                                { "data": "CustomerID", "autoWidth": true, "visible": false, className: "dt-body-left" },
                                {
                                    className: "dt-body-center",
                                    "mRender": function (data, type, value, meta) {
                                        var rowIndex = meta.row;
                                        var checkboxId = 'chkCustomerCheck_' + rowIndex;//value.CustomerID
                                        var _action = '<input type="checkbox" id="' + checkboxId + '"  name="CustomerCheck" style="" />';
                                        return _action;
                                    },
                                },
                                {
                                    className: "dt-body-center",
                                    "mRender": function (data, type, value, meta) {
                                        var rowIndex = (meta.row + 1);
                                        var _action = rowIndex;
                                        return _action;
                                    },
                                },
                                //{ "data": "Code", "autoWidth": true, className: "dt-body-left" },
                                //{ "data": "Name", "autoWidth": true, className: "dt-body-left" }
                                {
                                    className: "dt-body-left",
                                    "mRender": function (data, type, value, meta) {
                                        var rowIndex = meta.row;
                                        var checkboxId = 'dgvCustCode_' + rowIndex;//value.CustomerID
                                        var _action = '<label name="CustomerCode" id="' + checkboxId + '">' + value.Code + '</label>';
                                        return _action;
                                    },
                                },
                                {
                                    className: "dt-body-left",
                                    "mRender": function (data, type, value, meta) {
                                        var rowIndex = meta.row;
                                        var checkboxId = 'dgvCustName_' + rowIndex;//value.CustomerID
                                        var _action = '<label name="CustomerName" id="' + checkboxId + '">' + value.Name + '</label>';
                                        return _action;
                                    },
                                },
                            ],
                        });
                        TableCustomers = $('#tblCustomers').DataTable();
                        if (custjsdata.length == 0) {
                            showErrorSnackbar("No data found");
                        }
                    } else {
                        var prodjsdata = eval(data);
                        $('#tblProducts').DataTable({
                            scrollY: "250px",
                            scrollX: true,
                            scrollCollapse: true,
                            paging: false,
                            destroy: true,
                            data: prodjsdata,
                            fixedColumns: false,
                            searching: true,
                            ordering: true,
                            sorting: false,
                            columns: [
                                { "data": "ProductID", "autoWidth": true, "visible": false, className: "dt-body-left" },
                                {
                                    className: "dt-body-center",
                                    "mRender": function (data, type, value, meta) {
                                        var rowIndex = meta.row;
                                        var checkboxId = 'chkProductsCheck_' + rowIndex;//value.CustomerID
                                        var _action = '<input type="checkbox" id="' + checkboxId + '"  name="ProductCheck" style="" />';
                                        return _action;
                                    },
                                },
                                {
                                    className: "dt-body-center",
                                    "mRender": function (data, type, value, meta) {
                                        var rowIndex = (meta.row + 1);
                                        var _action = rowIndex;
                                        return _action;
                                    },
                                },
                                {
                                    className: "dt-body-left",
                                    "mRender": function (data, type, value, meta) {
                                        var rowIndex = meta.row;
                                        var checkboxId = 'dgvProdCode_' + rowIndex;//value.CustomerID
                                        var _action = '<label name="ProductCode" id="' + checkboxId + '">' + value.Code + '</label>';
                                        return _action;
                                    },
                                },
                                {
                                    className: "dt-body-left",
                                    "mRender": function (data, type, value, meta) {
                                        var rowIndex = meta.row;
                                        var checkboxId = 'dgvProdName_' + rowIndex;//value.CustomerID
                                        var _action = '<label name="ProductName" id="' + checkboxId + '">' + value.Name + '</label>';
                                        return _action;
                                    },
                                },
                                {
                                    className: "dt-body-right",
                                    "mRender": function (data, type, value, meta) {
                                        var rowIndex = meta.row;
                                        var fid = 'chkProductsDiscPern_' + rowIndex;
                                        var _action = '<input type="number" txttag="0" title="0" value="" name="ProdDiscPern"  class="txtsettag ProdDiscPern gdInput"  id="' + fid + '"  min="0" max="100"/>';
                                        return _action;
                                    },
                                },
                                {
                                    className: "dt-body-right",
                                    "mRender": function (data, type, value, meta) {
                                        var rowIndex = meta.row;
                                        var fid = 'chkProductsDiscAmt_' + rowIndex;
                                        var _action = '<input type="number" txttag="0" title="0" value="" name="ProdDiscAmt"  class="txtsettag ProdDiscAmt gdInput"  id="' + fid + '"  min="0" max="100"/>';
                                        return _action;
                                    },
                                },
                                {
                                    className: "dt-body-right",
                                    "mRender": function (data, type, value, meta) {
                                        var rowIndex = meta.row;
                                        var fid = 'chkTradeDiscPern_' + rowIndex;
                                        var _action = '<input type="number" txttag="0" title="0" value="" name="TradeDiscPern"  class="txtsettag TradeDiscPern gdInput"  id="' + fid + '"  min="0" max="100"/>';
                                        return _action;
                                    },
                                },
                                {
                                    className: "dt-body-right",
                                    "mRender": function (data, type, value, meta) {
                                        var rowIndex = meta.row;
                                        var fid = 'chkTradeDiscAmt_' + rowIndex;
                                        var _action = '<input type="number" txttag="0" title="0" value="" name="TradeDiscAmt"  class="txtsettag TradeDiscAmt gdInput"  id="' + fid + '"  min="0" max="100"/>';
                                        return _action;
                                    },
                                },
                            ],
                        });
                        TableProducts = $('#tblProducts').DataTable();
                        if (prodjsdata.length == 0) {
                            showErrorSnackbar("No data found");
                        }
                    }
                }
                , error: function (data) {
                    console.log("error ", data);
                }
            });
        }
    }
    $('#tblMasterData tbody').on('click', '.clsView', function (e) {
        nTransMode = 3;
        $(".clrdiv").html("");
        $("#lblPopupheading").text("View " + $("#MainHeading").text());
        rowdata = Table.row($(this).parents('tr')).data();
        var selrow = Table.row($(this).parents('tr')).index();
        var ID = rowdata.ID;//[0];
        $("#txtID").val(ID);
        GetData(3, ID);
        $("#dvMain").show();
        $("#dvDocuments").hide();
        $(".FormclrField,.FormclrcmbField").prop("disabled", true);
        $("input[type=checkbox],#btnSave,#btnClear").prop("disabled", true);        
        $(".clrdivs").html("");
        $("#btnAddCustomers,#btnAddProduct").hide();
        $("#btnViewCustomers,#btnViewProducts").hide();
    });

    $('#tblMasterData tbody').on('click', '.clsEdit', function (e) {
        nTransMode = 2;
        $("#lblPopupheading").text("Edit " + $("#MainHeading").text());
        rowdata = Table.row($(this).parents('tr')).data();
        var ID = rowdata.ID;//[0];
        $("#txtID").val(ID);
        GetData(3, ID);
        $(".FormclrField,.FormclrcmbField").prop("disabled", false);
        $("input[type=checkbox],#chkActive,#btnSave").prop("disabled", false);
        $("#btnClear").prop("disabled", true);
        $("#dvMain").show();
        $("#dvDocuments").hide();
        $(".clrdivs").html("");
        $("#btnAddCustomers,#btnAddProduct").show();
        $("#btnViewCustomers,#btnViewProducts").hide();
    });
    $('#tblMasterData tbody').on('click', '.clsVariant', function (e) {
        nTransMode = 1;
        $("#lblPopupheading").text("Variant " + $("#MainHeading").text());      
        rowdata = Table.row($(this).parents('tr')).data();
        var ID = rowdata.ID;//[0];
        GetData(3, ID, true);
        $("#txtID").val(ID);
        $("#dvMain").show();
        $("#dvDocuments").hide();
        $(".FormclrField,.FormclrcmbField").prop("disabled", false);
        $("input[type=checkbox],#chkActive,#btnSave,#btnClear").prop("disabled", false);
        $("#txtCode,#txtName,#txtEAN").val("");
        $(".clrdivs").html("");
        $("#btnAddCustomers,#btnAddProduct").show();
        $("#btnViewCustomers,#btnViewProducts").hide();
        $("#chkActive").prop("disabled", nTransMode != 2);
        $("#chkDefault").prop("checked", true);
    });
    
    
    $("#btnClearCustomerFilter").click(function () {
        $(".txtCustFilterField").val(""); 
        $(".clrdivs").html("");
    }); 
    $("#btnClearProductFilter").click(function () {
        $(".txtProdFilterField").val("");
        $(".clrdivs").html("");
    }); 
    $("#btnClear").click(function () {
        //ClearForm();
        if (cfFocus != 3) { ClearConfirmDialogMsg("Do you want to clear?"); } else { ClearForm(); }
    });   
    function ClearForm() {
        ProductRID = 0;
        $(".FormclrField").val("");
        $(".FormclrcmbField").val(0);
        $(".clrdivs").html("");
        $(".FormclrField,.FormclrcmbField,#btnSave,#btnClear,#btnDraft,#btnClose,input[type=checkbox]").prop("disabled", false);          
        // ceil - always Up value, floor - always down value        
        //Table.draw().clear();
        TableCustomers.draw().clear(); TableCustomers.draw().clear();
        TableProducts.draw().clear(); TableProducts.draw().clear();
        GetData(1);
        GetData(2);
        SetTagZero();      
        nIsDraft = 0;
        DocsArray = [];
        TempProd = [];
        if (nTransMode != 1) {
            $("#dvMain").hide();
            $("#dvDocuments").show();
        }
        setDate("dtpFFrom", 0);
        setDate("dtpFTo", 0);     
        $("#chkActive").prop("checked", true);
        $("#chkActive").prop("disabled", nTransMode != 2);
        $("chkReplaceExists").prop("disabled", false);
        $("#MainHeading").text($("#txtFormName").val());
        ArrSelectCustomers = [], ArrSelectProducts = [];
        $("#btnAddCustomers,#btnAddProduct").show();
        $("#btnViewCustomers,#btnViewProducts").hide();
    }
    function displayResult(item) {
        $('.alert').show().html('You selected <strong>' + item.value + '</strong>: <strong>' + item.text + '</strong>');
    }
    function SetAutlistforFields() {
        ////txtCustomerType,txtBeat,txtSalesman,txtCustomer
        $("#txtCustomerType").autocomplete({
            minLength: 0, autoFocus: true,
            source: arrCustType,            
            select: function (event, ui) {
                $("#txtCustomerType").val(ui.item.name);
                return false;
            },
        }).autocomplete("instance")._renderItem = function (ul, item) {
            return $("<li class='each'>")
                .append("<div class='acItem'><span class='name'>" +
                    item.label + "</span></div>")
                .appendTo(ul);
        };
        $("#txtBeat").autocomplete({
            minLength: 0, autoFocus: true,
            source: arrBeat,            
            select: function (event, ui) {
                $("#txtBeat").val(ui.item.name);
                return false;
            },
        }).autocomplete("instance")._renderItem = function (ul, item) {
            return $("<li class='each'>")
                .append("<div class='acItem'><span class='name'>" +
                    item.label + "</span></div>")
                .appendTo(ul);
            };

        $("#txtSalesman").autocomplete({
            minLength: 0, autoFocus: true,
            source: arrSalesman,
            select: function (event, ui) {
                $("#txtSalesman").val(ui.item.name);
                return false;
            },
        }).autocomplete("instance")._renderItem = function (ul, item) {
            return $("<li class='each'>")
                .append("<div class='acItem'><span class='name'>" +
                    item.label + "</span></div>")
                .appendTo(ul);
        };
        $("#txtCustomer").autocomplete({
            minLength: 0, autoFocus: true,
            source: arrCustomer,
            select: function (event, ui) {
                $("#txtCustomer").val(ui.item.name);
                return false;
            },
        }).autocomplete("instance")._renderItem = function (ul, item) {
            return $("<li class='each'>")
                .append("<div class='acItem'><span class='name'>" +
                    item.label + "</span></div>")
                .appendTo(ul);
            };
        //prod
        //txtManuf,txtBrand,txtCategory,txtProduct
        $("#txtManuf").autocomplete({
            minLength: 0, autoFocus: true,
            source: arrManuf,
            select: function (event, ui) {
                $("#txtManuf").val(ui.item.name);
                return false;
            },
        }).autocomplete("instance")._renderItem = function (ul, item) {
            return $("<li class='each'>")
                .append("<div class='acItem'><span class='name'>" +
                    item.label + "</span></div>")
                .appendTo(ul);
        };
        $("#txtBrand").autocomplete({
            minLength: 0, autoFocus: true,
            source: arrBrand,
            select: function (event, ui) {
                $("#txtBrand").val(ui.item.name);
                return false;
            },
        }).autocomplete("instance")._renderItem = function (ul, item) {
            return $("<li class='each'>")
                .append("<div class='acItem'><span class='name'>" +
                    item.label + "</span></div>")
                .appendTo(ul);
        };

        $("#txtCategory").autocomplete({
            minLength: 0, autoFocus: true,
            source: arrCategory,
            select: function (event, ui) {
                $("#txtCategory").val(ui.item.name);
                return false;
            },
        }).autocomplete("instance")._renderItem = function (ul, item) {
            return $("<li class='each'>")
                .append("<div class='acItem'><span class='name'>" +
                    item.label + "</span></div>")
                .appendTo(ul);
        };
        $("#txtProduct").autocomplete({
            minLength: 0, autoFocus: true,
            source: arrProduct,
            select: function (event, ui) {
                $("#txtProduct").val(ui.item.name);
                return false;
            },
        }).autocomplete("instance")._renderItem = function (ul, item) {
            return $("<li class='each'>")
                .append("<div class='acItem'><span class='name'>" +
                    item.label + "</span></div>")
                .appendTo(ul);
        };
    }
    
    $("#btnSave").click(function () {        
        if (cfFocus != 3) {
            if (SaveValidation()) {
                ConfirmDialogMsg("Do you want to save data?");
            }
        } else {
            if (SaveValidation()) {
                SaveData();
            }
        }
    });    
    function SaveValidation() {
        var IsValid = true;
        $(".clrdivs").html("");
        if ($("#txtName").val() == "") {
            IsValid = false;
            $("#divErrName").html("Name should not be empty");
            showErrorSnackbar("Name should not be empty");
        }       
        if ($("#dtpFFrom").val() == "") {
            IsValid = false;
            $("#divErrFFrom").html("From date should not be empty");
            showErrorSnackbar("From date should not be empty");
        }
        if ($("#dtpFTo").val() == "") {
            IsValid = false;
            $("#divErrFTo").html("To date should not be empty");
            showErrorSnackbar("To date should not be empty");
        }
        if ($("#dtpFFrom").val() > $("#dtpFTo").val()) {
            IsValid = false;
            $("#divErrFFrom").html("From date should be lessthan To Date");
            showErrorSnackbar("From date should be lessthan To Date");
        }
        if (IsValid) {
            if (ArrSelectCustomers.length == 0) {
                IsValid = false;
                showErrorSnackbar("Add atleast one customer");
            }
            if (ArrSelectProducts.length == 0) {
                IsValid = false;
                showErrorSnackbar("Add atleast one product");
            }
        }
        return IsValid;
    }   

    function SaveData() {        
        $("#btnSave").prop("disabled", true);
        var lstMaster = {
            "ID": $("#txtID").val(),
            "FromDate": $("#dtpFFrom").val(),
            "ToDate": $("#dtpFTo").val(),
            "Name": $("#txtName").val(), 
            "TransMode": nTransMode,
            "TransID": nDocPrefix,
            "ReplaceExists": $("#chkReplaceExists").is(":checked") ? 1 : 0,
            "Active": $("#chkActive").is(":checked") ? 1 : 0,
            "UserID": UID,            
            "lstSchemeCustomer": ArrSelectCustomers,
            "lstSchemeProduct": ArrSelectProducts
        }
        $.ajax({
            url: Aurl + "discountscheme/save",
            type: 'POST',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(lstMaster),
            cache: false,
            processData: false,
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                $("#btnSave").prop("disabled", false);
                $.each(data, function (i, items) {
                    if (items.MsgID == 0) {
                        //alert(items.Message);
                        showSuccessSnackbar(items.Message);                        
                        ClearForm();
                        AllShemeData();
                    }
                    else {
                        //$("#dvErrorName").html(items.Message);
                        //alert(items.Message);
                        showErrorSnackbar(items.Message);
                    }
                });
            }, error: function (data) {
                $("#btnSave").prop("disabled", false);
                if (data.status == "401") {
                    var msg = data.responseJSON.Message;
                    //showErrorSnackbar(msg + " Logout and Login again.");
                }
            }
        });
    }


    var cfFocus = '@Session["ConfirmFocus"]';
function ConfirmDialogMsg(message) {
    var IsAccepted = false;
    $(".ui-dialog-titlebar-close").hide();
    $('<div></div>').appendTo('body')
        .html('<div><h6>' + message + '</h6></div>')
        .dialog({
            modal: true,
            closeOnEscape: true,
            title: 'Confirm Popup',
            zIndex: 100,
            autoOpen: true,
            width: '300px',
            resizable: true,
            close: false,
            open: function () {
                $(this).closest(".ui-dialog")
                    .find(".ui-dialog-titlebar-close")
                    .removeClass("ui-dialog-titlebar-close")
                    .html("x");
            },
            buttons: [
                {
                    text: "Yes",
                    class: "btn btn-success clsYes",
                    click: function () {
                        $(this).dialog("close");
                        SaveData();
                    },
                },
                {
                    text: "No",
                    class: "btn btn-danger clsNo cfforeclr",
                    click: function () {
                        $(this).dialog("close");
                    }
                }
            ],
        });
    if (cfFocus == 1) {
        $(".clsYes").focus();
    }
    else {
        $(".clsNo").focus();
    }
};
function ClearConfirmDialogMsg(message) {
    var IsAccepted = false;
    $(".ui-dialog-titlebar-close").hide();
    $('<div></div>').appendTo('body')
        .html('<div><h6>' + message + '</h6></div>')
        .dialog({
            modal: true,
            closeOnEscape: true,
            title: 'Confirm Popup',
            zIndex: 100,
            autoOpen: true,
            width: '300px',
            resizable: true,
            close: false,
            open: function () {
                $(this).closest(".ui-dialog")
                    .find(".ui-dialog-titlebar-close")
                    .removeClass("ui-dialog-titlebar-close")
                    .html("x");
            },
            buttons: [
                {
                    text: "Yes",
                    class: "btn btn-success clsclrYes",
                    click: function () {
                        $(this).dialog("close");
                        ClearForm();
                    },
                },
                {
                    text: "No",
                    class: "btn btn-danger clsclrNo",
                    click: function () {
                        $(this).dialog("close");
                    }
                }
            ],
        });
    if (cfFocus == 1) {
        $(".clsclrYes").focus();
    }
    else {
        $(".clsclrNo").focus();
    }
    };
    var AllowAdvance = false;
    function AdvanceConfirmDialogMsg(message) {
        AllowAdvance = false;
        $(".ui-dialog-titlebar-close").hide();
        $('<div></div>').appendTo('body')
            .html('<div><h6>' + message + '</h6></div>')
            .dialog({
                modal: true,
                closeOnEscape: true,
                title: 'Confirm Popup',
                zIndex: 100,
                autoOpen: true,
                width: '300px',
                resizable: true,
                close: false,
                open: function () {
                    $(this).closest(".ui-dialog")
                        .find(".ui-dialog-titlebar-close")
                        .removeClass("ui-dialog-titlebar-close")
                        .html("x");
                },
                buttons: [
                    {
                        text: "Yes",
                        class: "btn btn-success clsclrYes",
                        click: function () {
                            $(this).dialog("close");
                            AllowAdvance = true;
                        },
                    },
                    {
                        text: "No",
                        class: "btn btn-danger clsclrNo",
                        click: function () {
                            $(this).dialog("close");
                            AllowAdvance = false;
                        }
                    }
                ],
            });
        if (cfFocus == 1) {
            $(".clsclrYes").focus();
        }
        else {
            $(".clsclrNo").focus();
        }
        return AllowAdvance;
    };

    //$('input, select ,button, textarea').on('keydown', function (e) {
    //    if (e.key === "Enter") {
    //        if (e.target.localName != "button") {
    //            e.preventDefault(); // Prevent default behavior
    //            var nextinp = $('input,select,button, textarea').eq($('input,select,button, textarea').index(this) + 1);
    //            if (nextinp.length) {
    //                if (nextinp[0].disabled) {
    //                    nextinp = $('input,select,button, textarea').eq($('input,select,button, textarea').index(this) + 2);
    //                }
    //                nextinp.focus();
    //                nextinp.select();
    //            }
    //        }
    //    }
    //    if (e.shiftKey && e.which == 13) {
    //        e.preventDefault();
    //        var $canfocus = $(':focusable');
    //        var index = $canfocus.index(this) - 1;
    //        if (index >= $canfocus.length) index = 0;
    //        $canfocus.eq(index).focus();
    //    }
    //});
</script>