@model ShineWeb.Models.SingleMasterModel
@{
    ViewBag.Title = "One View";
    if(ViewData["ID"].ToString() != "0")
    {
        Layout = "~/Views/Shared/_LayoutWithoutheader.cshtml";
    }
}
<link href="~/Content/bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/navbar.css" rel="stylesheet" />
<link href="~/Content/buttonTop.css" rel="stylesheet" />
@*<link href="~/Content/jquery-ui.css" rel="stylesheet" />*@
<link href="~/Content/dataTables.dataTables.2.2.2.css" rel="stylesheet" />
<!-- Font Awesome for Modern Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

<script src="~/Scripts/bootstrap.min.js"></script>
<script src="~/Scripts/jquery-1.10.2.min.js"></script>
<script src="~/Scripts/jquery-3.7.1.js"></script>
<script src="~/Scripts/jquery-ui.js"></script>
<script src="~/Scripts/datatable.js"></script>
<script src="~/Scripts/dataTables.2.2.2.js"></script>
<script src="~/Scripts/js/refreshtoken.js"></script>
<style>
    /* ============ KEYFRAME ANIMATIONS ============ */
    @@keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

    @@keyframes slideInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @@keyframes slideInRight {
        from {
            opacity: 0;
            transform: translateX(30px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    @@keyframes pulse {
        0%, 100% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.05);
        }
    }

    @@keyframes bounce {
        0%, 20%, 50%, 80%, 100% {
            transform: translateY(0);
        }
        40% {
            transform: translateY(-10px);
        }
        60% {
            transform: translateY(-5px);
        }
    }

    @@keyframes shimmer {
        0% {
            background-position: -1000px 0;
        }
        100% {
            background-position: 1000px 0;
        }
    }

    /* ============ ANIMATION CLASSES ============ */
    .animate-fade-in {
        animation: fadeIn 0.6s ease-in-out;
    }

    .animate-slide-up {
        animation: slideInUp 0.6s ease-out;
    }

    .animate-slide-right {
        animation: slideInRight 0.6s ease-out;
    }

    .stagger-1 { animation-delay: 0.1s; }
    .stagger-2 { animation-delay: 0.2s; }
    .stagger-3 { animation-delay: 0.3s; }
    .stagger-4 { animation-delay: 0.4s; }

    /* ============ BASE STYLES ============ */
    td {
        font-size: 12px;
    }

    input[type=number] {
        text-align: right;
    }

    input[type=number]::placeholder {
        text-align: left;
    }

    /* Chrome, Safari, Edge, Opera */
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    /* Firefox */
    input[type=number] {
        -moz-appearance: textfield;
    }
    /* The Modal (background) */
    .modalBatch1 {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 10; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    /* Modal Content/Box */
    @@media only screen and (min-width: 600px) {
        .modalBatch-content1 {
            background-color: #ffffff;
            margin: 3% auto; /* 15% from the top and centered */
            padding: 10px;
            border: 1px solid #888;
            width: 80%; /* Could be more or less, depending on screen size */
            height: 80%;
            top: 5%;
            overflow: auto;
        }
    }

    @@media only screen and (max-width: 600px) {
        .modalBatch-content1 {
            background-color: #ffffff;
            margin: 10% auto; /* 15% from the top and centered */
            padding: 25px;
            border: 1px solid #888;
            width: 95%; /* Could be more or less, depending on screen size */
            height: 90%;
            top: 20%;
            overflow: auto;
        }
    }

    .modal-dialog {
        width: 80%
    }
    /* The Close Button */
    .closefg1 {
        color: #aaa;
        float: right;
        font-size: 10px;
        font-weight: bold;
    }

        .closefg1:hover,
        .closefg1:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

    .form-label {
        position: relative;
        display: block;
        clear: both;
        max-width: 500px;
        margin: 0 auto;
    }

    .labelup {
        -webkit-transform: translateY(50%);
        -moz-transform: translateY(-50%);
        -ms-transform: translateY(-50%);
        -o-transform: translateY(-50%);
        transform: translateY(50%);
        -webkit-transition: all 0.2s ease-in-out;
        -moz-transition: all 0.2s ease-in-out;
        transition: all 0.2s ease-in-out;
        position: absolute;
        top: -40%;
        left: 1em;
        background: #fffefe;
        color: #2b2828;
        font-size: 0.90em;
        cursor: text;
        pointer-events: none;
        font-family: sans-serif;
    }

    tr {
        cursor: pointer;
        transition: all 0.2s ease;
    }

    tbody tr:hover {
        background-color: #f0f9ff !important;
        transform: scale(1.01);
    }

    tbody tr:nth-child(even) {
        background-color: #fafafa;
    }
</style>
<style>
    .star-rating {
        direction: rtl;
        display: inline-flex;
        font-size: 3rem;
    }

        .star-rating input {
            display: none;
        }

        .star-rating label {
            color: #ccc;
            cursor: pointer;
            padding: 0 5px;
        }            
            .star-rating input:checked ~ label
            {
                color: gold;
            }
</style>
<style>
    body {
        font-family: Arial, sans-serif;
        font-size: 14px;
        background-color: #f5f5f5;
        margin: 0;
        padding: 10px;
        left: 0;
        width: 100%
    }

    .container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        padding-left: 0;
        padding-right: 0;
        margin-left: 0;
        margin-right: 0;
        overflow-y: auto;
        max-width: 100%
    }

    .box {
        background: #fff;
        border: none;
        padding: 15px;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.07), 0 2px 4px rgba(0,0,0,0.05);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .box:hover {
        box-shadow: 0 10px 20px rgba(0,0,0,0.1), 0 4px 8px rgba(0,0,0,0.06);
        transform: translateY(-2px);
    }

    .info-section {
        display: flex;
        width: 100%;
    }

    .customer-info {
        flex: 2;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        width: 25%;
        position: relative;
        overflow: hidden;
    }

        .customer-info h5 {
            margin: 0 0 5px;
        }

        .customer-info label {
            margin-right: 10px;
        }

    .sales-return {
        flex: 2.5;
        background: linear-gradient(135deg, #fff9c4 0%, #fff59d 100%);
        width: 25%;
    }

    .cheque-info {
        flex: 2;
        background: linear-gradient(135deg, #e0f2f1 0%, #b2dfdb 100%);
        width: 25%;
    }

    .highlight {
        color: red;
        font-weight: bold;
        background-color: none;
    }

    .rating-info {
        flex: 1.5;
        background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
        width: 30%;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 5px;
    }

    th, td {
        padding: 6px;
        text-align: left;
        font-size:11px;
    }

    th {
       /* background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);*/
        color: white;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-size: 11px !important;
    }

    .outstanding, .top-products,.monthly-sales, .ledger {
        margin-top: 10px;
        width: 100%
    }

    .outstanding, .top-products, .monthly-sales {
        width: 32%;
        display: inline-block;
        vertical-align: top;
        min-height: 250px;
    }

    .ledger {
        width: 100%;
        min-height: 350px;
    }

        .ledger table {
            background-color: #fbe8dd;
        }

        .ledger th {
            background-color: #f5c0a6;
        }

    .scrollable {
        max-height: auto;
        overflow-y: auto;
    }

    .rating-link {
        color: blue;
        text-decoration: underline;
    }

    * {
        box-sizing: border-box;
    }

    .topBarContainer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }
    .counter {
        font-size: 48px;
        font-weight: bold;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-align: center;
        margin-top: 50px;
        animation: pulse 2s infinite;
    }

    /* ============ ICON STYLING ============ */
    .section-icon {
        margin-right: 8px;
        color: #6366f1;
        font-size: 16px;
    }

    .header-icon {
        margin-right: 10px;
        color: #8b5cf6;
        font-size: 24px;
        vertical-align: middle;
    }

    /* ============ ENHANCED INPUT STYLING ============ */
    .form-control:focus {
        border-color: #6366f1;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        transition: all 0.3s ease;
    }

    .input-group-addon {
        transition: all 0.3s ease;
    }

    .input-group-addon:hover {
        background-color: #6366f1;
        color: white;
        cursor: pointer;
    }

    /* ============ RADIO BUTTON STYLING ============ */
    input[type="radio"] {
        margin-right: 5px;
        cursor: pointer;
    }

    label {
        cursor: pointer;
        transition: color 0.2s ease;
    }

    label:hover {
        color: #6366f1;
    }

    /* ============ RATING ENHANCEMENTS ============ */
    .star-rating label {
        transition: all 0.2s ease;
    }

    .star-rating label:hover {
        transform: scale(1.2);
        animation: bounce 0.5s;
    }

    /* ============ BUTTON ENHANCEMENTS ============ */
    .btn {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border-radius: 8px;
        font-weight: 500;
    }

    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .btn:active {
        transform: translateY(0);
    }

    /* ============ DATATABLE TOOLBAR STYLING ============ */
    .topBarContainer label {
        font-weight: 600;
        color: #1f2937;
        font-size: 14px;
    }

    .dataTables_wrapper .dataTables_filter input {
        border-radius: 8px;
        border: 1px solid #d1d5db;
        padding: 6px 12px;
        transition: all 0.2s ease;
    }

    .dataTables_wrapper .dataTables_filter input:focus {
        border-color: #6366f1;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        outline: none;
    }
</style>
<body>
    @Html.HiddenFor(model => model.ID, new { @autocomplete = "off", @class = "form-control", @id = "txtID" })
    @Html.HiddenFor(model => model.TransType, new { @autocomplete = "off", @class = "form-control", @id = "txtTransType" })
    <div class="toastBox"></div>

    <div class="container animate-fade-in">
        <div class="box customer-info animate-slide-up">
            <h4 id="MainHeading"><i class="fas fa-eye header-icon"></i>One View</h4>
            <table width="100%">
                <tr class="bgclrfortr">
                    <td style="border:none;font-size:14px;" align="center" id="tdPartycell">
                        <label>
                            <input type="radio" id="rdoCustomer" name="userType" value="customer" checked> <i class="fas fa-user"></i> Customer
                        </label>&emsp;
                        <label>
                            <input type="radio" id="rdoVendor" name="userType" value="vendor"> <i class="fas fa-truck"></i> Vendor
                        </label>
                    </td>
                </tr>
                <tr class="bgclrfortr">
                    <td style="border:none;" colspan="3" width="100%">
                        <div class="input-group">
                            <span class="form-label">
                                <input class="form-control FormclrField" style="font-size:11px;" type="text" id="txtSearch" placeholder="🔍 Select Party">
                                <label class="labelup" for="txtCode"> Party Name *</label>
                            </span>
                            <span id="VendInfo" class="input-group-addon"><span class="glyphicon glyphicon-info-sign" style="background-color:white;"></span></span>
                        </div>
                        <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrSearch" class="clrdivs"></div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="box rating-info animate-slide-right stagger-1" align="center">
            <i class="fas fa-calendar-alt section-icon"></i>Last Trans. Date : <label id="lblLastTransDate" style="font-size:16px">07/05/2025</label>
            <br />
            <div class="star-rating">
                <input type="radio" id="star1" name="rating" value="1"><label for="star1">&#9733;</label>
                <input type="radio" id="star2" name="rating" value="2"><label for="star2">&#9733;</label>
                <input type="radio" id="star3" name="rating" value="3"><label for="star3">&#9733;</label>
                <input type="radio" id="star4" name="rating" value="4"><label for="star4">&#9733;</label>
                <input type="radio" id="star5" name="rating" value="5"><label for="star5">&#9733;</label>
            </div>
            <br />
            <label style="font-size:medium" id="lblRatingName"></label>
            <br />
            <b><i class="fas fa-clock section-icon"></i>Average Collection Days : </b><label style="font-size:28px;font-weight:600;color:darkcyan" id="lblAccValue"></label>
        </div>
        <div class="box sales-return" hidden>
            <h5>Sales & Return Info</h5>
            <table width="100%">
                <tr>
                    <td align="left">Yearly Sales</td>
                    <td align="left">Monthly Sales</td>
                    <td align="left">Avg Sales</td>
                </tr>
                <tr>
                    <td style="padding-left:8px;">
                        <label id="lblYearlySales" class="highlight">0.00</label>
                    </td>
                    <td style="padding-left:8px;">
                        <label id="lblMonthlySales" class="highlight">0.00</label>
                    </td>
                    <td style="padding-left:8px;">
                        <label id="lblAverageSales" class="highlight">0.00</label>
                    </td>
                </tr>
                <tr>
                    <td align="left">Yearly Return</td>
                    <td align="left">Monthly Return</td>
                    <td align="left">Avg Return</td>
                </tr>
                <tr>
                    <td style="padding-left:8px;">
                        <label id="lblYearlyReturn" class="highlight">0.00</label>
                    </td>
                    <td style="padding-left:8px;">
                        <label id="lblMonthlyReturn" class="highlight">0.00</label>
                    </td>
                    <td style="padding-left:8px;">
                        <label id="lblAverageReturn" class="highlight">0.00</label>
                    </td>
                </tr>
            </table>

        </div>
        <!-- Cheque Info -->
        <div class="box cheque-info animate-slide-right stagger-2">
            <table class="table" id="tblChequeInfo">
                <thead>
                    <tr class="trclrforcolheader">
                        <th>Doc ID</th>
                        <th>Date</th>
                        <th>Number</th>
                        <th>Value</th>
                    </tr>
                </thead>
            </table>
        </div>


    </div>
    <!-- Outstanding + Top Products -->
    <div class="container animate-fade-in stagger-1">
        <div class="box top-products scrollable animate-slide-up stagger-2">
            @*<h4>Top 10 Products</h4>*@
            <table id="tblTopProducts">
                <thead>
                    <tr class="trclrforcolheader">
                        <th style="font-size:11px">Product Name</th>
                        <th style="font-size:11px">Qty</th>
                        <th style="font-size:11px">Value</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
        <div class="box monthly-sales scrollable animate-slide-up stagger-3">
            @*<h4>Top 10 Products</h4>*@
            <table id="tblMonthlySales">
                <thead>
                    <tr class="trclrforcolheader">
                        <th style="font-size:11px">Month</th>
                        <th style="font-size: 11px;text-align:right">Sales ₹</th>
                        <th style="font-size: 11px; text-align: right">Return ₹(%)</th>
                        <th style="font-size: 11px; text-align: right">Damage ₹(%)</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>

        <div class="box outstanding scrollable animate-slide-up stagger-4">
            <table id="tblOutstanding">
                <thead>
                    <tr class="trclrforcolheader">
                        <th style="font-size:12px">Doc ID</th>
                        <th style="font-size:12px">Doc Date</th>
                        <th style="font-size:12px">Net Amount</th>
                        <th style="font-size:12px">Balance</th>
                        <th style="font-size:12px">Ageing</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Ledger Section -->
    <div class="box ledger scrollable animate-slide-up stagger-1">
        <table id="tblLedger">
            <thead>
                <tr class="trclrforcolheader">
                    <th>Transaction Name</th>
                    <th>Doc ID</th>
                    <th>Doc Date</th>
                    <th>Account Name</th>                    
                    <th>Credit</th>
                    <th>Debit</th>
                    <th>Balance</th>
                    <th>Remarks</th>
                    <th>Narration</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    <div class="modalBatch1" id="myModalfg1">
        <div class="modal-dialog">
            <div class="modalBatch-content1">
                <!-- Modal Header -->
                <div class="modal-header">
                    <button type="button" class="closefg1">&times;</button>
                    <h5 class="modal-title" style="color:black" id="lblPopupheading"><b></b></h5>
                    @*<hr />*@
                </div>
                <!-- Modal body -->
                <div class="modal-body">
                    <div style="padding-top:2px">
                        <div id="dvAssign" style="width:100%;padding-bottom:7px">
                            <input hidden id="txtTransID" />
                            <input hidden id="txtTransName" />
                            <table class="table table-bordered" id="tblDraftData" width="100%">
                                <thead>
                                    <tr class="trclrforcolheader">
                                        <th style="text-align:center;font-size: 12px;width:0%;">TransID</th>
                                        <th style="text-align:center;font-size: 12px;width:0%;">ID</th>
                                        <th style="text-align:center;font-size: 12px;width:0%;">Mode</th>
                                        <th style="text-align:center;font-size: 12px;width:0%;">EnccDocprefix</th>
                                        <th style="text-align:center;font-size: 12px;width:9%;">Doc ID</th>
                                        <th style="text-align:center;font-size: 12px;width:9%;">Date</th>
                                        <th style="text-align:center;font-size: 12px;width:10%;">Ref No</th>
                                        <th style="text-align:center;font-size: 12px;width:12%;">Branch</th>
                                        <th style="text-align:center;font-size: 12px;width:9%;">Beat Name</th>
                                        <th style="text-align:center;font-size: 12px;width:9%;">Salesman Name</th>
                                        <th style="text-align:center;font-size: 12px;width:20%;">Party Name</th>
                                        <th style="text-align:center;font-size: 12px;width:8%;">Gross ₹</th>
                                        <th style="text-align:center;font-size: 12px;width:8%;">Tax ₹</th>
                                        <th style="text-align:center;font-size: 12px;width:8%;">Net ₹</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" style="background-color:skyblue">
                    <div style="padding-top:0px" align="right">
                        <button tabindex="5" type="button" class="btn btn-warning" id="btnClose"><i class="fas fa-times"></i> Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script type="text/javascript">
    var DecVal = '@Session["DecimalValues"]';
    var ChequeInfoTable = $('#tblChequeInfo').DataTable({
        "bFilter": false,
        "bSearchable": false,
        "bInfo": false,
        "bPaginate": false,
        "ordering": false,
        scrollY: "200px",
        scrollX: true,
        scrollCollapse: true,
        dom: '<"topBarContainer d-flex justify-between align-center" <"toolbarChequeInfo">f>rtip'
    });
    document.querySelector('div.toolbarChequeInfo').innerHTML = `
 <label style="color:black; font-weight: 500; font-size: 12px;"><i class="fas fa-credit-card section-icon"></i>Cheque Info</label>`;
    var TopProductsTable = $('#tblTopProducts').DataTable({
        "bFilter": false,
        "bSearchable": false,
        "bInfo": false,
        "bPaginate": false,
        "ordering": false,
        scrollY: "250px",
        scrollX: true,
        scrollCollapse: true,
        dom: '<"topBarContainer d-flex justify-between align-center" <"toolbarPH">f>rtip'
    });
    document.querySelector('div.toolbarPH').innerHTML = `
    <label style="color:black; font-weight: 500; font-size: 14px;"><i class="fas fa-trophy section-icon"></i>Top 10 Products</label>`;

    var MonthlySalesTable = $('#tblMonthlySales').DataTable({
        "bFilter": false,
        "bSearchable": false,
        "bInfo": false,
        "bPaginate": false,
        "ordering": false,
        scrollY: "250px",
        scrollX: true,
        scrollCollapse: true,
        dom: '<"topBarContainer d-flex justify-between align-center" <"toolbarMonthsale">f>rtip'
    });
    document.querySelector('div.toolbarMonthsale').innerHTML = `
<label style="color:black; font-weight: 500; font-size: 14px;"><i class="fas fa-chart-line section-icon"></i>Monthly Sales</label>`;

    

    var OutstandingTable = $('#tblOutstanding').DataTable({
        "bFilter": true,
        "bSearchable": true,
        "bInfo": false,
        "bPaginate": false,
        "ordering": false,
        scrollY: "250px",
        scrollX: true,
        scrollCollapse: true,
        dom: '<"topBarContainer d-flex justify-between align-center" <"toolbarOS">f>rtip',
        columndef: [{ "targets":[6],"class":"text-right"}]
    });
    document.querySelector('div.toolbarOS').innerHTML = `
<label style="color:black; font-weight: 500; font-size: 14px;"><i class="fas fa-file-invoice-dollar section-icon"></i>Outstandings</label>`;
    var LedgerTable = $('#tblLedger').DataTable({
        "bFilter": true,
        "bSearchable": true,
        "bInfo": false,
        "bPaginate": false,
        "ordering": false,
        scrollY: "325px",
        scrollX: true,
        scrollCollapse: true,
        dom: '<"topBarContainer d-flex justify-between align-center" <"toolbarLedger">f>rtip'
    });
    document.querySelector('div.toolbarLedger').innerHTML = `
<label style="color:black; font-weight: 500; font-size: 14px;"><i class="fas fa-book section-icon"></i>Ledger</label>`;
    var Aurl = '@Session["APIurl"]';
    function displayResult(item) {
        $('.alert').show().html('You selected <strong>' + item.value + '</strong>: <strong>' + item.text + '</strong>');
    }
    var modal = document.getElementById("myModalfg1");
    var span = document.getElementsByClassName("closefg1")[0];
    span.onclick = function () {
        modal.style.display = "none";
    }
    $('#btnClose').click(function (e) {
        modal.style.display = "none";
    });
    $('#rdoCustomer,#rdoVendor').click(function (e) {
        var typeid = e.target.id == "rdoCustomer" ? 1 : 2;
        ClearForm();
        GetParty(typeid)
    });
    function ClearForm()
    {
        $("#lblLastTransDate").text("--");
        $("#lblRatingName,#lblAccValue").text("");
        $("#lblYearlySales,#lblMonthlySales,#lblYearlyReturn,#lblMonthlyReturn").text("0.00");
        $("input[name=rating]").prop("checked", false);
        $("#txtSearch").val("");
        LedgerTable.draw().clear(); LedgerTable.draw().clear();
        ChequeInfoTable.draw().clear(); ChequeInfoTable.draw().clear();
        OutstandingTable.draw().clear(); OutstandingTable.draw().clear();
        MonthlySalesTable.draw().clear(); MonthlySalesTable.draw().clear();
        TopProductsTable.draw().clear(); TopProductsTable.draw().clear();
        document.querySelector('div.toolbarChequeInfo').innerHTML = `<label style="color:black; font-weight: 500; font-size: 14px;"><i class="fas fa-credit-card section-icon"></i>Cheque Info</label>`;
        $("#txtSearch").focus();
    }
    $("#VendInfo").click(function () {
        if ($("#txtSearch").val() != "" && PartyInfo.length > 0) {
            var Partydata = `
            <table id="partyDetailsVertical" border="1" cellspacing="0" cellpadding="8" style="width:100%; border-collapse: collapse;">
    <tbody>
        <tr>
            <th style="text-align:left;">Code</th>
            <td>`+ PartyInfo[0].Code+`</td>
        </tr>
        <tr>
            <th style="text-align:left;">Name</th>
            <td>`+ PartyInfo[0].Name +`</td>
        </tr>
        <tr>
            <th style="text-align:left;">Address</th>
            <td>`+ PartyInfo[0].Address +`</td>
        </tr>
        <tr>
            <th style="text-align:left;">Pincode</th>
            <td>`+ PartyInfo[0].Pincode +`</td>
        </tr>
        <tr>
            <th style="text-align:left;">Mobile</th>
            <td>`+ PartyInfo[0].Mob1 +`</td>
        </tr>
        <tr>
            <th style="text-align:left;">Phone</th>
            <td>`+ PartyInfo[0].Ph1 +`</td>
        </tr>
        <tr>
            <th style="text-align:left;">Email</th>
            <td>`+ PartyInfo[0].Email +`</td>
        </tr>
        <tr>
            <th style="text-align:left;">GSTIN</th>
            <td>`+ PartyInfo[0].GSTIN +`</td>
        </tr>
    </tbody>
</table>`
            InfoDialogMsg(Partydata, 'Party Info');
        } else {
            showErrorSnackbar("Select Party");
        }
    });

    GetParty(1);
    var TempAL = [];
    function GetParty(ID) {
        $.ajax({
            url: Aurl + "oneview/getparty",
            type: 'get',
            contentType: 'json',
            data: { Type: ID },
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                TempAL = [];
                $.each(data, function (i, items) {
                    var al = {
                        "label": items.Code + " | " + items.Name,
                        "name": items.Name,
                        "code": items.Code,
                        "id": items.ID,
                    }
                    TempAL.push(al);
                });
                $("#txtSearch").autocomplete({
                    minLength: 0, autoFocus: true,
                    source: TempAL,
                    select: function (event, ui) {
                        $("#txtSearch").val(ui.item.name);
                        //GetData(3, ui.item.code);
                        GetData(ui.item.id);
                        //$("#txtRemarks").val(ui.item.id);
                        return false;
                    },
                }).autocomplete("instance")._renderItem = function (ul, item) {
                    return $("<li class='each'>")
                        .append("<div class='acItem'><span class='name'>" +
                            item.label + "</span></div>")
                        .appendTo(ul);
                };
            }
        });
    }
    $("input[name=rating]").prop("disabled", true);
    var PartyInfo = [];
    function GetData(nPartyID) {
        var nTypeID = $("#rdoCustomer").is(":checked") ? 1 : 2;
        $.ajax({
            url: Aurl + "oneview/getdata",
            type: 'get',
            contentType: 'json',
            data: { Type: nTypeID, PartyID: nPartyID },
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                PartyInfo = [];
                $("#lblLastTransDate").text("--");
                $("#lblRatingName,#lblAccValue").text("");
                $("#lblYearlySales,#lblMonthlySales,#lblYearlyReturn,#lblMonthlyReturn").text("0.00");
                $("input[name=rating]").prop("checked", false);
                //$("#star1, #star2, #star3, #star4, #star5").prop("checked", false);

                $.each(data, function (i, items) {
                    PartyInfo = JSON.parse(items.PartyDetails);
                    $("#lblLastTransDate").text(PartyInfo[0].LastTranDate);
                    $("#lblAccValue").text(PartyInfo[0].Acc);    
                    animateCounterNumber("lblAccValue", 0, PartyInfo[0].Acc, 1500);   

                    var Rate = PartyInfo[0].RatingValue;
                    if (Rate >= 1) $("#star1").prop("checked", true);
                    if (Rate >= 2) $("#star2").prop("checked", true);
                    if (Rate >= 3) $("#star3").prop("checked", true);
                    if (Rate >= 4) $("#star4").prop("checked", true);
                    if (Rate == 5)
                        $("input[name=rating]").prop("checked", false);
                    $("#lblRatingName").text(PartyInfo[0].RatingName);
                    $("#txtSearch").val(PartyInfo[0].Name);
                    var Trans = JSON.parse(items.TransDetails);
                    if (Trans.length > 0) {
                        $("#lblYearlySales").text(Trans[0].YRSALE);
                        $("#lblMonthlySales").text(Trans[0].MNTSALE);
                        $("#lblYearlyReturn").text(Trans[0].YRRTN);
                        $("#lblMonthlyReturn").text(Trans[0].MNTRTN);
                        $("#lblAverageSales").text(Trans[0].AvgSaleValue);
                        $("#lblAverageReturn").text(Trans[0].AvgRTNValue);                        
                    }
                    var TopProds = JSON.parse(items.TopProductsDetails);
                    $('#tblTopProducts').DataTable({
                        scrollY: "200px",
                        scrollX: true,
                        scrollCollapse: true,
                        paging: false,
                        destroy: true,
                        data: TopProds,
                        fixedColumns: false,
                        searching: false,
                        ordering: false,
                        sorting: false,
                        info: false,
                        columns: [
                            { "data": "Product Name", "autoWidth": true, className: "dt-body-left" },
                            { "data": "Qty", "autoWidth": true, className: "dt-body-right" },
                            { "data": "Value", "autoWidth": true, className: "dt-body-right" }
                        ],
                        dom: '<"topBarContainer d-flex justify-between align-center" <"toolbarPH">f>rtip'
                    });
                    TopProductsTable = $('#tblTopProducts').DataTable();
                    document.querySelector('div.toolbarPH').innerHTML = `<label style="color:black; font-weight: 500; font-size: 13px;"><i class="fas fa-trophy section-icon"></i>Top 10 Products</label>`;


                    var Monthsale = JSON.parse(items.MonthlySalesDetails);
                    $('#tblMonthlySales').DataTable({
                        scrollY: "200px",
                        scrollX: true,
                        scrollCollapse: true,
                        paging: false,
                        destroy: true,
                        data: Monthsale,
                        fixedColumns: false,
                        searching: false,
                        ordering: false,
                        sorting: false,
                        info: false,
                        columns: [
                            { "data": "MonthYear", "autoWidth": true, className: "dt-body-left" },
                            { "data": "SalesAmount", "autoWidth": true, className: "dt-body-right" },
                            { "data": "ReturnAmount", "autoWidth": true, className: "dt-body-right" },
                            { "data": "DamageAmount", "autoWidth": true, className: "dt-body-right" }
                        ],
                        dom: '<"topBarContainer d-flex justify-between align-center" <"toolbarMonthsale">f>rtip',
                        //drawCallback: function (settings) {
                        //    var api = this.api();
                        //    var rows = api.rows({ page: 'current' }).nodes();
                        //    // Clear old styles
                        //    $(rows).css('color', '');
                        //    // Highlight last row (only if > 1 row)
                        //    if (rows.length > 1) {
                        //        $(rows).eq(0).css('color', 'black');
                        //        $(rows).eq(1).css('color', 'black');
                        //    }
                        //}
                    });
                    MonthlySalesTable = $('#tblMonthlySales').DataTable();
                    document.querySelector('div.toolbarMonthsale').innerHTML = `<label style="color:black; font-weight: 500; font-size: 13px;"><i class="fas fa-chart-line section-icon"></i>Monthly Sales</label>`;

                    var PartyOS = JSON.parse(items.OutstandingDetails);
                    $('#tblOutstanding').DataTable({
                        scrollY: "200px",
                        scrollX: true,
                        scrollCollapse: true,
                        paging: false,
                        destroy: true,
                        data: PartyOS,
                        fixedColumns: false,
                        searching: true,
                        ordering: false,
                        sorting: false,
                        info: false,
                        columns: [
                            { "data": "Doc ID", "autoWidth": true, className: "dt-body-left" },
                            { "data": "Doc Date", "autoWidth": true, className: "dt-body-left" },
                            { "data": "Net Amount", "autoWidth": true, className: "dt-body-right" },
                            { "data": "Balance", "autoWidth": true, className: "dt-body-right" },
                            { "data": "Ageing", "autoWidth": true, className: "dt-body-right" }
                        ],
                        dom: '<"topBarContainer d-flex justify-between align-center" <"toolbarOS">f>rtip',
                        //drawCallback: function (settings) {
                        //    var api = this.api();
                        //    var rows = api.rows({ page: 'current' }).nodes();
                        //    // Clear old styles
                        //    $(rows).css('color', '');
                        //    // Highlight first row
                        //    $(rows).eq(0).css('color', 'black');

                        //}
                    });
                    OutstandingTable = $('#tblOutstanding').DataTable();
                    document.querySelector('div.toolbarOS').innerHTML = `<label style="color:black; font-weight: 500; font-size: 13px;"><i class="fas fa-file-invoice-dollar section-icon"></i>Outstandings</label>`;



                    var PartyLedger = JSON.parse(items.LedgetDetails);
                    $('#tblLedger').DataTable({
                        scrollY: "300px",
                        scrollX: true,
                        scrollCollapse: true,
                        paging: false,
                        destroy: true,
                        data: PartyLedger,
                        fixedColumns: false,
                        searching: true,
                        ordering: false,
                        sorting: false,
                        info: false,
                        columns: [
                            { "data": "Transaction Name", "autoWidth": true, className: "dt-body-left" },
                            { "data": "Doc ID", "autoWidth": true, className: "dt-body-left" },
                            { "data": "Document Date", "autoWidth": true, className: "dt-body-left" },
                            { "data": "Account Name", "autoWidth": true, className: "dt-body-left" },
                            { "data": "Credit", "autoWidth": true, className: "dt-body-right" },
                            { "data": "Debit", "autoWidth": true, className: "dt-body-right" },
                            { "data": "Balance", "autoWidth": true, className: "dt-body-right" },
                            { "data": "Remarks", "autoWidth": true, className: "dt-body-left" },
                            { "data": "Narration", "autoWidth": true, className: "dt-body-left" },
                        ],
                        dom: '<"topBarContainer d-flex justify-between align-center" <"toolbarLedger">f>rtip',
                        columndef: [{ "targets": [6], "class": "text-right" }],
                        drawCallback: function (settings) {
                            var api = this.api();
                            var rows = api.rows({ page: 'current' }).nodes();
                            // Clear old styles
                            $(rows).css('color', '');

                            //// Highlight first row
                            //$(rows).eq(0).css('color', 'green');

                            //// Highlight last row (only if > 1 row)
                            //if (rows.length > 1) {
                            //    $(rows).eq(rows.length - 1).css('color', 'black');
                            //    $(rows).eq(rows.length - 2).css('color', 'black');
                            //}
                            if (rows.length > 1) {
                                const lastRow = $(rows).eq(rows.length - 1);
                                const secondLastRow = $(rows).eq(rows.length - 2);

                                lastRow.css('color', 'black');
                                secondLastRow.css('color', 'black');

                                // Get Credit and Debit cell values from last row
                                const creditCell = lastRow.find('td').eq(4); // 5th column = Credit
                                const debitCell = lastRow.find('td').eq(5);  // 6th column = Debit

                                const creditValue = parseFloat(creditCell.text()) || 0;
                                const debitValue = parseFloat(debitCell.text()) || 0;

                                // Apply background color based on value
                                if (creditValue > 0) {
                                    creditCell.css('color', 'green'); // light green
                                }

                                if (debitValue > 0) {
                                    debitCell.css('color', 'red'); // light red
                                }
                            }
                        }
                    });
                    LedgerTable = $('#tblLedger').DataTable();
                    document.querySelector('div.toolbarLedger').innerHTML = `<label style="color:black; font-weight: 500; font-size: 13px;"><i class="fas fa-book section-icon"></i>Ledger</label>`;


                    var Partycheq = JSON.parse(items.ChequeDetails);
                    var CheqtotalValue = 0, CheqCount = 0;
                    if (Partycheq.length > 0) {
                        CheqtotalValue = parseFloat(Partycheq.reduce((sum, item) => sum + parseFloat(item.Value), 0)).toFixed(DecVal);
                        CheqCount = Partycheq.length;
                    }
                    $('#tblChequeInfo').DataTable({
                        scrollY: "100px",
                        scrollX: true,
                        scrollCollapse: true,
                        paging: false,
                        destroy: true,
                        data: Partycheq,
                        fixedColumns: false,
                        searching: false,
                        ordering: false,
                        sorting: false,
                        info: false,
                        columns: [
                            { "data": "Doc ID", "autoWidth": true, className: "dt-body-left" },
                            { "data": "Cheque Date", "autoWidth": true, className: "dt-body-left" },
                            { "data": "Cheque/DD Number", "autoWidth": true, className: "dt-body-right" },
                            { "data": "Value", "autoWidth": true, className: "dt-body-right" },
                        ],
                        dom: '<"topBarContainer d-flex justify-between align-center" <"toolbarChequeInfo">f>rtip'
                    });
                    ChequeInfoTable = $('#tblChequeInfo').DataTable();
                    document.querySelector('div.toolbarChequeInfo').innerHTML = `<label style="color:black; font-weight: 500; font-size: 14px;"><i class="fas fa-credit-card section-icon"></i>Cheque Info :   ₹ ` + CheqtotalValue + ` (` + CheqCount + `)</label>`;

                });

            }
        });
    }
    if ($("#txtID").val() > 0 && $("#txtTransType").val() > 0) {
        var TypeID = $("#txtTransType").val();
        var PartyID = $("#txtID").val();
        $("#rdoCustomer").prop("checked", TypeID == 1);
        $("#rdoVendor").prop("checked", TypeID == 2);
        $("#tdPartycell,#txtSearch").prop("disabled", true);        
        GetData(PartyID);
    }
    function animateCounterNumber(id, start, end, duration) {
        if (end != "" && end != null) {
            const obj = document.getElementById(id);
            const range = end - start;
            let current = start;
            const increment = end > start ? 1 : -1;
            const stepTime = Math.abs(Math.floor(duration / range));

            const timer = setInterval(() => {
                current += increment;
                obj.textContent = current;
                if (current === end) {
                    clearInterval(timer);
                }
            }, stepTime);
        }
    }
</script>
