@model ShineWeb.Models.SingleMasterModel
@{
    ViewBag.Title = ViewData["FormName"];
}
<link href="~/Content/bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/navbar.css" rel="stylesheet" />
<link href="~/Content/buttonTop.css" rel="stylesheet" />
@*<link rel="stylesheet" href="~/Content/jquery-ui.css">*@
<link href="~/Content/dataTables.dataTables.2.2.2.css" rel="stylesheet" />

<script src="~/Scripts/bootstrap.min.js"></script>
<script src="~/Scripts/jquery-1.10.2.min.js"></script>
<script src="~/Scripts/jquery-3.7.1.js"></script>
<script src="~/Scripts/jquery-ui.js"></script>
<script src="~/Scripts/dataTables.2.2.2.js"></script>
<script src="~/Scripts/js/refreshtoken.js"></script>
<header>
    <link rel="stylesheet" href="~/Content/index.css">
</header>

<style>
    th, td {
        white-space: nowrap;
    }

    .gdInput {
        width: 100%;
        height: 25px;
        border-width: 0 0 0.1px 0;
        border-color: #e0d6d6;
    }

    .trtext-line {
        border: none;
        border-bottom: 1px #000000;
    }

    div.dataTables_wrapper {
        width: 100%;
        margin: 0 auto;
    }

    td {
        font-size: 11px;
    }

    input[type=number] {
        text-align: right;
    }

        input[type=number]::placeholder {
            text-align: left;
        }
    /* Chrome, Safari, Edge, Opera */
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    /* Firefox */
    input[type=number] {
        -moz-appearance: textfield;
    }       

    /* Style the tab */
    .tab {
        overflow: hidden;
        border: 1px solid #ccc;
        background-color: #f1f1f1;
    }

        /* Style the buttons inside the tab */
        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.5s;
            font-size: 17px;
        }

            /* Change background color of buttons on hover */
            .tab button:hover {
                background-color: #ddd;
            }

            /* Create an active/current tablink class */
            .tab button.active {
                background-color: #ccc;
            }

    /* Style the tab content */
    .tabcontent {
        display: none;
        /*padding: 6px 12px;*/
        border: none;
        border-top: none;
    }

    .form-label {
        position: relative;
        display: block;
        clear: both;
        max-width: 500px;
        margin: 0 auto;
    }

    .labelup {
        -webkit-transform: translateY(50%);
        -moz-transform: translateY(-50%);
        -ms-transform: translateY(-50%);
        -o-transform: translateY(-50%);
        transform: translateY(50%);
        -webkit-transition: all 0.2s ease-in-out;
        -moz-transition: all 0.2s ease-in-out;
        transition: all 0.2s ease-in-out;
        position: absolute;
        top: -40%;
        left: 1em;
        background: #fffefe;
        color: #2b2828;
        font-size: 1em;
        cursor: text;
        pointer-events: none;
        font-family: sans-serif;
    }

    .labelupfortextarea {
        -webkit-transform: translateY(50%);
        -moz-transform: translateY(-50%);
        -ms-transform: translateY(-50%);
        -o-transform: translateY(-50%);
        transform: translateY(50%);
        -webkit-transition: all 0.2s ease-in-out;
        -moz-transition: all 0.2s ease-in-out;
        transition: all 0.2s ease-in-out;
        position: absolute;
        top: -18%;
        left: 1em;
        background: #fffefe;
        color: #2b2828;
        font-size: 1em;
        cursor: text;
        pointer-events: none;
        font-family: sans-serif;
    }

    .footerAction {
        position: fixed;
        right: 0;
        bottom: 0;
        width: 85%;
        color: white;
        background-color: azure;
    }
    /*input:focus + .labelup,
    input:not(:placeholder-shown) + .labelup, textarea:focus + .labelup, textarea:not(:placeholder-shown) + .labelup {
        top: -35%;
        font-size: .9em;
        padding: 0 .3em;
        background: #F9F9F9;
        color: #000000;
    }*/
    .clsProd {
        position: fixed;
        right: 1%;
        bottom: 8%;
        width: 30%;
        height: 45%;
        color: black;
        background-color: #c2f6b5;
        z-index: 1000;
    }
/*
    .each {
        border-bottom: 1px solid #555;
        padding: 3px 0;
    }

    .acItem .name {
        font-size: 14px;
        font-family: Arial, Helvetica, sans-serif;
    }

    .acItem .desc {
        font-size: 10px;
        font-family: Arial, Helvetica, sans-serif;
        color: #555;
    }

    .ui-autocomplete {
        max-height: 245px;
        overflow-y: auto;
        overflow-x: hidden;
    }*/
    .modalPaymode {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 10; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    /* Modal Content/Box */
    @@media only screen and (min-width: 600px) {
        .modalPaymode-content {
            background-color: #ffffff;
            margin: 3% auto; /* 15% from the top and centered */
            padding: 1px;
            border: 1px solid #888;
            width: 30%; /* Could be more or less, depending on screen size */
            height: 50%;
            top: 1%;
            overflow: auto;
        }
    }

    @@media only screen and (max-width: 600px) {
        .modalPaymode-content {
            background-color: #ffffff;
            margin: 10% auto; /* 15% from the top and centered */
            padding: 25px;
            border: 1px solid #888;
            width: 95%; /* Could be more or less, depending on screen size */
            height: 80%;
            top: 20%;
            overflow: auto;
        }
    }
    /* The Close Button */
    .closePaymode {
        color: #aaa;
        float: right;
        font-size: 10px;
        font-weight: bold;
    }

        .closePaymode:hover,
        .closePaymode:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    .switch {
        position: relative;
        display: inline-block;
        width: 35px;
        height: 18px;
    }

        .switch input {
            opacity: 0;
            width: 0;
            height: 10px;
        }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: green;
        -webkit-transition: .4s;
        transition: .4s;
    }

        .slider:before {
            position: absolute;
            content: "";
            height: 15px;
            width: 15px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

    input:checked + .slider {
        background-color: red;
    }

    input:focus + .slider {
        box-shadow: 0 0 1px #2196F3;
    }

    input:checked + .slider:before {
        -webkit-transform: translateX(15px);
        -ms-transform: translateX(15px);
        transform: translateX(15px);
    }

    /* Rounded sliders */
    .slider.round {
        border-radius: 34px;
    }

        .slider.round:before {
            border-radius: 50%;
        }
</style>
<body>

    @Html.HiddenFor(model => model.Add, new { @autocomplete = "off", @class = "form-control", @id = "txtAddID" })

    @Html.HiddenFor(model => model.Cancel, new { @autocomplete = "off", @class = "form-control", @id = "txtCancelID" })
    @Html.HiddenFor(model => model.FormName, new { @autocomplete = "off", @class = "form-control", @id = "txtFormName" })
    @Html.HiddenFor(model => model.FormID, new { @autocomplete = "off", @class = "form-control", @id = "txtFormID" })
    @Html.HiddenFor(model => model.ID, new { @autocomplete = "off", @class = "form-control FormclrField", @id = "txtID" })
    @Html.HiddenFor(model => model.TransType, new { @autocomplete = "off", @class = "form-control FormclrField", @id = "txtTransType" })
    <h4 id="MainHeading">@ViewData["FormName"]</h4>
    <div class="toastBox"></div>
    <hr />
    <div style="width:100%;">
        <table>
            <tr>
                <td style="padding-right:10px">

                    <span class="form-label">
                        <select class="form-control FormclrcmbField" id="cmbFilterAccountNo"><option value="0">Select Account No</option></select>
                        <label class="labelup" for="txtCode"> Account No </label>
                    </span>
                </td>
                <td style="padding-right:10px">
                    <span class="form-label">
                        <input required tabindex="1" class="form-control FormfilterclrField" type="text" id="txtFilterParty" placeholder="">
                        <label class="labelup" for="txtCode"> Party</label>
                    </span>
                    <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrFParty" class="clrdivs"></div>
                </td>
                <td>
                    <select class="gdInput" id="cmbFilterDatetype" onchange="SetFilterDate();"></select>
                </td>
                <td style="padding-right:10px">
                    <span class="form-label">
                        <input tabindex="1" class="form-control FormfilterclrField" type="date" id="dtpFFrom" placeholder="" oninput="javascript: if (this.value > this.max) { this.value = this.max; }">
                        <label class="labelup" for="txtCode"> From</label>
                    </span>
                    <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrFFrom" class="clrdivs"></div>
                </td>
                <td style="padding-right:10px">

                    <span class="form-label">
                        <input tabindex="1" class="form-control FormfilterclrField" type="date" id="dtpFTo" placeholder="" oninput="javascript: if (this.value > this.max) { this.value = this.max; }">
                        <label class="labelup" for="txtCode"> To</label>
                    </span>
                    <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrFTo" class="clrdivs"></div>
                </td>
                <td style="padding-right:10px" id="tdchkShowall">
                    <input tabindex="1" style="font-size:14px;" class="FormfilterclrField" type="checkbox" id="chkShowAll">
                    <label for="chkShowAll" style="font-size:14px;">All Status</label>
                </td>
                <td style="padding-right:10px">
                    <button id="btnFilter" class="btn btn-primary"><span class="glyphicon glyphicon-export" style="color: white"></span>&#x2009;Filter</button>
                </td>
            </tr>
        </table>
    </div>
    <div id="dvDocuments">
        <hr />
        @*<button id="btnLoadDraft" class="btn btn-primary"><span class="glyphicon glyphicon-download-alt	" style="color: white"></span>&#x2009;Load Draft Data</button>*@
        <button id="btnAdd" class="btn btn-info"><span class="glyphicon glyphicon-plus" style="color: white"></span>&#x2009;Add</button>
        <table class="table table-bordered" id="tblMasterData" width="100%">
            <thead>
                <tr class="trclrforcolheader">
                    <th style="text-align:center;font-size: 12px;width:0%;">ID</th>
                    <th style="text-align:center;font-size: 12px;width:0%;">StatusID</th>
                    <th style="text-align:center;font-size: 12px;width:3%;">#</th>
                    <th style="text-align:center;font-size: 12px;width:8%;">Doc ID</th>
                    <th style="text-align:center;font-size: 12px;width:8%;">Date</th>
                    <th style="text-align:center;font-size: 12px;width:15%;">Party Name</th>
                    <th style="text-align:center;font-size: 12px;width:12%;">Account No</th>
                    <th style="text-align:center;font-size: 12px;width:12%;">Bank Name</th>
                    <th style="text-align:center;font-size: 12px;width:7%;">IFSC</th>
                    <th style="text-align:center;font-size: 12px;width:10%;">Cheque No</th>
                    <th style="text-align:center;font-size: 12px;width:8%;">Amount</th>
                    <th style="text-align:center;font-size: 12px;width:8%;">Salesman</th>
                    <th style="text-align:center;font-size: 12px;width:6%;">Status</th>
                    <th style="text-align:center;font-size: 12px;width:3%;" title="Cancel">
                        <span class="glyphicon glyphicon-remove-circle" style="font-size:16px">
                        </span>
                    </th>
                </tr>
            </thead>
        </table>
    </div>

    <div id="dvMain">
        <hr />
        <div class="row">
            <div class="col-sm-12 col-md-12 col-lg-12">
                <table class="table table-bordered row-border order-column" id="tblDocumentData" width="100%">
                    <thead>
                        <tr class="trclrforcolheader">
                            <th style="text-align:center;font-size: 12px;width:0%;">ID</th>
                            <th style="text-align:center;font-size: 12px;width:0%;">StatusID</th>
                            <th style="text-align:center;font-size: 12px;width:3%;"><input id="chkSelectAll" type="checkbox" /></th>
                            <th style="text-align:center;font-size: 12px;width:8%;">Doc ID</th>
                            <th style="text-align:center;font-size: 12px;width:8%;">Date</th>
                            <th style="text-align:center;font-size: 12px;width:15%;">Party Name</th>
                            <th style="text-align:center;font-size: 12px;width:12%;">Account No</th>
                            <th style="text-align:center;font-size: 12px;width:12%;">Bank Name</th>
                            <th style="text-align:center;font-size: 12px;width:7%;">IFSC</th>
                            <th style="text-align:center;font-size: 12px;width:10%;">Cheque No</th>
                            <th style="text-align:center;font-size: 12px;width:8%;">Amount</th>
                            <th style="text-align:center;font-size: 12px;width:8%;">Salesman</th>
                            <th style="text-align:center;font-size: 12px;width:6%;">Status</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
        <div class="footerAction modal-footer">
            <div style="padding-right:20px" align="right">
                <button type="button" class="btn btn-danger" id="btnClear"><span class="glyphicon glyphicon-refresh"> Clear</span></button>
                <button type="button" class="btn btn-success" id="btnSave"><span class="glyphicon glyphicon-saved"> Save</span></button>
                <button type="button" class="btn btn-warning" id="btnClose"><span class="glyphicon glyphicon-remove"> Close</span></button>
            </div>
        </div>
    </div>
    <div class="modalPaymode" id="myModalPayment">
        <div class="modal-dialog" style="width:auto;">
            <div class="modalPaymode-content">
                <!-- Modal Header -->
                <div class="modal-header">
                    <button type="button" class="closePaymode">&times;</button>
                    <h5 class="modal-title" style="color:black"><b>Bank Charge</b></h5>

                    @*<hr />*@
                </div>
                <!-- Modal body -->
                <div class="modal-body">
                    <div style="padding-top: 1px; width: 100%;">
                        <div class="col-sm-12 col-md-12 col-lg-12">
                            <table width="100%">
                                <tr>
                                    <td colspan="2" align="center" style="padding-bottom:10px;">
                                        <label style="font-size:15px">Clearance </label>&ensp;
                                        <label class="switch">
                                            <input type="checkbox" id="chkBRType">
                                            <span class="slider round"></span>
                                        </label>&ensp;
                                        <label style="font-size:15px">Bounce</label>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="border:none;" colspan="2">
                                        <div>
                                            <span class="form-label">
                                                <input class="form-control FormclrField" type="date" step="any" id="dtpDate" placeholder="">
                                                <label class="labelup" for="txtCode">Bank Date</label>
                                            </span>
                                            <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrDate" class="clrdivs"></div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="border:none;" colspan="2">
                                        <div>
                                            <span class="form-label">
                                                <input class="form-control FormclrField" type="number" step="any" id="txtBankCharge" placeholder="">
                                                <label class="labelup" for="txtCode">Bank Charge</label>
                                            </span>
                                            <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrBankCharge" class="clrdivs"></div>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <span class="form-label">

                    </span>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer" style="background-color:skyblue">
                    <div style="padding-top:0px" align="right">
                        <button type="button" class="btn btn-success" id="btnPaymentAccept"><span class="glyphicon glyphicon-saved"> Accept</span></button>
                        <button type="button" class="btn btn-warning" id="btnPaymentClose"><span class="glyphicon glyphicon-remove"> Close</span></button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>


<script type="text/javascript">
    //document.body.style.zoom = "85%";
    $("#txtDocID").prop("disabled", true);
    //dvDocuments,
    $("#dvMain").hide();
    var Table = $('#tblMasterData').DataTable({pageLength: ItemsperPage,lengthMenu: [[10, 20, 50, 100, -1], [10, 20, 50, 100, "All"]],
        "bFilter": true,
        "bSearchable": true,
        "bInfo": false,
        "bPaginate": false,
        "ordering": true,
        scrollY: "400px",
        scrollX: true,
        scrollCollapse: true,
        "columnDefs": [{ "targets": [0,1], "visible": false, searchable: false }, { "targets": [2,13], "class": "text-center" }],
    });
    var DocumentData = $('#tblDocumentData').DataTable({
        paging: false,
        searching: false,
        info: false,
        ordering: true,
        scrollY: "250px",
        scrollX: true,
        scrollCollapse: true,
        "columnDefs": [{ "targets": [0,1], "visible": false, searchable: false, filter: false, ordering: false },
            { "targets": [2], "class": "text-center" } ],
    });
        var UID = '@Session["LoginUserID"]';
    var Aurl = '@Session["APIurl"]';
    var DefBranch = '@Session["DefaultBranch"]';
    var DecVal = '@Session["DecimalValues"]';
    var nTransMode = 2, nIsDraft = 0;
if ($("#txtAddID").val() == 0) {
    $("#trAdd").hide();
    $("#btnAdd").hide();
}
    
    //if ($("#txtCancelID").val() == 0) {
    //    Table.column(13).visible(false);
    //}
    var modalPayment = document.getElementById("myModalPayment");
    var spanPayment = document.getElementsByClassName("closePaymode")[0];
    spanPayment.onclick = function () {
        modalPayment.style.display = "none";
    }
    $('#btnPaymentClose').click(function (e) {
        modalPayment.style.display = "none";
    });
    $("#btnAdd").click(function () {
        //dvDocuments,
        nTransMode = 1;
        $("#dvMain").show();
        $("#dvDocuments,#tdchkShowall").hide();           
        ClearForm();
        //setTimeout(function () {
        //    GetFilterData(3);
        //}, 500);
        $("#MainHeading").text("Create Bounce & Realisation");
    })
    $("#btnClose").click(function () {
        //dvDocuments,
        if (ClosecfFocus != 3) { CloseConfirmDialogMsg("Do you want to close?"); } else { CloseForm(); }
    });
    function CloseForm() {
        nTransMode = 2;
        $("#dvMain").hide();
        $("#dvDocuments,#tdchkShowall").show();
        //GetData(rdo1 ? 4 : 7);
        GetFilterData(2);
        $("#MainHeading").text("Bounce & Realisation");
    }
    function Scrolltoid(id) {
        //window.scrollTo(id[0].offsetLeft, id[0].offsetTop);
        window.scrollTo({ left: 0, top: document.body.scrollHeight, behavior: "smooth" });
    }
   setDate("dtpDate", 0);
   setDate("dtpFFrom", 0);
    setDate("dtpFTo", 0);
    setDate("dtpAsonDate", 0);

setTimeout(function () { GetFilterData(2); }, 800);

    function setDate1(FieldID, Type) {
        $.ajax({
            url: "@Url.Action("setdate", "Home")",
            type: 'get',
            contentType: 'json',
            data: { TypeID: Type },
            success: function (data) {
                $.each(data, function (i, items) {
                    $("#" + FieldID).attr("max", items.MaxDate);
                    $("#" + FieldID).attr("min", items.MinDate);
                    $("#" + FieldID).val(items.Value);
                });
            }, error: function (data) {
                if (data.status == "401") {
                    var msg = data.responseJSON.Message;
                    //showErrorSnackbar(msg + " Logout and Login again.");
                }
            }
        });
    }
    var nDocprefix = 20;
    GetData(1);
    var TempProd = [], arrParty = [], arrBankAccountData = [], DefBankAcc = 0;
    var prodids = 0;
    var defbank = "", defIfsc = "";
    function GetData(nMode, strID = null) {
        $.ajax({
            url: Aurl + "bouncerealisation/get",
            type: 'get',
            contentType: 'json',
            data: {
                Mode: nMode, TransID: nDocprefix
            },
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                if (nMode == 1) {
                    //cmbFilterAccountNo, txtFilterParty, cmbAccountNo, cmbDepositAccountNo, cmbDepSalesman
                    $('#cmbFilterAccountNo').find("option").remove();
                    $('#cmbFilterAccountNo').append($('<option/>', {
                        value: 0,
                        text: "-- Select --",
                    }));
                    arrParty = [], defbank = "", defIfsc = "", DefBankAcc = 0;
                    $.each(data, function (i, items) {
                        if (items.FType == 2) {
                            var ven = {
                                "label": items.Name,
                                "name": items.Name,
                                "code": items.Code,
                                "id": items.ID,
                            }
                            arrParty.push(ven);
                        }
                        if (items.FType == 1) {
                            var BADetails = (items.Name).split('|');
                            var BAInfo = {
                                "ID": items.ID,
                                "AccNo": BADetails[0],
                                "Bank": BADetails[1],
                                "Branch": BADetails[2],
                                "IFSC": BADetails[3],
                                "MICR": BADetails[4],
                                "DefYN": BADetails[5],
                            }
                            if (BADetails[5] == "1") {
                                DefBankAcc = items.ID;
                                defbank = BADetails[1], defIfsc = BADetails[3];
                            }
                            arrBankAccountData.push(BAInfo);

                            $('#cmbFilterAccountNo').append($('<option/>', {
                                value: items.ID,
                                text: BADetails[0],
                            }));
                        }                        
                    });
                    SetAutlistforFields();                    
                }               
            }, error: function (data) {
                if (data.status == "401") {
                    var msg = data.responseJSON.Message;
                    ////showErrorSnackbar(msg + " Logout and Login again.");
                }
            }
        });
    }
    function CancelDeposit(nID, nStatus) {
        $.ajax({
            url: Aurl + "bouncerealisation/cancel",
            type: 'get',
            contentType: 'json',
            data: {
                TransID: nDocprefix, ID: nID, UserID: UID, Status: nStatus
            },
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                $.each(data, function (i, items) {
                    if (items.MsgID == 0) {
                        showSuccessSnackbar(items.Message);
                        GetFilterData(2);
                    }
                    else {
                        //$("#dvErrorName").html(items.Message);
                        showErrorSnackbar(items.Message);
                    }
                });
            }, error: function (data) {
                if (data.status == "401") {
                    var msg = data.responseJSON.Message;
                    ////showErrorSnackbar(msg + " Logout and Login again.");
                }
            }
        });
    }
    $('#txtDepBankName,#txtDepIFSC').prop("disabled", true);
    $('#cmbDepositAccountNo').change(function (e) {
        var SelID = e.target.value;
        if (SelID > 0) {
            var md = arrBankAccountData.filter(t => t.ID == SelID);
            $('#txtDepBankName').val(md[0].Bank);
            $('#txtDepIFSC').val(md[0].IFSC);
        } else {
            $('#txtDepBankName,#txtDepIFSC').val("");
        }
    });
    $("#btnCheqDepositFilter").click(function () {
        var accid = $("#cmbAccountNo").val();
        GetData(2, accid);
    });
    $('#chkSelectAll').click(function () {
        var IsChk = $('#chkSelectAll').is(':checked');
        //alert(IsChk);
        $('#tblDocumentData tr td input').each(function (i, items) {
            items.checked = IsChk;
        });
    });
    function SetAutlistforFields(defvalue) {
        $("#txtFilterParty").autocomplete({
            minLength: 0, autoFocus: true,
            source: arrParty,
            select: function (event, ui) {
                $("#txtFilterParty").val(ui.item.name);
                return false;
            },
        }).autocomplete("instance")._renderItem = function (ul, item) {
            return $("<li class='each'>")
                .append("<div class='acItem'><span class='name'>" +
                    item.label + "</span></div>")
                .appendTo(ul);
        };
    }
    $('#btnFilter').click(function (e) {
        var dmode = nTransMode == "1" ? "3" : "2";
        GetFilterData(dmode, 1);
    });
    var Showall = '@Session["Showallstatus"]';
    $("#chkShowAll").prop("checked", Showall == '1');
    function GetFilterData(nMode,ClickType = 0) {//arrVendorName,divErrFTo,divErrFFrom,divErrFParty
        var IsValid = true;
        $(".clrdivs").html("");
        if ($("#txtFilterParty").val() != "") {
            var pd = arrParty.filter(t => t.name == $("#txtFilterParty").val().trim());
            const exists = pd.length > 0;
            if (!exists) {
                IsValid = false;
                $("#divErrFParty").html("Select Party Name from list");
            }
        }
        if ($("#dtpFFrom").val() =="") {
            IsValid = false;
            $("#divErrFFrom").html("From date should not be empty");
        }
        if ($("#dtpFTo").val() == "") {
            IsValid = false;
            $("#divErrFTo").html("To date should not be empty");
        }
        if ($("#dtpFFrom").val() > $("#dtpFTo").val()) {
            IsValid = false;
            $("#divErrFFrom").html("From date should be lessthan To Date");
        }
        if (IsValid) {
            var strFAcc = $("#cmbFilterAccountNo").val(), strParty = $("#txtFilterParty").val(), dFrom = $("#dtpFFrom").val(),
                dTo = $("#dtpFTo").val(), chkshow = $("#chkShowAll").is(":checked") ? "1" : "0";
            $.ajax({
                url: Aurl + "bouncerealisation/getfilterdata",
                type: 'get',
                contentType: 'json',
                data: { Mode: nMode, TransID: nTransMode, AccName: strFAcc, Party: strParty, FromDate: dFrom, ToDate: dTo, Showall: chkshow },
                xhrFields: {
                    withCredentials: true
                },
                success: function (data) {
                    if (nMode == 2)
                    {
                        DocumentData.draw().clear(); Table.draw().clear();
                        var billjsdata = eval(data);
                        $('#tblMasterData').DataTable({
                            pageLength: ItemsperPage, lengthMenu: [[10, 20, 50, 100, -1], [10, 20, 50, 100, "All"]],
                            scrollY: "450px",
                            scrollX: true,
                            scrollCollapse: true,
                            paging: true,
                            destroy: true,
                            data: billjsdata,
                            fixedColumns: false,
                            searching: true,
                            ordering: true,
                            sorting: false,
                            pageLength: ItemsperPage, // default page size
                            lengthMenu: [[10, 20, 50, 100, -1], [10, 20, 50, 100, "All"]],
                            columns: [
                                { "data": "ID", "autoWidth": true, "visible": false, className: "dt-body-left" },//0
                                { "data": "StatusID", "autoWidth": true, "visible": false, className: "dt-body-left" },//0
                                {
                                    className: "dt-body-center",
                                    "mRender": function (data, type, value, meta) {
                                        var rowIndex = (meta.row + 1);
                                        var _action = rowIndex;
                                        return _action;
                                    },
                                },
                                { "data": "DocID", "autoWidth": true, className: "dt-body-left" },//1
                                { "data": "DocDate", "autoWidth": true, className: "dt-body-left" },//2
                                { "data": "RefNo", "autoWidth": true, className: "dt-body-left" },//3
                                { "data": "PartyID", "autoWidth": true, className: "dt-body-left" },//4
                                { "data": "BankAccID", "autoWidth": true, className: "dt-body-left" },//5
                                { "data": "IFSC", "autoWidth": true, className: "dt-body-right" },//6                            
                                { "data": "ChequeNo", "autoWidth": true, className: "dt-body-right" },//9
                                { "data": "NetAmt", "autoWidth": true, className: "dt-body-left" },//5
                                { "data": "Salesman", "autoWidth": true, className: "dt-body-right" },//6                                                        
                                { "data": "Status", "autoWidth": true, className: "dt-body-left" },//10                            
                                {
                                    className: "dt-body-center",
                                    "mRender": function (data, type, value) {
                                        var _action = value.Status == 'Amended' || value.Status == 'Cancelled' ? '' : '<a href="javascript:void(0)" style="cursor: pointer;"><span class="glyphicon glyphicon-remove-circle clsCancel" style="font-size:16px" title="Cancel"></span></a>';
                                        return _action;
                                    }, "visible": $("#txtCancelID").val() == 0 ? false : true
                                },//12

                            ],

                        });
                        Table = $('#tblMasterData').DataTable();
                        if (!Table.data().any()) {
                            if (ClickType == 1)
                                showErrorSnackbar("No records found");
                        }
                        //if (data.length > 0) {                            
                        //    $.each(data, function (i, items) {
                        //        Table.row.add([
                        //            items.ID,
                        //            items.StatusID,
                        //            (i + 1),
                        //            items.DocID,
                        //            items.DocDate,
                        //            items.PartyID,
                        //            items.BankAccID,
                        //            items.BankName,
                        //            items.IFSC,
                        //            items.ChequeNo,
                        //            items.NetAmt,
                        //            items.Salesman,
                        //            items.Status,
                        //            items.Status == 'Close' || items.Status == 'Bounce' ? '<a href="javascript:void(0) style="cursor: pointer;"><span class="glyphicon glyphicon-remove-circle clsCancel" style="font-size:16px" title="Cancel"></span></a>' : '',
                        //        ]).draw(false);
                        //    });
                        //}
                        //else {
                        //    if (ClickType == 1)
                        //        showErrorSnackbar("No records found");
                        //}
                    }
                    else if (nMode == 3) {
                        DocumentData.draw().clear(); DocumentData.draw().clear();
                        if (data.length > 0) {
                            $.each(data, function (i, items) {
                                DocumentData.row.add([
                                    items.ID,
                                    items.StatusID,
                                    '<input type="checkbox" id="chkActive' + i + '"  name="Active" />',
                                    items.DocID,
                                    items.DocDate,
                                    items.PartyID,
                                    items.BankAccID,
                                    items.BankName,
                                    items.IFSC,
                                    items.ChequeNo,
                                    items.NetAmt,
                                    items.Salesman,
                                    items.Status,
                                ]).draw(false);
                            });
                        }
                    }
                    else {
                        if (ClickType == 1)
                            showErrorSnackbar("No records found");
                    }
                }, error: function (data) {
                    if (data.status == "401") {
                        var msg = data.responseJSON.Message;
                        ////showErrorSnackbar(msg + " Logout and Login again.");
                    }
                }
            });
        }
    }
    $('#chkSelectAll').click(function () {
        var IsChk = $('#chkSelectAll').is(':checked');
        //alert(IsChk);
        $('#tblDocumentData tr td input').each(function (i, items) {
            items.checked = IsChk;
        });
    });
         
    $('#tblMasterData tbody').on('click', '.clsCancel', function (e) {
        var rdo1 = $("#rdoMainTableData").is(":checked");
        $(".clrdivs").html("");
        rowdata = Table.row($(this).parents('tr')).data();
        var selrow = Table.row($(this).parents('tr')).index();
        var ID = rowdata.ID;//[0];
        var sts = rowdata.StatusID;//[1];
        if (sts != "4") {
            var conf = confirm("Do you want to cancel?");
            if (conf) {
                CancelDeposit(ID, sts);
            }
        }
        else {
            showErrorSnackbar("This document already cancelled");
        }
        //$(".FormclrField,.FormclrcmbField").prop("disabled", true);
        //$("input[type=checkbox],#btnSave,#btnClear,#btnDraft").prop("disabled", true);
        //showErrorSnackbar("Cancel functionality still developing");
    });
    $("#chkBRType").click(function (e) {
        var ischk = $("#chkBRType").is(":checked");
        $("#txtBankCharge").prop("disabled", !ischk);
    });
    $("#btnClear").click(function () {
        //ClearForm();
        if (cfFocus != 3) { ClearConfirmDialogMsg("Do you want to clear?"); } else { ClearForm(); }
        $("#MainHeading").text("Create Bounce & Realisation");
    });
    function ClearForm() {
        $(".FormclrField").val("");
        $(".FormclrcmbField").val(0);
        $(".clrdivs").html("");
        $(".FormclrField,.FormclrcmbField,#btnSave,#btnClear,#btnDraft,#btnClose").prop("disabled", false);
        $("#btnPreview,#btnPDF").prop("disabled", true);
        DocumentData.draw().clear();
        DocumentData.draw().clear();
        GetData(1);
        //GetData(4);
        setDate("dtpDate", 0);
        SetFilterDate();
        setDate("dtpAsonDate", 0);
        if (nTransMode != 1) {
            $("#dvMain").hide();
            $("#dvDocuments").show();
        }
        setTimeout(function () { GetFilterData(3); }, 800);
        $("#chkBRType").prop("checked", false);
        $("#txtBankCharge").prop("disabled", true);
        $("#MainHeading").text("Bounce & Realisation");
        $('#txtDepBankName,#txtDepIFSC').prop("disabled", true);
    }
    function displayResult(item) {
        $('.alert').show().html('You selected <strong>' + item.value + '</strong>: <strong>' + item.text + '</strong>');
    }
    $("#btnPaymentAccept").click(function () {
        //SaveData()
        if ($("#dtpDate").val() == "") {
            IsValid = false;
            $("#divErrDate").html("Date should not be empty");
            showErrorSnackbar("Date should not be empty");
        }
        else {
            if (cfFocus != 3) {
                ConfirmDialogMsg("Do you want to save data?");
            } else {
                SaveData();
            }
        }       
    });
    function SaveValidation() {
        var IsValid = true;
        $(".clrdivs").html("");          
        
        if (IsValid) {
            if (DocumentData.rows().count() == 0) {
                IsValid = false;
                showErrorSnackbar("No documents found");
            } else {
                var chkanyone = false;
                $('#tblDocumentData tr td input').each(function (i, items) {
                    if (items.checked) {
                        chkanyone = true;
                    }
                });
                if (!chkanyone) {
                    showErrorSnackbar("Check anyone document");
                    IsValid = false;
                }
            }
        }
        if (IsValid) {
            modalPayment.style.display = "block";
        }
        return IsValid;
    }
    var DocArray = [];
    function addDocumentinArray() {
        DocArray = [];
        var nAccID = 0, nCollID = 0, nDepID = 0,nChqStatus = 0;
        $("#tblDocumentData tbody tr").each(function () {
            var allValues = {};
            var chekdoc = false;
            rowdata = DocumentData.row($(this)).data();
            nDepID = rowdata[0];
            nChqStatus = rowdata[1];           
            $(this).find("input[type=checkbox]").each(function (index) {
                chekdoc = $(this).is(":checked");
            });
            if (chekdoc) {
                var listProds = {                    
                    "DepID": nDepID,
                    "Status" : nChqStatus
                }
                DocArray.push(listProds);
            }
        });
    }
    function SaveData() {
        //showErrorSnackbar("Validation success");
        $("#btnSave").prop("disabled", true);
        addDocumentinArray();
        var listTrans = {
            "IsDraft": nIsDraft,
            "ID": $("#txtID").val(),
            "DocDate": $("#dtpDate").val(),
            "TransMode": $("#chkBRType").is(":checked") ? 9 : 5,
            "Docprefix": nDocprefix,
            "ChequeBRDate": $("#dtpDate").val(),
            "BankCharge": $("#txtBankCharge").val(),
            "Status":$("#txtStatus").val(),
            "CurrentStatus": $("#txtStatus").val(),
            "CBy": UID,
            "chequedepositsdocs": DocArray,
        }
        $.ajax({
            url: Aurl + "bouncerealisation/save",
            type: 'POST',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(listTrans),
            cache: false,
            processData: false,
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                $("#btnSave").prop("disabled", false);
                $.each(data, function (i, items) {
                    if (items.MsgID == 0) {
                        showSuccessSnackbar(items.Message);
                        ClearForm();
                        modalPayment.style.display = "none";
                        setTimeout(function () {
                            GetData(2, 0);
                        }, 500);
                    }
                    else {
                        //$("#dvErrorName").html(items.Message);
                        showErrorSnackbar(items.Message);
                    }
                });
            }, error: function (data) {
                $("#btnSave").prop("disabled", false);
                if (data.status == "401") {
                    var msg = data.responseJSON.Message;
                    ////showErrorSnackbar(msg + " Logout and Login again.");
                }
            }
        });
    }
    $("#btnSave").click(function () {
        //SaveData()
        if (SaveValidation()) {
            if (cfFocus != 3) {
                //ConfirmDialogMsg("Do you want to save data?");
            } else {
                //SaveData();
            }
        }
    });
    var cfFocus = '@Session["ConfirmFocus"]';
function ConfirmDialogMsg(message) {
    var IsAccepted = false;
    $(".ui-dialog-titlebar-close").hide();
    $('<div></div>').appendTo('body')
        .html('<div><h6>' + message + '</h6></div>')
        .dialog({
            modal: true,
            closeOnEscape: true,
            title: 'Confirm Popup',
            zIndex: 100,
            autoOpen: true,
            width: '300px',
            resizable: true,
            close: false,
            open: function () {
                $(this).closest(".ui-dialog")
                    .find(".ui-dialog-titlebar-close")
                    .removeClass("ui-dialog-titlebar-close")
                    .html("x");
            },
            buttons: [
                {
                    text: "Yes",
                    class: "btn btn-success clsYes",
                    click: function () {
                        $(this).dialog("close");
                        SaveData();
                    },
                },
                {
                    text: "No",
                    class: "btn btn-danger clsNo cfforeclr",
                    click: function () {
                        $(this).dialog("close");
                    }
                }
            ],
        });
    if (cfFocus == 1) {
        $(".clsYes").focus();
    }
    else {
        $(".clsNo").focus();
    }
};
function ClearConfirmDialogMsg(message) {
    var IsAccepted = false;
    $(".ui-dialog-titlebar-close").hide();
    $('<div></div>').appendTo('body')
        .html('<div><h6>' + message + '</h6></div>')
        .dialog({
            modal: true,
            closeOnEscape: true,
            title: 'Confirm Popup',
            zIndex: 100,
            autoOpen: true,
            width: '300px',
            resizable: true,
            close: false,
            open: function () {
                $(this).closest(".ui-dialog")
                    .find(".ui-dialog-titlebar-close")
                    .removeClass("ui-dialog-titlebar-close")
                    .html("x");
            },
            buttons: [
                {
                    text: "Yes",
                    class: "btn btn-success clsclrYes",
                    click: function () {
                        $(this).dialog("close");
                        ClearForm();
                    },
                },
                {
                    text: "No",
                    class: "btn btn-danger clsclrNo",
                    click: function () {
                        $(this).dialog("close");
                    }
                }
            ],
        });
    if (cfFocus == 1) {
        $(".clsclrYes").focus();
    }
    else {
        $(".clsclrNo").focus();
    }
    };
    function BranchInfoDialogMsg(message) {
        var IsAccepted = false;
        $(".ui-dialog-titlebar-close").hide();
        $('<div></div>').appendTo('body')
            .html('<div><h6>' + message + '</h6></div>')
            .dialog({
                modal: true,
                closeOnEscape: true,
                title: 'Branch wise ABS',
                zIndex: 100,
                autoOpen: true,
                width: '400px',
                resizable: true,
                close: false,
                open: function () {
                    $(this).closest(".ui-dialog")
                        .find(".ui-dialog-titlebar-close")
                        .removeClass("ui-dialog-titlebar-close")
                        .html("x");
                },
                buttons: [
                    {
                        text: "Close",
                        class: "btn btn-warning clsclrNo",
                        click: function () {
                            $(this).dialog("close");
                        }
                    }
                ],
            });
        $(".clsclrNo").focus();
    };
</script>