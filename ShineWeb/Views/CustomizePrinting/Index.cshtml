@model ShineWeb.Models.SingleMasterModel
@{
    ViewBag.Title = ViewData["FormName"];
}
<link href="~/Content/bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/bootstrap.min.3.4.1.css" rel="stylesheet" />
<link href="~/Content/dataTables.bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/navbar.css" rel="stylesheet" />
<link href="~/Content/buttonTop.css" rel="stylesheet" />
<link href="~/Content/dataTables.dataTables.2.2.2.css" rel="stylesheet" />

<script src="~/Scripts/bootstrap.min.js"></script>
<script src="~/Scripts/jquery-1.10.2.min.js"></script>
<script src="~/Scripts/bootstrap.min.3.4.1.js"></script>
<script src="~/Scripts/jquery-3.7.1.js"></script>
<script src="~/Scripts/jquery-ui.js"></script>
<script src="~/Scripts/datatable.js"></script>
<script src="~/Scripts/dataTables.2.2.2.js"></script>
<script src="~/Scripts/js/refreshtoken.js"></script>
@* Google Fonts *@
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
    /* Modern CSS Variables */
    :root {
        /* Colors */
        --primary-50: #eff6ff;
        --primary-100: #dbeafe;
        --primary-500: #3b82f6;
        --primary-600: #2563eb;
        --primary-700: #1d4ed8;
        --primary-800: #1e40af;
        
        --secondary-500: #8b5cf6;
        --secondary-600: #7c3aed;
        --secondary-700: #6d28d9;
        
        --accent-500: #14b8a6;
        --accent-600: #0d9488;
        
        --success-500: #10b981;
        --success-600: #059669;
        
        --warning-500: #f59e0b;
        --warning-600: #d97706;
        
        --danger-500: #ef4444;
        --danger-600: #dc2626;
        
        --gray-50: #f8fafc;
        --gray-100: #f1f5f9;
        --gray-200: #e2e8f0;
        --gray-300: #cbd5e1;
        --gray-400: #94a3b8;
        --gray-500: #64748b;
        --gray-600: #475569;
        --gray-700: #334155;
        --gray-800: #1e293b;
        --gray-900: #0f172a;
        
        /* Typography */
        --font-primary: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        --font-secondary: 'Poppins', sans-serif;
        
        /* Spacing */
        --space-1: 0.25rem;
        --space-2: 0.5rem;
        --space-3: 0.75rem;
        --space-4: 1rem;
        --space-5: 1.25rem;
        --space-6: 1.5rem;
        --space-8: 2rem;
        
        /* Shadows */
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        
        /* Border Radius */
        --radius-sm: 0.375rem;
        --radius-md: 0.5rem;
        --radius-lg: 0.75rem;
        --radius-xl: 1rem;
        
        /* Transitions */
        --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
        --transition-base: 250ms cubic-bezier(0.4, 0, 0.2, 1);
        --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    /* Reset and Base Styles */
    * {
        box-sizing: border-box;
    }
    
    body {
        font-family: var(--font-primary);
        color: var(--gray-800);
        background: linear-gradient(135deg, var(--gray-50) 0%, var(--primary-50) 100%);
        line-height: 1.6;
    }

    .main {
        padding-left: 10px !important;
        padding-top: 25px !important;
        padding-bottom: 30px !important;
        width: 100% !important;
        margin-left: 10px !important;
        z-index: 9999 !important;
    }

    .table > thead:first-child > tr:first-child > th {
        border-top: 0 !important;
        display: none !important;
    }

    body {
        padding-top: -20px !important;
    }

    #controls {
        margin-bottom: 10px;
    }

    #paper {
        position: relative;
        border: 2px solid #444;
        background: #fff;
        margin-top: 10px;
        overflow: hidden;
        /*        max-width:1024px;
        max-height:625px;*/
    }

    .label, .line, .headerhline, .bodyhline, .footerhline, .headervline, .bodyvline, .footervline, .box, .image, .value, .headerlabel, .bodylabel, .footerlabel, .headervalue, .bodyvalue, .footervalue,
    .headerbox, .bodybox, .footerbox, .imageheader, .imagefooter, .barcodeheader, .qrcodeheader, .qrcodefooter, .barcodefooter,
    .headerformula, .bodyformula, .footerformula {
        position: absolute;
        cursor: move;
        /*transform-origin: center center;*/
    }

    .label, .headerlabel {
        padding: 3px 6px;
        background: #00FF00;
        border: 1px solid #666;
        min-width: 40px;
        color: black;
        align-content: flex-start;
    }

    .bodylabel {
        padding: 3px 6px;
        background: #DDA0DD;
        border: 1px solid #666;
        min-width: 40px;
        color: black;
        align-content: flex-start;
    }

    .footerlabel {
        padding: 3px 6px;
        background: #FFFF00;
        border: 1px solid #666;
        min-width: 40px;
        color: black;
        align-content: flex-start;
    }

    .value, .headervalue {
        padding: 3px 6px;
        background: #228B22;
        border: 1px solid #666;
        min-width: 20px;
        color: black;
        align-content: flex-start;
    }

    .bodyvalue {
        padding: 3px 6px;
        background: #FF00FF;
        border: 1px solid #666;
        min-width: 20px;
        color: black;
        align-content: flex-start;
    }

    .footervalue {
        padding: 3px 6px;
        background: #DAA520;
        border: 1px solid #666;
        min-width: 20px;
        color: black;
        align-content: flex-start;
    }

    .selected {
        outline: 2px dashed #f6591e;
    }

    .context-menu {
        position: absolute;
        background: #fff;
        border: 1px solid #aaa;
        z-index: 1000;
        display: none;
        font-size: 14px;
    }

        .context-menu div {
            padding: 2px 5px;
            cursor: pointer;
        }

            .context-menu div:hover {
                background: #f0f0f0;
            }

    .line, .headerhline, .bodyhline, .footerhline, .headervline, .bodyvline, .footervline {
        background: #000;
    }

    .box, .headerbox {
        border: 2px solid #00FF00;
        background: transparent;
    }

    .bodybox {
        border: 2px solid #DDA0DD;
        background: transparent;
    }

    .footerbox {
        border: 2px solid #FFFF00;
        background: transparent;
    }

    .resize-handle, .rotate-handle {
        position: absolute;
        width: 8px;
        height: 8px;
        background: #0078d7;
        border: 1px solid #fff;
        border-radius: 50%;
        z-index: 10;
        display: inline-block;
    }
    
    /* Selection Box for Drag-to-Select */
    .selection-box {
        position: absolute;
        border: 2px solid #3b82f6;
        background: rgba(59, 130, 246, 0.2);
        pointer-events: none;
        z-index: 99999;
    }

        .resize-handle.nw {
            top: -4px;
            left: -4px;
            cursor: nwse-resize;
        }

        .resize-handle.ne {
            top: -4px;
            right: -4px;
            cursor: nesw-resize;
        }

        .resize-handle.sw {
            bottom: -4px;
            left: -4px;
            cursor: nesw-resize;
        }

        .resize-handle.se {
            bottom: -4px;
            right: -4px;
            cursor: nwse-resize;
        }

        .resize-handle.n {
            top: -4px;
            left: 50%;
            transform: translateX(-50%);
            cursor: ns-resize;
        }

        .resize-handle.s {
            bottom: -4px;
            left: 50%;
            transform: translateX(-50%);
            cursor: ns-resize;
        }

        .resize-handle.e {
            right: -4px;
            top: 50%;
            transform: translateY(-50%);
            cursor: ew-resize;
        }

        .resize-handle.w {
            left: -4px;
            top: 50%;
            transform: translateY(-50%);
            cursor: ew-resize;
        }

    .rotate-handle {
        width: 12px;
        height: 12px;
        top: -25px;
        left: 50%;
        transform: translateX(-50%);
        background: #ff5722;
        cursor: grab;
    }

    .image, .imageheader img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        border: 1px solid #00FF00;
    }

    .imagefooter img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        border: 1px solid #FFFF00;
    }

    .barcodeheader img {
        background-image: url(data:image/png;base64,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);
        border: 2px solid #00FF00;
        width: 100%;
        height: 100%;
        object-fit: contain;
        background-repeat: no-repeat;
        background-position: center;
    }

    .qrcodeheader img {
        background-image: url(data:image/png;base64,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);
        border: 2px solid #00FF00;
        width: 100%;
        height: 100%;
        object-fit: contain;
        background-repeat: no-repeat;
        background-position: center;
    }

    .barcodefooter img {
        background-image: url(data:image/png;base64,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);
        border: 2px solid #FFFF00;
        width: 100%;
        height: 100%;
        object-fit: contain;
        background-repeat: no-repeat;
        background-position: center;
    }

    .qrcodefooter img {
        background-image: url(data:image/png;base64,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);
        border: 2px solid #FFFF00;
        width: 100%;
        height: 100%;
        object-fit: contain;
        background-repeat: no-repeat;
        background-position: center;
    }
    .headerformula {
        padding: 3px 6px;
        background: #00BFFF;
        border: 1px solid #666;
        min-width: 20px;
        color: black;
        align-content: flex-start;
    }
    
    .bodyformula {
        padding: 3px 6px;
        background: #8A2BE2;
        border: 1px solid #666;
        min-width: 20px;
        color: black;
        align-content: flex-start;
    }

    .footerformula {
        padding: 3px 6px;
        background: #5F9EA0;
        border: 1px solid #666;
        min-width: 20px;
        color: black;
        align-content: flex-start;
    }

    .blue-button {
        background-color: #007bff;
        color: white;
        padding: 6px 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    .edit-icon-button {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 16px;
        margin-left: 5px;
    }

    /* Context menu */
    .edit-context-menu {
        position: absolute;
        background-color: white;
        border: 1px solid #ccc;
        display: none;
        flex-direction: column;
        padding: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        z-index: 1000;
    }

        .edit-context-menu button {
            margin: 3px 0;
        }


    .child-tabs {
        margin-top: 10px;
        color: black;
    }
</style>
<style>
     /* Modal FOR QR and SaveAs */
    .modalQRBarcode {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
        animation: fadeIn var(--transition-base);
    }

    /* Modal Content/Box */
    @@media only screen and (min-width: 800px) {
        .modalQRBarcode-content {
            background-color: #ffffff;
            margin: 3% auto;
            padding: 0;
            border: none;
            border-radius: var(--radius-xl);
            width: 40%;
            max-height: 40% !important;
            top: 2% !important;
            overflow: auto;
            box-shadow: var(--shadow-xl);
            animation: slideDown var(--transition-slow);
        }
    }

    @@media only screen and (max-width: 600px) {
        .modalQRBarcode-content {
            background-color: #ffffff;
            margin: 10% auto;
            padding: 0;
            border: none;
            border-radius: var(--radius-xl);
            width: 95%;
            height: 70%;
            top: 20%;
            overflow: auto;
            box-shadow: var(--shadow-xl);
        }
    }
   
    /* The Close Button */
    .closemodalQRBarcode {
        color: var(--gray-400);
        float: right;
        font-size: 28px;
        font-weight: bold;
        line-height: 20px;
        transition: color var(--transition-fast);
    }

        .closemodalQRBarcode:hover,
        .closemodalQRBarcode:focus {
            color: var(--danger-500);
            text-decoration: none;
            cursor: pointer;
        }
    
    @@keyframes slideDown {
        from {
            transform: translateY(-50px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }
    
    /* Modal Header */
    .modal-header {
        background: linear-gradient(135deg, var(--primary-600) 0%, var(--secondary-600) 100%);
        color: white;
        padding: var(--space-5);
        border-radius: var(--radius-xl) var(--radius-xl) 0 0;
        border-bottom: none;
    }
    
        .modal-header .modal-title {
            color: white;
            font-family: var(--font-secondary);
            font-weight: 600;
            font-size: 1.25rem;
        }
    
    /* Modal Body */
    .modal-body {
        padding: var(--space-6);
    }
    
    /* Modal Footer */
    .modal-footer {
        background: var(--gray-50);
        padding: var(--space-4) var(--space-6);
        border-radius: 0 0 var(--radius-xl) var(--radius-xl);
        border-top: 1px solid var(--gray-200);
    }

    .form-label {
        position: relative;
        display: block;
        clear: both;
        max-width: 500px;
        margin: 0 auto;
    }

    .labelup {
        -webkit-transform: translateY(50%);
        -moz-transform: translateY(-50%);
        -ms-transform: translateY(-50%);
        -o-transform: translateY(-50%);
        transform: translateY(50%);
        -webkit-transition: all 0.2s ease-in-out;
        -moz-transition: all 0.2s ease-in-out;
        transition: all 0.2s ease-in-out;
        position: absolute;
        top: -40%;
        left: 1em;
        background: #fffefe;
        color: #2b2828;
        font-size: 0.8em;
        cursor: text;
        pointer-events: none;
        font-family: var(--font-primary);
        font-weight: 500;
    }
    
    /* Modern Form Controls */
    select:not([style*="inline"]),
    .form-control {
        border: 2px solid var(--gray-300);
        border-radius: var(--radius-md);
        padding: var(--space-3);
        font-family: var(--font-primary);
        font-size: 0.9rem;
        transition: all var(--transition-base);
        background: white;
        color: var(--gray-800);
    }
    
        select:focus,
        .form-control:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        select:hover:not(:focus),
        .form-control:hover:not(:focus) {
            border-color: var(--gray-400);
        }
    
    textarea.form-control,
    textarea.formc {
        border: 2px solid var(--gray-300);
        border-radius: var(--radius-md);
        padding: var(--space-3);
        font-family: var(--font-primary);
        font-size: 0.9rem;
        transition: all var(--transition-base);
        resize: vertical;
    }
    
        textarea.form-control:focus,
        textarea.formc:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

    input[type=number] {
        text-align: right;
    }

        input[type=number]::placeholder {
            text-align: left;
        }
    /* Chrome, Safari, Edge, Opera */
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    /* Firefox */
    input[type=number] {
        -moz-appearance: textfield;
    }
    /* Modal FOR Formula */
    .modalFormula {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 25%;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
    }

    /* Modal Content/Box */
    @@media only screen and (min-width: 800px) {
        .modalFormula-content {
            background-color: #ffffff;
            padding: 0;
            border: none;
            border-radius: var(--radius-xl);
            width: 40%;
            max-height: 40% !important;
            top: 5% !important;
            overflow: auto;
            box-shadow: var(--shadow-xl);
            animation: slideDown var(--transition-slow);
        }
    }

    @@media only screen and (max-width: 600px) {
        .modalFormula-content {
            background-color: #ffffff;
            margin: 10% auto;
            padding: 0;
            border: none;
            border-radius: var(--radius-xl);
            width: 95%;
            height: 70%;
            top: 20%;
            overflow: auto;
            box-shadow: var(--shadow-xl);
        }
    }

    /* The Close Button */
    .closemodalFormula {
        color: var(--gray-400);
        float: right;
        font-size: 28px;
        font-weight: bold;
        line-height: 20px;
        transition: color var(--transition-fast);
    }

        .closemodalFormula:hover,
        .closemodalFormula:focus {
            color: var(--danger-500);
            text-decoration: none;
            cursor: pointer;
        }
</style>
<style>

    .container {
        width: 260px;
        background: white;
        border: none;
        padding: var(--space-4);
        box-shadow: var(--shadow-lg);
        border-radius: var(--radius-lg);
    }

    .section {
        margin-bottom: var(--space-4);
        border: none;
        padding: var(--space-4);
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
        color: var(--gray-800);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-md);
        transition: all var(--transition-base);
    }
    
        .section:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

    .Headersection {
        margin-bottom: var(--space-4);
        border:  none;
        padding: var(--space-4);
        background: white;
        color: var(--gray-800);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-md);
        transition: all var(--transition-base);
    }
    
        .Headersection:hover {
            box-shadow: var(--shadow-lg);
        }

    .Bodysection {
        margin-bottom: var(--space-4);
        border: none;
        padding: var(--space-4);
        background: white;
        color: var(--gray-800);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-md);
        transition: all var(--transition-base);
    }
    
        .Bodysection:hover {
            box-shadow: var(--shadow-lg);
        }

    .Footersection {
        margin-bottom: var(--space-4);
        border: none;
        padding: var(--space-4);
        background: white;
        color: var(--gray-800);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-md);
        transition: all var(--transition-base);
    }
    
        .Footersection:hover {
            box-shadow: var(--shadow-lg);
        }

    .section-title {
        font-family: var(--font-secondary);
        font-weight: 600;
        font-size: 1.1rem;
        margin-bottom: var(--space-3);
        color: var(--primary-700);
    }

    .radio-group {
        display: flex;
        align-items: center;
        gap: var(--space-4);
        margin-bottom: var(--space-3);
        justify-content: space-evenly;
    }

    .button-group {
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-2);
        justify-content: right;
        margin-top: var(--space-4);
    }

        .button-group button {
            background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            padding: var(--space-2) var(--space-4);
            font-family: var(--font-primary);
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-base);
            box-shadow: var(--shadow-sm);
        }
        
            .button-group button:hover {
                transform: translateY(-2px);
                box-shadow: var(--shadow-md);
                background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
            }
            
            .button-group button:active {
                transform: translateY(0);
            }

    .colors {
        display: grid;
        grid-template-columns: 20px auto;
        gap: 5px;
        font-size: 12px;
        align-items: center;
    }

    .color-box {
        width: 18px;
        height: 18px;
        border: 1px solid #000;
    }

    /* Color Legend */
    .formula-header {
        background-color: #ff99cc;
    }

    .formula-body {
        background-color: violet;
    }

    .formula-footer {
        background-color: lightblue;
    }

    /* color show*/
    /* Green: #00FF00 */
    .dvsheaderlabel,
    .dvsheaderbox,
    .dvsimageheader,
    .dvsbarcodeheader,
    .dvsqrcodeheader {
        background-color: #00FF00;
    }

    /* Purple: #DDA0DD */
    .dvsbodylabel,
    .dvsbodybox {
        background-color: #DDA0DD;
    }

    /* Yellow: #FFFF00 */
    .dvsfooterlabel,
    .dvsfooterbox,
    .dvsimagefooter,
    .dvsbarcodefooter,
    .dvsqrcodefooter {
        background-color: #FFFF00;
    }

    /* Dark Green: #228B22 */
    .dvsheadervalue {
        background-color: #228B22;
    }

    /* Magenta: #FF00FF */
    .dvsbodyvalue {
        background-color: #FF00FF;
    }

    /* Goldenrod: #DAA520 */
    .dvsfootervalue {
        background-color: #DAA520;
    }
    .dvsheaderformula {
        background-color: #00BFFF;
    }


    .dvsbodyformula {
        background-color: #8A2BE2;
    }


    .dvsfooterformula {
        background-color: #5F9EA0;
    }
    @@media screen and (min-width: 768px) {
        .modal-dialog {
            right: auto !important;
            left: 1% !important;
            width: 80% !important;
            padding-top: 30px !important;
            padding-bottom: 30px !important;
        }
    }

    .edit-context-menu {
        display: flex none;
        justify-content: space-between;
        align-items: center;
        gap: var(--space-3);
        padding: var(--space-3);
        background: rgba(255, 255, 255, 0.98);
        border: 1px solid var(--gray-200);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-xl);
        backdrop-filter: blur(20px);
    }

    .menu-left,
    .menu-right {
        display: flex;
        align-items: center;
        gap: var(--space-2);
    }

    /* Modern Button Styles */
    .btn {
        padding: var(--space-2) var(--space-4);
        border-radius: var(--radius-md);
        font-family: var(--font-primary);
        font-weight: 500;
        cursor: pointer;
        transition: all var(--transition-base);
        border: none;
    }
    
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn:active {
            transform: translateY(0);
        }
    
    /* Modern Tabs */
    .nav-tabs {
        border-bottom: 2px solid var(--gray-200);
        margin-bottom: var(--space-4);
    }
    
        .nav-tabs > li {
            margin-bottom: -2px;
        }
    
        .nav-tabs > li > a {
            color: var(--gray-600);
            border-radius: var(--radius-md) var(--radius-md) 0 0;
            padding: var(--space-3) var(--space-5);
            transition: all var(--transition-base);
            font-family: var(--font-secondary);
            font-weight: 500;
        }
    
            .nav-tabs > li > a:hover {
                background: var(--gray-100);
                border-color: var(--gray-200);
                color: var(--primary-600);
            }
    
        .nav-tabs > li.active > a,
        .nav-tabs > li.active > a:hover,
        .nav-tabs > li.active > a:focus {
            background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
            color: white;
            border: none;
            box-shadow: var(--shadow-md);
        }
    
    /* Child Tabs Styling */
    .child-tabs {
        margin-top: var(--space-4);
        color: var(--gray-800);
    }
    
    /* Tab Content */
    .tab-content {
        padding: var(--space-4);
        background: white;
        border-radius: 0 var(--radius-lg) var(--radius-lg) var(--radius-lg);
        box-shadow: var(--shadow-md);
    }
    
    .tab-pane {
        animation: fadeIn var(--transition-base);
    }
    
    @@keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

</style>
<body>
    @Html.HiddenFor(model => model.FormName, new { @autocomplete = "off", @class = "form-control", @id = "txtFormName" })
    @Html.HiddenFor(model => model.ID, new { @autocomplete = "off", @class = "form-control FormclrField", @id = "txtID" })
    @*<h4 id="MainHeading">@ViewData["FormName"]</h4>
        <hr />*@
    <div class="toastBox"></div>
    @*<div class="qrcodeheader"></div>
        <div class="barcodeheader"></div>*@
    <div class="row modern-control-bar" style="background: linear-gradient(135deg, var(--primary-600) 0%, var(--secondary-600) 100%); 
                                               box-shadow: var(--shadow-lg); 
                                               border-radius: var(--radius-lg); 
                                               padding: var(--space-2) var(--space-4); 
                                               margin-bottom: var(--space-4);">
        <div id="controls" style="padding-top:0;">
            <table>
                <tr>
                    <td width="55%">
                        <select id="paperType" style="max-width: 250px; border-radius: var(--radius-md); 
                                                      border: 2px solid rgba(255,255,255,0.3); 
                                                      background: rgba(255,255,255,0.95); 
                                                      padding: var(--space-2) var(--space-3); 
                                                      font-family: var(--font-primary); 
                                                      font-weight: 500;
                                                      transition: all var(--transition-base);
                                                      box-shadow: var(--shadow-sm);">
                            <option value="A4">A4</option>
                            <option value="A5">A5</option>
                            <option value="A5L">A5 - Landscape</option>
                            <option value="custom">Custom</option>
                        </select>
                        <input type="number" id="customWidth" placeholder="Width mm" style="max-width: 75px; border-radius: var(--radius-md); 
                                                                                           border: 2px solid rgba(255,255,255,0.3); 
                                                                                           background: rgba(255,255,255,0.95); 
                                                                                           padding: var(--space-2) var(--space-3); 
                                                                                           font-family: var(--font-primary);
                                                                                           transition: all var(--transition-base);
                                                                                           box-shadow: var(--shadow-sm);">
                        <input type="number" id="customHeight" placeholder="Height mm" style="max-width: 75px; border-radius: var(--radius-md); 
                                                                                            border: 2px solid rgba(255,255,255,0.3); 
                                                                                            background: rgba(255,255,255,0.95); 
                                                                                            padding: var(--space-2) var(--space-3); 
                                                                                            font-family: var(--font-primary);
                                                                                            transition: all var(--transition-base);
                                                                                            box-shadow: var(--shadow-sm);">
                        <select id="cmbFontNames" style="max-width: 200px; border-radius: var(--radius-md); 
                                                         border: 2px solid rgba(255,255,255,0.3); 
                                                         background: rgba(255,255,255,0.95); 
                                                         padding: var(--space-2) var(--space-3); 
                                                         font-family: var(--font-primary); 
                                                         font-weight: 500;
                                                         transition: all var(--transition-base);
                                                         box-shadow: var(--shadow-sm);">
                            <option value="1">Times New Roman</option>
                            <option value="2">sanserif</option>
                            <option value="3">Pixel</option>
                        </select>
                        <input type="color" style="max-width: 38px; border-radius: var(--radius-md); 
                                                   border: 2px solid rgba(255,255,255,0.3); 
                                                   background: rgba(255,255,255,0.95); 
                                                   cursor: pointer;
                                                   transition: all var(--transition-base);
                                                   box-shadow: var(--shadow-sm);" id="txtColors"/>
                        <input type="number" id="txtFontsize" placeholder="Size" value="8" style="max-width: 75px; border-radius: var(--radius-md); 
                                                                                                  border: 2px solid rgba(255,255,255,0.3); 
                                                                                                  background: rgba(255,255,255,0.95);                                                                                                   
                                                                                                  font-family: var(--font-primary);
                                                                                                  transition: all var(--transition-base);
                                                                                                  box-shadow: var(--shadow-sm);">
                        <label class="checkbox-label modern-checkbox" title="Continues Paper" style="color: white; font-weight: 500; margin-left: var(--space-3);">
                            <input id="chkContinuesPapper" type="checkbox" checked style="margin-right: var(--space-2); cursor: pointer;">
                            CP
                        </label>&emsp;
                        <label class="checkbox-label modern-checkbox" title="Footer on Every Pages" style="color: white; font-weight: 500;">
                            <input id="chkFooteronEveryPage" type="checkbox" style="margin-right: var(--space-2); cursor: pointer;"/>
                            FEP
                        </label>&emsp;
                        <label class="checkbox-label modern-checkbox" style="color: white; font-weight: 500;">
                            <input id="chkIncut" type="checkbox" style="margin-right: var(--space-2); cursor: pointer;">
                            Inc Cut:
                        </label>&emsp;
                        <button class="edit-icon-button modern-icon-btn" id="editBtn" style="background: rgba(255,255,255,0.2); 
                                                                                              border: 2px solid rgba(255,255,255,0.3); 
                                                                                              border-radius: var(--radius-md); 
                                                                                              
                                                                                              cursor: pointer; 
                                                                                              transition: all var(--transition-base);
                                                                                              backdrop-filter: blur(10px);">
                            <img src="~/Images/pencil-case.png" />
                        </button>
                    </td>
                    <td style="padding-left:5px;width:6%">
                        <span class="form-label modern-input-group">
                            <input class="FormclrField modern-input" type="number" id="txtItemsPerPage" value="10" style="max-width: 105px; border-radius: var(--radius-md); 
                                                                                                                          border: 2px solid rgba(255,255,255,0.3); 
                                                                                                                          background: rgba(255,255,255,0.95); 
                                                                                                                          
                                                                                                                          font-family: var(--font-primary);
                                                                                                                          transition: all var(--transition-base);
                                                                                                                          box-shadow: var(--shadow-sm);" placeholder=""
                                   maxlength="2" oninput="javascript: if (this.value.length > this.maxLength) { this.value = this.value.slice(0, this.maxLength); }">
                            <label class="labelup" style="background: transparent; color: white; font-weight: 600; font-size: 0.65em; top: -55%; white-space: nowrap;">Item Per Page</label>
                        </span>
                    </td>
                    <td style="padding-left:5px;width:2%">
                        <span class="form-label modern-input-group" title="Line Feed">
                            <input class="FormclrField modern-input" type="text" value="2" id="txtLF" placeholder="" style="max-width: 55px; border-radius: var(--radius-md); 
                                                                                                                              border: 2px solid rgba(255,255,255,0.3); 
                                                                                                                              background: rgba(255,255,255,0.95); 
                                                                                                                              
                                                                                                                              font-family: var(--font-primary);
                                                                                                                              transition: all var(--transition-base);
                                                                                                                              box-shadow: var(--shadow-sm);"
                                   maxlength="1" oninput="javascript: if (this.value.length > this.maxLength) { this.value = this.value.slice(0, this.maxLength); }">

                            <label class="labelup" style="background: transparent; color: white; font-weight: 600; font-size: 0.7em; top: -55%;">LF</label>
                        </span>
                    </td>
                    <td style="padding-left:5px;width:2%">
                        <span class="form-label modern-input-group" title="Bottom Line Space">
                            <input class="FormclrField modern-input" value="2" type="text" id="txtBLS" placeholder="" style="max-width: 55px; height: 32px; border-radius: var(--radius-md); 
                                                                                                                               border: 2px solid rgba(255,255,255,0.3); 
                                                                                                                               background: rgba(255,255,255,0.95); 
                                                                                                                               
                                                                                                                               font-family: var(--font-primary);
                                                                                                                               transition: all var(--transition-base);
                                                                                                                               box-shadow: var(--shadow-sm);"
                                   maxlength="1" oninput="javascript: if (this.value.length > this.maxLength) { this.value = this.value.slice(0, this.maxLength); }">
                            <label class="labelup" style="background: transparent; color: white; font-weight: 600; font-size: 0.7em; top: -55%;">BLS</label>
                        </span>
                    </td>
                    <td style="padding-left:5px;width:12%">
                        <label style="color: white; font-weight: 500;"><input type="radio" name="PrinterType" id="rdoWindows" checked style="margin-right: var(--space-2); cursor: pointer;"> Windows</label>&emsp;
                        <label style="color: white; font-weight: 500;"><input type="radio" name="PrinterType" id="rdoDOS" style="margin-right: var(--space-2); cursor: pointer;"> DOS</label>
                    </td>
                </tr>
            </table>


        </div>
    </div>
    <!-- Modern Context Menu -->
    <div class="edit-context-menu modern-context-menu" id="editcontextMenu" style="display: none; 
                                                                                    position: absolute;
                                                                                    background: rgba(255, 255, 255, 0.98);
                                                                                    backdrop-filter: blur(20px);
                                                                                    border: 1px solid var(--gray-200);
                                                                                    border-radius: var(--radius-lg);
                                                                                    box-shadow: var(--shadow-xl);
                                                                                    padding: var(--space-3);
                                                                                    z-index: 1000;
                                                                                    gap: var(--space-3);
                                                                                    align-items: center;">
        <div class="menu-left" style="display: flex; gap: var(--space-2); align-items: center;">
            <button id="addLabel" class="btn btn-primary modern-btn" style="background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
                                                                              color: white;
                                                                              border: none;
                                                                              border-radius: var(--radius-md);
                                                                              padding: var(--space-2) var(--space-4);
                                                                              font-weight: 500;
                                                                              cursor: pointer;
                                                                              transition: all var(--transition-base);
                                                                              box-shadow: var(--shadow-sm);">Label</button>
            <button id="addValue" class="btn btn-primary modern-btn" style="background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
                                                                              color: white;
                                                                              border: none;
                                                                              border-radius: var(--radius-md);
                                                                              padding: var(--space-2) var(--space-4);
                                                                              font-weight: 500;
                                                                              cursor: pointer;
                                                                              transition: all var(--transition-base);
                                                                              box-shadow: var(--shadow-sm);">Value</button>
            <button id="addHLine" class="btn btn-primary modern-btn" style="background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
                                                                              color: white;
                                                                              border: none;
                                                                              border-radius: var(--radius-md);
                                                                              padding: var(--space-2) var(--space-4);
                                                                              font-weight: 500;
                                                                              cursor: pointer;
                                                                              transition: all var(--transition-base);
                                                                              box-shadow: var(--shadow-sm);">H-Line</button>
            <button id="addVLine" class="btn btn-primary modern-btn" style="background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
                                                                              color: white;
                                                                              border: none;
                                                                              border-radius: var(--radius-md);
                                                                              padding: var(--space-2) var(--space-4);
                                                                              font-weight: 500;
                                                                              cursor: pointer;
                                                                              transition: all var(--transition-base);
                                                                              box-shadow: var(--shadow-sm);">V-Line</button>
            <button id="addBox" class="btn btn-primary modern-btn" hidden style="background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
                                                                              color: white;
                                                                              border: none;
                                                                              border-radius: var(--radius-md);
                                                                              padding: var(--space-2) var(--space-4);
                                                                              font-weight: 500;
                                                                              cursor: pointer;
                                                                              transition: all var(--transition-base);
                                                                              box-shadow: var(--shadow-sm);">Box</button>
            <button id="addImage" class="btn btn-primary modern-btn" style="background: linear-gradient(135deg, var(--secondary-500) 0%, var(--secondary-600) 100%);
                                                                              color: white;
                                                                              border: none;
                                                                              border-radius: var(--radius-md);
                                                                              padding: var(--space-2) var(--space-4);
                                                                              font-weight: 500;
                                                                              cursor: pointer;
                                                                              transition: all var(--transition-base);
                                                                              box-shadow: var(--shadow-sm);">Image</button>
            <input type="file" id="imageUpload" accept="image/*" style="display:none">
            <button id="showInfo" class="btn btn-outline-primary modern-btn-outline" style="background: transparent;
                                                                                              color: var(--primary-600);
                                                                                              border: 2px solid var(--primary-500);
                                                                                              border-radius: var(--radius-md);
                                                                                              padding: var(--space-2) var(--space-4);
                                                                                              font-weight: 500;
                                                                                              cursor: pointer;
                                                                                              transition: all var(--transition-base);">Show Info</button>
            <button id="btnqrbarcode" class="btn btn-primary modern-btn" style="background: linear-gradient(135deg, var(--accent-500) 0%, var(--accent-600) 100%);
                                                                              color: white;
                                                                              border: none;
                                                                              border-radius: var(--radius-md);
                                                                              padding: var(--space-2) var(--space-4);
                                                                              font-weight: 500;
                                                                              cursor: pointer;
                                                                              transition: all var(--transition-base);
                                                                              box-shadow: var(--shadow-sm);">QR/Barcode</button>
        </div>

        <div class="menu-right" style="display: flex; gap: var(--space-2); align-items: center; margin-left: var(--space-4); padding-left: var(--space-4); border-left: 2px solid var(--gray-200);">
            <button id="setsamesize" class="btn btn-primary modern-btn" style="background: linear-gradient(135deg, var(--gray-600) 0%, var(--gray-700) 100%);
                                                                              color: white;
                                                                              border: none;
                                                                              border-radius: var(--radius-md);
                                                                              padding: var(--space-2) var(--space-3);
                                                                              font-weight: 500;
                                                                              font-size: 0.875rem;
                                                                              cursor: pointer;
                                                                              transition: all var(--transition-base);
                                                                              box-shadow: var(--shadow-sm);">Set Same Size</button>
            <button id="rightalign" class="btn btn-primary modern-btn-sm" style="background: linear-gradient(135deg, var(--gray-500) 0%, var(--gray-600) 100%);
                                                                              color: white;
                                                                              border: none;
                                                                              border-radius: var(--radius-md);
                                                                              padding: var(--space-2) var(--space-3);
                                                                              font-weight: 500;
                                                                              font-size: 0.875rem;
                                                                              cursor: pointer;
                                                                              transition: all var(--transition-base);
                                                                              box-shadow: var(--shadow-sm);">Right</button>
            <button id="leftalign" class="btn btn-primary modern-btn-sm" style="background: linear-gradient(135deg, var(--gray-500) 0%, var(--gray-600) 100%);
                                                                              color: white;
                                                                              border: none;
                                                                              border-radius: var(--radius-md);
                                                                              padding: var(--space-2) var(--space-3);
                                                                              font-weight: 500;
                                                                              font-size: 0.875rem;
                                                                              cursor: pointer;
                                                                              transition: all var(--transition-base);
                                                                              box-shadow: var(--shadow-sm);">Left</button>
            <button id="topalign" class="btn btn-primary modern-btn-sm" style="background: linear-gradient(135deg, var(--gray-500) 0%, var(--gray-600) 100%);
                                                                              color: white;
                                                                              border: none;
                                                                              border-radius: var(--radius-md);
                                                                              padding: var(--space-2) var(--space-3);
                                                                              font-weight: 500;
                                                                              font-size: 0.875rem;
                                                                              cursor: pointer;
                                                                              transition: all var(--transition-base);
                                                                              box-shadow: var(--shadow-sm);">Top</button>
            <button id="bottomalign" class="btn btn-primary modern-btn-sm" style="background: linear-gradient(135deg, var(--gray-500) 0%, var(--gray-600) 100%);
                                                                              color: white;
                                                                              border: none;
                                                                              border-radius: var(--radius-md);
                                                                              padding: var(--space-2) var(--space-3);
                                                                              font-weight: 500;
                                                                              font-size: 0.875rem;
                                                                              cursor: pointer;
                                                                              transition: all var(--transition-base);
                                                                              box-shadow: var(--shadow-sm);">Bottom</button>
            <div style="border-left: 2px solid var(--gray-200); height: 20px; margin: 0 var(--space-2);"></div>
            <button id="selectAllHeaders" class="btn btn-primary modern-btn-sm" style="background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
                                                                              color: white;
                                                                              border: none;
                                                                              border-radius: var(--radius-md);
                                                                              padding: var(--space-2) var(--space-3);
                                                                              font-weight: 500;
                                                                              font-size: 0.875rem;
                                                                              cursor: pointer;
                                                                              transition: all var(--transition-base);
                                                                              box-shadow: var(--shadow-sm);">Select All Headers</button>
            <button id="selectAllBody" class="btn btn-primary modern-btn-sm" style="background: linear-gradient(135deg, var(--success-500) 0%, var(--success-600) 100%);
                                                                              color: white;
                                                                              border: none;
                                                                              border-radius: var(--radius-md);
                                                                              padding: var(--space-2) var(--space-3);
                                                                              font-weight: 500;
                                                                              font-size: 0.875rem;
                                                                              cursor: pointer;
                                                                              transition: all var(--transition-base);
                                                                              box-shadow: var(--shadow-sm);">Select All Body</button>
            <button id="selectAllFooter" class="btn btn-primary modern-btn-sm" style="background: linear-gradient(135deg, var(--warning-500) 0%, var(--warning-600) 100%);
                                                                              color: white;
                                                                              border: none;
                                                                              border-radius: var(--radius-md);
                                                                              padding: var(--space-2) var(--space-3);
                                                                              font-weight: 500;
                                                                              font-size: 0.875rem;
                                                                              cursor: pointer;
                                                                              transition: all var(--transition-base);
                                                                              box-shadow: var(--shadow-sm);">Select All Footer</button>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-12 col-md-12 col-lg-3">
            <div class="child-tabs">
                <ul class="nav nav-tabs">
                    <li class="active"><a data-toggle="tab" href="#ProfileDetails"><b> Profiles</b></a></li>
                    <li><a data-toggle="tab" href="#FieldsDetails"><b>Fields</b></a></li>
                </ul>

                <div class="tab-content" style="color:black">
                    <div id="ProfileDetails" class="tab-pane fade in active">
                        <div>
                            <div class="section">
                                <div class="radio-group">
                                    <label><input type="radio" id="rdoAddnew" name="permission" checked> Add New</label>
                                    <label><input type="radio" id="rdoModify" name="permission"> Modify</label>
                                </div>
                                <span class="form-label">
                                    <select class="form-control FormclrcmbField" id="cmbTransactionName">
                                    </select>
                                    <label class="labelup"> Transaction Name:</label>
                                </span><br />
                                <div id="dvExistConfig" hidden>
                                    <div class="input-group">
                                        <span class="form-label">
                                            <select class="form-control FormclrcmbField" id="cmbConfigurationName">
                                            </select>
                                            <label class="labelup"> Configuration Name:</label>
                                        </span>
                                        <span id="loadFromDB" style="cursor:pointer" title="Load" class="input-group-addon">Load</span>
                                    </div>
                                </div>
                                <div id="dvNewConfig">
                                    <span class="form-label">
                                        <input class="form-control FormclrField" type="text" id="txtNewConfigName" placeholder=""
                                               onbeforeinput="return AlphaNumericBeforeInput(event, this,'#dvErrorConfigurationName')"
                                               oninput="sanitizeAlphaNumeric(this, '#dvErrorConfigurationName')" />
                                        <label class="labelup"> Configuration Name:</label>
                                    </span>
                                    <div class="clrdiv" id="dvErrorConfigurationName" style="color:red"></div>
                                </div>
                                <div class="button-group">                                    
                                    <button id="btnScript" hidden>Script</button>
                                    <button id="btnDeleteProfile" title="Delete"><span class="glyphicon glyphicon-trash"></span></button>
                                    <button id="btnClear">Clear</button>
                                    <button id="saveAsToDB">Save As</button>
                                    <button id="saveToDB">Save</button>
                                </div>
                            </div>

                            <div class="section">
                                <span class="form-label">
                                    <input class="form-control FormclrField" type="text" id="txtPreviewDocID" placeholder="">
                                    <label class="labelup">Doc ID</label>
                                </span>
                                <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divPreviewDocID" class="clrdivs"></div>
                                <div class="button-group">
                                    @*<button>Delete</button>*@
                                    <button id="btnPCPreview">Preview</button>
                                </div>
                            </div>

                            <div class="section">
                                <span class="form-label">
                                    <input class="form-control FormclrField" type="text" id="txtRename" placeholder=""
                                           onbeforeinput="return AlphaNumericBeforeInput(event, this,'#dvErrorRename')"
                                           oninput="sanitizeAlphaNumeric(this, '#dvErrorRename')" />
                                    <label class="labelup">Rename</label>
                                </span>
                                <div class="clrdiv" id="dvErrorRename" style="color:red"></div>
                                <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divRename" class="clrdivs"></div>
                                <div class="button-group">
                                    <button id="btnRename">Rename</button>
                                </div>
                            </div>

                            <div class="section">
                                <div class="section-title">Colors</div>
                                <div class="colors">
                                    <div class="color-box dvsheaderlabel"></div> <div>Header</div>
                                    <div class="color-box dvsheadervalue"></div> <div>Header Value</div>
                                    <div class="color-box dvsbodylabel"></div> <div>Body</div>
                                    <div class="color-box dvsbodyvalue"></div> <div>Body Value</div>
                                    <div class="color-box dvsfooterlabel"></div> <div>Footer</div>
                                    <div class="color-box dvsfootervalue"></div> <div>Footer Value</div>

                                    <div class="color-box dvsheaderformula"></div> <div>Formula Header</div>
                                    <div class="color-box dvsbodyformula"></div> <div>Formula Body</div>
                                    <div class="color-box dvsfooterformula"></div> <div>Formula Footer</div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <div id="FieldsDetails" class="tab-pane fade" style="color:black;padding-top:15px;">
                        <div class="section">
                            <div class="radio-group">
                                <label><input type="radio" id="rdoheader" name="section" checked> Header</label>
                                <label><input type="radio" id="rdobody" name="section"> Body</label>
                                <label><input type="radio" id="rdofooter" name="section"> Footer</label>
                            </div>
                        </div>
                        <div class="tab-content">
                            <ul class="nav nav-tabs">
                                <li id="tbHeader" class="active dvsheadervalue"><a data-toggle="tab" href="#HeaderDetails"><b> Header</b></a></li>
                                <li id="tbBody" class="dvsbodyvalue"><a data-toggle="tab" href="#BodyDetails"><b>Body</b></a></li>
                                <li id="tbFooter" class="dvsfootervalue"><a data-toggle="tab" href="#FooterDetails"><b>Footer</b></a></li>
                                <li>&ensp; <button class="btn btn-success" id="btnFormula">Formula</button></li>
                            </ul>

                            <div id="HeaderDetails" class="tab-pane fade in active">
                                <div class="Headersection">
                                    <table class="table table-bordered table-striped" id="tblHeaderControls" style="width: 100%;cursor:pointer; color: black !important">
                                    </table>
                                </div>

                            </div>
                            <div id="BodyDetails" class="tab-pane fade">
                                <div class="Bodysection">
                                    <table class="table table-bordered table-striped" id="tblBodyControls" style="width: 100%; cursor: pointer; color: black !important">
                                    </table>
                                </div>
                            </div>
                            <div id="FooterDetails" class="tab-pane fade">
                                <div class="Footersection">
                                    <table class="table table-bordered table-striped" id="tblFooterControls" style="width: 100%; cursor: pointer; color: black !important">
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <div>
            <div id="paper"></div>
            <div id="contextMenu" class="context-menu"></div>
        </div>

    </div>

    <div class="modalQRBarcode" id="mymodalQRBarcode">
        <div class="modal-dialog" style="width:auto;">
            <div class="modalQRBarcode-content">
                <!-- Modal Header -->
                <div class="modal-header">
                    <button type="button" class="closemodalQRBarcode">&times;</button>
                    <h5 class="modal-title" style="color:black" id="hdQRSaveas"><b>QR/Barcode</b></h5>
                </div>
                <div class="modal-body">
                    <div id="dvQRBarcode" style="width:100%;padding-bottom:7px">
                        <table class="table table-borderless" style="width:100%" align="center">
                            <tr>
                                <td style="padding-left:30px;border:none">
                                    <input id="rdoQRCode" type="radio" name="QRBar" checked /> &ensp;<label for="rdoQRCode" style="font-size:14px;font-weight:600"> QR Code</label>&emsp;
                                    <input id="rdoBarCode" type="radio" name="QRBar" /> &ensp;<label for="rdoBarCode" style="font-size:14px;font-weight:600"> Bar Code</label>
                                </td>
                            </tr>
                            <tr>
                                <td style="padding-left:30px;border:none">
                                    <span class="form-label">
                                        <select class="form-control FormclrcmbField" id="cmbQRBarcodeTypes">
                                            <option value="1">Document ID</option>
                                            <option value="2">Text</option>
                                            <option value="3">E-Invoice</option>
                                            <option value="4">QR With Value</option>
                                            <option value="5">QR Without Value</option>
                                        </select>
                                        <label class="labelup"> Select Type</label>
                                    </span>
                                    <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrQRBarcodeTypes" class="clrdiv"></div>
                                </td>
                            </tr>
                            <tr id="trQRText" hidden>
                                <td style="padding-left:30px;border:none">
                                    <span class="form-label">
                                        <input class="form-control FormclrField" type="text" id="txtQRTextValue" placeholder="">
                                        <label class="labelup">Text Value</label>
                                    </span>
                                    <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrQRTextValue" class="clrdivs"></div>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <div id="dvSaveTranDetails">
                        <span class="form-label">
                            <select class="form-control FormclrcmbField" id="cmbSaveasTransactionName">
                            </select>
                            <label class="labelup"> Transaction Name:</label>
                        </span><br />
                        <span class="form-label">
                            <input class="form-control FormclrField" type="text" id="txtSaveasProfileName" placeholder="">
                            <label class="labelup">Profile Name</label>
                        </span>
                        <div style="color: red; padding-top: 5px; padding-left: 5px;" id="divErrSaveasProfileName" class="clrdivs"></div>
                    </div>
                </div>
                <!-- Modal footer -->
                <div class="modal-footer" style="background-color:skyblue">
                    <div style="padding-top:0px" align="right">
                        @*<button tabindex="4" type="button" class="btn btn-danger" id="btnPinfoClear"><span class="glyphicon glyphicon-refresh"> Clear</span></button>*@
                        <button type="button" class="btn btn-success" id="btnaddQRBarcode"><span class="glyphicon glyphicon-floppy-disk"> Accept</span></button>
                        <button type="button" class="btn btn-warning" id="btnClosemodalQRBarcode"><span class="glyphicon glyphicon-remove"> Close</span></button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modalFormula" id="mymodalFormula">
        <div class="modal-dialog" style="width:auto;">
            <div class="modalFormula-content">
                <!-- Modal Header -->
                <div class="modal-header">
                    <button type="button" class="closemodalFormula">&times;</button>
                    <h5 class="modal-title" style="color:black"><b>Formula</b></h5>
                </div>
                <div class="modal-body">                    
                    <div id="dvFormulaData">
                        <textarea class="formc" id="txtFormulaData" rows="5" style="width:100%"></textarea>
                    </div>
                </div>
                <!-- Modal footer -->
                <div class="modal-footer" style="background-color:skyblue">
                    <div style="padding-top:0px" align="right">
                        @*<button tabindex="4" type="button" class="btn btn-danger" id="btnPinfoClear"><span class="glyphicon glyphicon-refresh"> Clear</span></button>*@
                        <button type="button" class="btn btn-success" id="btnaddFormula"><span class="glyphicon glyphicon-floppy-disk"> Accept</span></button>
                        <button type="button" class="btn btn-warning" id="btnClosemodalFormula"><span class="glyphicon glyphicon-remove"> Close</span></button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    var Aurl = '@Session["APIurl"]';
    var UID = '@Session["LoginUserID"]';
    var tableHeaderControls = $('#tblHeaderControls').DataTable({
        paging: false,
        searching: true,
        info: false,
        ordering: false,
        scrollY: "350px",
        scrollX: true,
        scrollCollapse: true,
    });
    var tableBodyControls = $('#tblBodyControls').DataTable({
        paging: false,
        searching: true,
        info: false,
        ordering: false,
        scrollY: "350px",
        scrollX: true,
        scrollCollapse: true,
    });
    var tableFooterControls = $('#tblFooterControls').DataTable({
        paging: false,
        searching: true,
        info: false,
        ordering: false,
        scrollY: "350px",
        scrollX: true,
        scrollCollapse: true,
    });
    const editBtn = document.getElementById('editBtn');
    const editcontextMenu = document.getElementById('editcontextMenu');

    editBtn.addEventListener('mouseenter', (e) => {
        const rect = editBtn.getBoundingClientRect();
        editcontextMenu.style.top = `${rect.bottom + window.scrollY}px`;
        editcontextMenu.style.left = `${rect.left + window.scrollX}px`;
        editcontextMenu.style.display = editcontextMenu.style.display === 'flex' ? 'none' : 'flex';
    });
    $('#btnScript').hide();
    if (UID == 1) {
        $('#btnScript').show();
    }
    // Hide context menu on outside click
    editcontextMenu.addEventListener('mouseleave', (e) => {
        editcontextMenu.style.display = 'none';
    });
    $("#addValue,#showInfo").hide();
    var modalQRBarcode = document.getElementById("mymodalQRBarcode");
    var spanQRBarcodeClose = document.getElementsByClassName("closemodalQRBarcode")[0];
    spanQRBarcodeClose.onclick = function () {
        modalQRBarcode.style.display = "none";
    }
    $('#btnClosemodalQRBarcode').click(function (e) {
        modalQRBarcode.style.display = "none";
    });
    var QRSaveasPopup = 1;//1 - QR Popup, 2 - Saveas Popup
    $('#btnqrbarcode').click(function (e) {
        modalQRBarcode.style.display = "block";
        QRSaveasPopup = 1;
        $("#hdQRSaveas").text("QR/Barcode");
        $("#dvSaveTranDetails").hide();
        $("#dvQRBarcode").show();        
        //dvQRBarcoe,dvSaveTranDetails
    });
    $('#saveAsToDB').click(function (e) {
        modalQRBarcode.style.display = "block";
        QRSaveasPopup = 2;
        $("#hdQRSaveas").text("Save As");
        $("#dvSaveTranDetails").show();
        $("#dvQRBarcode").hide();
    });
    
    var modalFormula = document.getElementById("mymodalFormula");
    var spanFormulaClose = document.getElementsByClassName("closemodalFormula")[0];
    spanFormulaClose.onclick = function () {
        modalFormula.style.display = "none";
    }
    $('#btnClosemodalFormula').click(function (e) {
        modalFormula.style.display = "none";
        formulaselected = false;
        IsFormaulaEdit = false;
    });
    var formulaselected = false, IsFormaulaEdit = false;;
    $('#btnFormula').click(function (e) {
        formulaselected = true;
        modalFormula.style.display = "block";
    });
    var QRCodeItems = [{
        ID: 1,
        Value: 'Document ID'
    },
    {
        ID: 2,
        Value: 'Text'
    },
    {
        ID: 3,
        Value: 'E-Invoice'
    },
    {
        ID: 4,
        Value: 'UPI With Amount'
    },
    {
        ID: 5,
        Value: 'UPI Without Amount'
    }
    ];
    var BarCodeItems = [{
        ID: 1,
        Value: 'Document ID'
    },
    {
        ID: 2,
        Value: 'Acknowledge No'
    },
    {
        ID: 3,
        Value: 'E-way No'
    }
    ];
    LoadQRBarcodeitems();
    function LoadQRBarcodeitems() {
        var qrCheck = $("#rdoQRCode").is(":checked");
        $('#cmbQRBarcodeTypes').find("option").remove();
        $("#txtQRTextValue").val("");
        $("#trQRText").hide();
        if (qrCheck) {
            $.each(QRCodeItems, function (i, items) {
                $('#cmbQRBarcodeTypes').append($('<option/>', {
                    value: items.ID,
                    text: items.Value,
                }));
            });
        }
        else {
            $.each(BarCodeItems, function (i, items) {
                $('#cmbQRBarcodeTypes').append($('<option/>', {
                    value: items.ID,
                    text: items.Value,
                }));
            });
        }
    }
    $('#cmbQRBarcodeTypes').change(function (e) {
        var qrCheck = $("#rdoQRCode").is(":checked");
        var SelID = e.target.value;
        if (qrCheck) {
            if (SelID == 2) {
                $("#txtQRTextValue").val("");
                $("#trQRText").show();
            } else {
                $("#txtQRTextValue").val("");
                $("#trQRText").hide();
            }
        }
    });
    $('#rdoQRCode,#rdoBarCode').click(function (e) {
        LoadQRBarcodeitems();
    });
    
    var arrPaperTypes = [], arrFontNames = [], arrTransactions = [], arrProfileNames = [];
    var strSaveType = "Save";
    InitialDatas();
    
    const paper = document.getElementById('paper');
const paperType = document.getElementById('paperType');
    const customWidth = document.getElementById('customWidth');
    const customHeight = document.getElementById('customHeight');
    const contextMenu = document.getElementById('contextMenu');
    const imageUpload = document.getElementById('imageUpload');
    let selectedControl = null;
    
    customWidth.style.display = 'none';
    customHeight.style.display = 'none';
    
    // ============================================
    // DRAG-TO-SELECT FUNCTIONALITY
    // ============================================
    let selectionBox = null;
    let isSelecting = false;
    let startX = 0, startY = 0;
    let selectedElements = new Set();
    
    // Create selection box element
    function createSelectionBox() {
        if (!selectionBox) {
            selectionBox = document.createElement('div');
            selectionBox.className = 'selection-box';
            selectionBox.style.display = 'none';
            paper.appendChild(selectionBox);
        }
    }
    
    createSelectionBox();
    
    // Check if two rectangles intersect
    function rectsIntersect(rect1, rect2) {
        return !(
            rect1.right < rect2.left ||
            rect1.left > rect2.right ||
            rect1.bottom < rect2.top ||
            rect1.top > rect2.bottom
        );
    }
    
    // Clear all selections
    function clearAllSelections() {
        selectedElements.forEach(control => {
            control.classList.remove('selected');
        });
        selectedElements.clear();
    }
    
    // Start drag selection
    paper.addEventListener('mousedown', function(e) {
        // Allow selection if clicking on paper background OR holding Ctrl/Cmd key (for group selection from anywhere)
        if (e.target === paper || e.ctrlKey || e.metaKey) {
            isSelecting = true;
            const rect = paper.getBoundingClientRect();
            startX = e.clientX - rect.left;
            startY = e.clientY - rect.top;
            
            // Note: Keep existing selections when Ctrl is held (handled in mousemove)
            // Clear previous selections only if not holding Ctrl/Cmd
            if (!e.ctrlKey && !e.metaKey) {
                clearAllSelections();
            }
            
            selectionBox.style.left = startX + 'px';
            selectionBox.style.top = startY + 'px';
            selectionBox.style.width = '0px';
            selectionBox.style.height = '0px';
            selectionBox.style.display = 'block';
            
            e.preventDefault();
            e.stopPropagation(); // Prevent control dragging when using group selection
        }
    });
    
    // Update selection box during drag
    paper.addEventListener('mousemove', function(e) {
        if (!isSelecting) return;
        
        const rect = paper.getBoundingClientRect();
        const currentX = e.clientX - rect.left;
        const currentY = e.clientY -  rect.top;
        
        const width = Math.abs(currentX - startX);
        const height = Math.abs(currentY - startY);
        const left = Math.min(currentX, startX);
        const top = Math.min(currentY, startY);
        
        selectionBox.style.left = left + 'px';
        selectionBox.style.top = top + 'px';
        selectionBox.style.width = width + 'px';
        selectionBox.style.height = height + 'px';
        
        // Highlight controls within selection box
        const selectionRect = selectionBox.getBoundingClientRect();
        const controls = paper.querySelectorAll('.label, .value, .line,.headerhline,.bodyhline,.footerhline,.headervline,.bodyvline,.footervline, .box, .image, .headerlabel, .bodylabel, .footerlabel, .headervalue, .bodyvalue, .footervalue, .headerbox, .bodybox, .footerbox, .imageheader, .imagefooter, .barcodeheader, .qrcodeheader, .qrcodefooter, .barcodefooter, .headerformula, .bodyformula, .footerformula');
        console.log("Mouse Moving");
        controls.forEach(control => {
            const controlRect = control.getBoundingClientRect();
            
            if (rectsIntersect(selectionRect, controlRect)) {
                if (!selectedElements.has(control)) {
                    control.classList.add('selected');
                    selectedElements.add(control);
                }
            } else if (!e.ctrlKey && !e.metaKey) {
                // Remove selection if not holding Ctrl/Cmd
                if (selectedElements.has(control)) {
                    control.classList.remove('selected');
                    selectedElements.delete(control);
                }
            }
            else {
                console.log("no control select");
            }
        });
    });
    
    // End drag selection
    document.addEventListener('mouseup', function(e) {
        if (isSelecting) {
            isSelecting = false;
            selectionBox.style.display = 'none';
            
            console.log(`Selected ${selectedElements.size} control(s)`);
        }
    });
    
    // Handle Ctrl+A to select all
    document.addEventListener('keydown', function(e) {
        if ((e.ctrlKey || e.metaKey) && e.key === 'a' && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA') {
            e.preventDefault();
            
            clearAllSelections();
            const controls = paper.querySelectorAll('.label, .value, .line,.headerhline,.bodyhline,.footerhline,.headervline,.bodyvline,.footervline, .box, .image, .headerlabel, .bodylabel, .footerlabel, .headervalue, .bodyvalue, .footervalue, .headerbox, .bodybox, .footerbox, .imageheader, .imagefooter, .barcodeheader, .qrcodeheader, .qrcodefooter, .barcodefooter, .headerformula, .bodyformula, .footerformula');
            
            controls.forEach(control => {
                control.classList.add('selected');
                selectedElements.add(control);
            });
            
            console.log(`Selected all ${selectedElements.size} control(s)`);
        }
        
        // Resize selected controls with Ctrl + Arrow keys
        if ((e.ctrlKey || e.metaKey) && selectedElements.size > 0 && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA') {
            const resizeStep = 1; // pixels to resize per keypress
            
            if (e.key === 'ArrowUp') {
                e.preventDefault();
                // Decrease height
                selectedElements.forEach(control => {
                    // Get current position - use offsetTop/Left if style values aren't set
                    const currentTop = parseInt(control.style.top) || control.offsetTop;
                    const currentLeft = parseInt(control.style.left) || control.offsetLeft;
                    const currentHeight = parseInt(control.style.height) || control.offsetHeight;
                    const newHeight = Math.max(15, currentHeight - resizeStep);
                    
                    // Set position explicitly first
                    control.style.position = 'absolute';
                    control.style.top = currentTop + 'px';
                    control.style.left = currentLeft + 'px';
                    control.style.height = newHeight + 'px';
                });
                console.log(`Resized ${selectedElements.size} control(s): height decreased`);
            }
            else if (e.key === 'ArrowDown') {
                e.preventDefault();
                // Increase height
                selectedElements.forEach(control => {
                    const currentTop = parseInt(control.style.top) || control.offsetTop;
                    const currentLeft = parseInt(control.style.left) || control.offsetLeft;
                    const currentHeight = parseInt(control.style.height) || control.offsetHeight;
                    const newHeight = currentHeight + resizeStep;
                    
                    control.style.position = 'absolute';
                    control.style.top = currentTop + 'px';
                    control.style.left = currentLeft + 'px';
                    control.style.height = newHeight + 'px';
                });
                console.log(`Resized ${selectedElements.size} control(s): height increased`);
            }
            else if (e.key === 'ArrowLeft') {
                e.preventDefault();
                // Decrease width
                selectedElements.forEach(control => {
                    const currentTop = parseInt(control.style.top) || control.offsetTop;
                    const currentLeft = parseInt(control.style.left) || control.offsetLeft;
                    const currentWidth = parseInt(control.style.width) || control.offsetWidth;
                    const newWidth = Math.max(15, currentWidth - resizeStep);
                    //console.log("newWidth ", newWidth);
                    control.style.position = 'absolute';
                    control.style.top = currentTop + 'px';
                    control.style.left = currentLeft + 'px';
                    control.style.width = newWidth + 'px';
                });
                console.log(`Resized ${selectedElements.size} control(s): width decreased`);
            }
            else if (e.key === 'ArrowRight') {
                e.preventDefault();
                // Increase width
                selectedElements.forEach(control => {
                    const currentTop = parseInt(control.style.top) || control.offsetTop;
                    const currentLeft = parseInt(control.style.left) || control.offsetLeft;
                    const currentWidth = parseInt(control.style.width) || control.offsetWidth;
                    const newWidth = currentWidth + resizeStep;
                    
                    control.style.position = 'absolute';
                    control.style.top = currentTop + 'px';
                    control.style.left = currentLeft + 'px';
                    control.style.width = newWidth + 'px';
                });
                console.log(`Resized ${selectedElements.size} control(s): width increased`);
            }
        }
        
        // Delete selected controls with Delete or Backspace key
        if ((e.key === 'Delete' || e.key === 'Backspace') && selectedElements.size > 0 && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA') {
            e.preventDefault();
            
            const confirmDelete = confirm(`Delete ${selectedElements.size} selected control(s)?`);
            if (confirmDelete) {
                selectedElements.forEach(control => {
                    control.remove();
                });
                selectedElements.clear();
            }
        }
    });
    // ============================================
    // END DRAG-TO-SELECT FUNCTIONALITY
    // ============================================
    
    //let selectedElements = new Set();   // 🆕 track multiple selected
    let lastClicked = null;

    function mmToPx(mm) { return mm * 3.78; }

    function setPaperType() {
        let w, h;
        const s = paperType.value;
        //showSuccessSnackbar("Papper ID : " + s);
        //if (s === 'A4') { w = 210; h = 297; }
        //else if (s === 'A5') { w = 148; h = 210; }
        //else { w = parseInt(customWidth.value) || 100; h = parseInt(customHeight.value) || 100; }
        var papperinfo = arrPaperTypes.filter(c => c.ID == s);
        if (papperinfo.length) {
            w = parseInt(papperinfo[0].Width);
            h = parseInt(papperinfo[0].Height);
        } else {
            w = 100; h = 100;
        }
        console.log("papperinfo", papperinfo);
        $("#customWidth").val(w);
        $("#customHeight").val(h);
        //customWidth.oninput = w;
        //customHeight.oninput = h;
        paper.style.width = mmToPx(w) + 'px';
        paper.style.height = mmToPx(h) + 'px';
    }
    paperType.onchange = () => {
        const isCustom = paperType.value == '13';
        customWidth.style.display = customHeight.style.display = isCustom ? 'inline-block' : 'none';
        setPaperType();
    };
    customWidth.oninput = setPaperType;
    customHeight.oninput = setPaperType;
    setPaperType();

    //------------------------------------------//
    // ELEMENT CREATION
    //------------------------------------------//
//    <button id="setsamesize" class="btn btn-primary">Set Same Size</button>
//<button id="rightalign" class="btn btn-primary">Right</button>
//<button id="leftalign" class="btn btn-primary">Left</button>
//<button id="Topalign" class="btn btn-primary">Top</button>
//<button id="bottomalign" class="btn btn-primary">Bottom</button>
    document.getElementById('addLabel').onclick = () => addElement('label');
    document.getElementById('addValue').onclick = () => addElement('value');

    document.getElementById('addHLine').onclick = () => addElement('hline');
    document.getElementById('addVLine').onclick = () => addElement('vline');
    document.getElementById('addBox').onclick = () => addElement('box');

    // Select All Section Handlers
    document.getElementById('selectAllHeaders').onclick = () => {
        deselectAll();
        // Select all header controls: labels, values, lines, boxes, images, barcodes, etc.
        paper.querySelectorAll('.headerlabel, .headervalue, .headerhline, .headervline, .headerbox, .imageheader, .barcodeheader, .qrcodeheader, .headerformula').forEach(el => {
            selectedElements.add(el); 
            el.classList.add('selected');
        });
    };

    document.getElementById('selectAllBody').onclick = () => {
        deselectAll();
        // Select all body controls
        paper.querySelectorAll('.bodylabel, .bodyvalue, .bodyhline, .bodyvline, .bodybox, .bodyformula').forEach(el => {
            selectedElements.add(el); 
            el.classList.add('selected');
        });
    };

    document.getElementById('selectAllFooter').onclick = () => {
        deselectAll();
        // Select all footer controls
        paper.querySelectorAll('.footerlabel, .footervalue, .footerhline, .footervline, .footerbox, .imagefooter, .barcodefooter, .qrcodefooter, .footerformula').forEach(el => {
            selectedElements.add(el); 
            el.classList.add('selected');
        });
    };

    document.getElementById('setsamesize').onclick = () => setSizeAlignElement('setsamesize');
    document.getElementById('rightalign').onclick = () => setSizeAlignElement('rightalign');
    document.getElementById('leftalign').onclick = () => setSizeAlignElement('leftalign');
    document.getElementById('topalign').onclick = () => setSizeAlignElement('topalign');
    document.getElementById('bottomalign').onclick = () => setSizeAlignElement('bottomalign');

    document.getElementById('addImage').onclick = () => imageUpload.click();
    document.getElementById('btnaddQRBarcode').onclick = () => {
        if (QRSaveasPopup == 1) {//QR
            var qrCheck = $("#rdoQRCode").is(":checked");
            var selval = $('#cmbQRBarcodeTypes').val();
            if (qrCheck && selval == 2) {
                if ($("#txtQRTextValue").val() != "") {
                    addElement('qrbarcode');
                }
                else {
                    showErrorSnackbar("Text value should not be empty");
                }
            } else {
                addElement('qrbarcode');
            }
        }
        else {//Save As
            if ($("#txtSaveasProfileName").val() != "") {
                strSaveType = "saveas";
                if (SaveValidation()) {
                    if (cfFocus != 3) {
                        ConfirmDialogMsg("Do you want to save data?");
                    } else {
                        SaveData();
                    }
                }
            }
            else {
                showErrorSnackbar("Profile Name should not be empty");
            }
        }
    };

    imageUpload.addEventListener('change', e => {
        nPlaceType = $("#rdoheader").is(':checked') ? 1 : $("#rdobody").is(':checked') ? 2 : 3;
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = ev => {
            const el = document.createElement('div');
            //el.className = 'image';imageheader
            el.className = nPlaceType == 1 ? 'imageheader' : nPlaceType == 3 ? 'imagefooter' : 'image';
            el.style.width = '150px'; el.style.height = '100px';
            el.style.left = '40px'; el.style.top = '40px';
            el.dataset.PlaceType = nPlaceType == 1 ? 'Header' : nPlaceType == 2 ? 'Body' : nPlaceType == 3 ? 'Footer' : "Header";
            var isFooteronEP = $("#chkFooteronEveryPage").is(':checked') ? 1 : 0
            el.dataset.FooterOnEPControl = nPlaceType == 3 ? isFooteronEP : 0; el.dataset.IsFooterContol = nPlaceType == 3 ? 1 : 0;
            const img = document.createElement('img');
            img.src = ev.target.result;
            el.appendChild(img);
            makeInteractive(el);
            paper.appendChild(el);
        };
        reader.readAsDataURL(file);
        e.target.value = '';
    });
    var nPlaceType = 1;//Header
    function addElement(type, ValueText = "") {
        let el;
        nPlaceType = $("#rdoheader").is(':checked') ? 1 : $("#rdobody").is(':checked') ? 2 : 3;
        var isFooteronEP = $("#chkFooteronEveryPage").is(':checked') ? 1 : 0
        var strFontName = $("#cmbFontNames option:selected").text();
        var nFontSize = $("#txtFontsize").val();        
        if (type === 'label') {
            el = document.createElement('div');
            el.className = nPlaceType == 1 ? 'headerlabel' : nPlaceType == 2 ? 'bodylabel' : nPlaceType == 3 ? 'footerlabel' : 'label';
            el.textContent = 'Label'; el.dataset.boldtext = "0"; el.dataset.italictext = "0";
            el.dataset.wraptext = "0";
        } else if (type === 'value') {
            el = document.createElement('div');
            el.className = nPlaceType == 1 ? 'headervalue' : nPlaceType == 2 ? 'bodyvalue' : nPlaceType == 3 ? 'footervalue' : 'value';
            el.textContent = ValueText; el.dataset.boldtext = "0"; el.dataset.italictext = "0";
            el.dataset.wraptext = "0";
        } else if (type === 'hline') {
            el = document.createElement('div');
            //el.className = 'line';
            el.className = nPlaceType == 1 ? 'headerhline' : nPlaceType == 2 ? 'bodyhline' : nPlaceType == 3 ? 'footerhline' : 'hline';
            el.dataset.type = 'hline';
            el.style.height = '2px'; el.style.width = '120px';
        } else if (type === 'vline') {
            el = document.createElement('div');
            //el.className = 'line';
            el.className = nPlaceType == 1 ? 'headervline' : nPlaceType == 2 ? 'bodyvline' : nPlaceType == 3 ? 'footervline' : 'vline';
            el.dataset.type = 'vline';
            el.style.width = '2px'; el.style.height = '120px';
        } else if (type === 'box') {
            el = document.createElement('div');
            //el.className = 'box';
            el.className = nPlaceType == 1 ? 'headerbox' : nPlaceType == 2 ? 'bodybox' : nPlaceType == 3 ? 'footerbox' : 'box';
            el.style.width = '120px'; el.style.height = '80px';
        }
        else if (type === 'qrbarcode') {
            el = document.createElement('div');
            var qrCheck = $("#rdoQRCode").is(":checked");
            var SelValue = $('#cmbQRBarcodeTypes').val();
            var SelText = $('#cmbQRBarcodeTypes option:selected').text();
            //QR Code : NQR1 - Doc ID,NQR2 - Text,SQR3 - Signed QR,UWA4 - UPI With Amt,UWO5 - UPI With Amt
            //Bar Code : BRE3 - Eway No,BRA2 - Ack No,BRC1 - Doc ID

            if (nPlaceType == 1) {//Header check
                if (qrCheck) {
                    el.className = "qrcodeheader";
                    el.style.width = '100px'; el.style.height = '100px';
                    el.dataset.qrbarid = SelValue == 1 || SelValue == 2 ? 'NQR12' : SelValue == 3 ? 'SQR3' : SelValue == 4 ? 'UWA4' :
                        SelValue == 5 ? 'UWO5' : 'NQR12';
                }
                else {
                    el.className = "barcodeheader";
                    el.style.width = '100px'; el.style.height = '50px';
                    el.dataset.qrbarid = SelValue == 1 ? 'BRC1' : SelValue == 2 ? 'BRA2' : SelValue == 3 ? 'BRE3' : 'BRC1';
                }
                if (qrCheck && SelValue == 2) {
                    el.dataset.qrcodetext = $("#txtQRTextValue").val();
                } else {
                    el.dataset.qrcodetext = "";
                }
            }
            else if (nPlaceType == 3) {
                if (qrCheck) {
                    el.className = "qrcodefooter";
                    el.style.width = '100px'; el.style.height = '100px';
                    el.dataset.qrbarid = SelValue == 1 || SelValue == 2 ? 'NQR12' : SelValue == 3 ? 'SQR3' : SelValue == 4 ? 'UWA4' :
                        SelValue == 5 ? 'UWO5' : 'NQR12';
                }
                else {
                    el.className = "barcodefooter";
                    el.style.width = '100px'; el.style.height = '50px';
                    el.dataset.qrbarid = SelValue == 1 ? 'BRC1' : SelValue == 2 ? 'BRA2' : SelValue == 3 ? 'BRE3' : 'BRC1';
                }
                if (qrCheck && SelValue == 2) {
                    el.dataset.qrcodetext = $("#txtQRTextValue").val();
                } else {
                    el.dataset.qrcodetext = "";
                }
            }
            //
            el.title = SelText;
            modalQRBarcode.style.display = "none";
            const img = document.createElement('img');
            el.appendChild(img);
            //el.className = nPlaceType == 1 ? 'headerbox' : nPlaceType == 2 ? 'bodybox' : nPlaceType == 3 ? 'footerbox' : 'box';
        }

        else if (type === 'formula') {
            el = document.createElement('div');
            el.className = nPlaceType == 1 ? 'headerformula' : nPlaceType == 2 ? 'bodyformula' : nPlaceType == 3 ? 'footerformula' : 'value';
            el.textContent = ValueText; el.dataset.boldtext = "0"; el.dataset.italictext = "0";
            el.dataset.wraptext = "0";
        }
        el.dataset.FooterOnEPControl = nPlaceType == 3 ? isFooteronEP : 0; el.dataset.IsFooterContol = nPlaceType == 3 ? 1 : 0;
        el.dataset.PlaceType = nPlaceType == 1 ? 'Header' : nPlaceType == 2 ? 'Body' : nPlaceType == 3 ? 'Footer' : "Header";
       
        el.style.left = '40px'; el.style.top = '40px';
        el.style.fontFamily = strFontName; el.style.fontSize = nFontSize + "px";
        el.style.color = $("#txtColors").val()
        makeInteractive(el);
        paper.appendChild(el);
    }
    $("#cmbFontNames").change(function () {
        var strFontName = $("#cmbFontNames option:selected").text();
        for (const el of selectedElements) {
            el.style.fontFamily = strFontName;
        }
    });
    $("#txtFontsize").change(function () {
        var nFontSize = $("#txtFontsize").val();     
        for (const el of selectedElements) {
            el.style.fontSize = nFontSize + "px";
        }
    });
    $("#txtColors").change(function () {
        var textcolor = $("#txtColors").val();
        for (const el of selectedElements) {
            el.style.color = textcolor;
        }
    });
    function setSizeAlignElement(btnname) {
        if (selectedElements.size > 1) {
            var FirstElement; var i = 1, firstTop = 0, firstLeft = 0, firstRight = 0, firstBottom = 0,
                firstWidth = 0, firstHeight = 0, parentWidth = 0, parentHeight=0;
            for (const el of selectedElements) {
                if (i == 1) {                   
                    FirstElement = window.getComputedStyle(el);                   
                    firstTop = parseFloat(FirstElement.top);
                    firstLeft = parseFloat(FirstElement.left);
                    firstRight = parseFloat(FirstElement.right);
                    firstBottom = parseFloat(FirstElement.bottom);
                    firstWidth = parseFloat(FirstElement.width);
                    firstHeight = parseFloat(FirstElement.height);
                    parentWidth = parseFloat(el.parentElement.offsetWidth);
                    parentHeight = parseFloat(el.parentElement.offsetHeight);
                    //console.log("firstTop", firstTop);
                    //console.log("firstLeft", firstLeft);
                    //console.log("firstRight", firstRight);
                    //console.log("firstBottom", firstBottom);
                }
                if (i != 1) {

                    el.style.position = 'absolute';
                    if (btnname == "setsamesize") {
                        el.style.width = firstWidth + 'px';
                        el.style.height = firstHeight + 'px';
                    }
                    else if (btnname === "topalign") {
                        el.style.top = firstTop + 'px';
                    }
                    else if (btnname === "rightalign") {
                        const elWidth = parseFloat(window.getComputedStyle(el).width);
                        el.style.left = firstLeft + (firstWidth - elWidth) + 'px';//(parentWidth - firstWidth - rightOffset)
                    }
                    else if (btnname === "leftalign") {
                        el.style.left = firstLeft + 'px';
                    }
                    else if (btnname === "bottomalign") {
                        const parent = el.parentElement;
                        const parentHeight = parent.offsetHeight;
                        const elHeight = parseFloat(window.getComputedStyle(el).height);
                        const bottomOffset = parentHeight - (firstTop + firstHeight);
                        el.style.top = (parentHeight - elHeight - bottomOffset) + 'px';
                    }
                }
                i++;
            }
                
        } else {
            showErrorSnackbar("Select atleast 2 controls");
        }
        //contextMenu.style.display = 'none';
    }

    //------------------------------------------//
    // DRAGGING, SELECTION & CONTEXT MENU
    //------------------------------------------//
    function makeInteractive(el) {
        el.dataset.rotation = 0;

        el.addEventListener('mousedown', e => {
            //console.log('mousedown', e);
            // Skip normal dragging if Ctrl/Cmd is held (for group selection box)
            if (e.ctrlKey || e.metaKey) {
                return; // Let the paper's mousedown handler take over for selection box
            }
            
            if (e.target.classList.contains('resize-handle') || e.target.classList.contains('rotate-handle') || e.button === 2) return;
            handleSelection(el, e);
            if (selectedElements.size === 1) {  // only drag single
                const startX = e.clientX, startY = e.clientY;
                const rect = el.getBoundingClientRect(), paperRect = paper.getBoundingClientRect();
                const offsetX = startX - rect.left, offsetY = startY - rect.top;
                function onMove(ev) {
                    let x = ev.clientX - paperRect.left - offsetX;
                    let y = ev.clientY - paperRect.top - offsetY;
                    x = Math.max(0, Math.min(x, paper.clientWidth - el.offsetWidth));
                    y = Math.max(0, Math.min(y, paper.clientHeight - el.offsetHeight));
                    el.style.left = x + 'px'; el.style.top = y + 'px';
                }
                document.addEventListener('mousemove', onMove);
                document.addEventListener('mouseup', () => document.removeEventListener('mousemove', onMove), { once: true });
            }
        });

        el.addEventListener('dblclick', () => {
            if (el.matches('.label, .value, .headerlabel, .bodylabel, .footerlabel')) {// el.classList.contains('label')
                el.contentEditable = true; el.focus();
            }
            if (el.matches('.headerformula, .bodyformula, .footerformula')) {// el.classList.contains('label')
                el.focus();
                //alert("Formula : " + el.textContent);
                //console.log("Select item", selectedElements);
                modalFormula.style.display = "block";
                formulaselected = true;
                IsFormaulaEdit = true;
                $('#txtFormulaData').val(el.textContent);
            }
        });        
        el.setAttribute('tabindex', '0'); // make it focusable
        el.addEventListener('keydown', (e) => {
            if (e.key === 'F2') {
                e.preventDefault();
                //const el = document.activeElement; // or your own selected element
                if (!el) return;

                if (el.matches('.label, .value, .headerlabel, .bodylabel, .footerlabel')) {
                    el.contentEditable = true;
                    el.focus();
                }

                if (el.matches('.headerformula, .bodyformula, .footerformula')) {
                    el.focus();
                    modalFormula.style.display = "block";
                    formulaselected = true;
                    IsFormaulaEdit = true;
                    $('#txtFormulaData').val(el.textContent);
                }
            }
        });

        el.addEventListener('blur', () => el.contentEditable = false);

        el.addEventListener('contextmenu', e => {
            e.preventDefault();
            handleSelection(el, e);
            showContextMenu(e.pageX, e.pageY);
        });

        //createResizeHandles(el);
        //createRotateHandle(el);
    }
    function handleSelection(el, e) {
        if (e.altKey) { // multi-select toggle
            if (selectedElements.has(el)) {
                selectedElements.delete(el); el.classList.remove('selected');
            }//el.style.display = "none";
            else {
                selectedElements.add(el); el.classList.add('selected');
                createResizeHandles(el);
            }//el.style.display = "inline-block";
        } else {
            //console.log("handleSelection", e);
            document.querySelectorAll('.resize-handle').forEach(handle => {
                handle.classList.remove('resize-handle');
            });
            if(e.type != "contextmenu"){
                deselectAll();
            }
            selectedElements.add(el);
            el.classList.add('selected');
            createResizeHandles(el);
            //el.style.display = "inline-block";
        }
        lastClicked = el;
    }

    function deselectAll() {
        for (const el of selectedElements) el.classList.remove('selected');
        selectedElements.clear();
    }
    //------------------------------------------//
    // CONTEXT MENU (Updated with alignment)
    //------------------------------------------//
    function showContextMenu(x, y) {
        const isLabel = [...selectedElements].every(el => el.matches('.label, .value, .headerlabel, .bodylabel, .footerlabel, .headervalue, .bodyvalue, .footervalue, .headerformula, .bodyformula, .footerformula'));
        const isFooterEPField = [...selectedElements].every(el => el.matches('.footerhline,.footervline,.footerlabel, .footervalue, .footerbox, .imageheader, .qrcodefooter, .barcodefooter, .footerformula'));
        const isAlreadyAppliedFooterEP = [...selectedElements].every(el => el.matches('.footerhline,.footervline,.footerlabel, .footervalue, .footerbox, .imageheader, .qrcodefooter, .barcodefooter, .footerformula') && el.dataset.FooterOnEPControl == 1);
        const isLabelwrapapplied = [...selectedElements].every(el => el.matches('.label, .value, .headerlabel, .bodylabel, .footerlabel, .headervalue, .bodyvalue, .footervalue, .headerformula, .bodyformula, .footerformula') && el.dataset.WrapText == 1);
        //el.FooterOnEPControl
        //const elements = paper.querySelectorAll('.label, .value, .line, .box, .image, .headerlabel, .bodylabel, .footerlabel, .headervalue, .bodyvalue, .footervalue, .headerbox, .bodybox, .footerbox, .imagefooter, .imageheader,.qrcodeheader,.qrcodefooter,.barcodeheader,.barcodefooter');

        contextMenu.innerHTML = `
    <div data-action="duplicate">Duplicate</div>
    <div data-action="delete">Delete</div>
    ${isLabel ? `
      ------------------------------
      <div data-action="bold">Bold</div>
      <div data-action="italic">Italic</div>
      <div data-action="increase-font">Increase Font</div>
      <div data-action="decrease-font">Decrease Font</div>
      -----------------------------
      <div data-action="align-left">Align Left</div>
      <div data-action="align-center">Align Center</div>
      <div data-action="align-right">Align Right</div>      
    ` : ''}
    ${isLabel ? isLabelwrapapplied ? `
-----------------------------
<div data-action="RemoveWrap">Remove Wrap Text</div> 
` : `-----------------------------
<div data-action="AddWrap">Wrap Text</div>`: ``}
        ${!isAlreadyAppliedFooterEP && isFooterEPField ? `
      ------------------------------
      <div data-action="FooteronEP">Footer on EP</div>
    ` : ''}
        ${isAlreadyAppliedFooterEP && isFooterEPField ? `
      ------------------------------
      <div data-action="RemoveFooteronEP">Remove Footer on EP</div>
    ` : ''}
  `;
        contextMenu.style.left = x + 'px';
        contextMenu.style.top = y + 'px';
        contextMenu.style.display = 'block';
    }

    document.body.addEventListener('click', () => { contextMenu.style.display = 'none';});

    contextMenu.addEventListener('click', e => {
        const action = e.target.dataset.action;
        if (!selectedElements.size) return;

        switch (action) {
            case 'delete':
                for (const el of selectedElements) el.remove();
                deselectAll();
                break;

            case 'duplicate':
                duplicateSelected();
                break;

            case 'bold':
                for (const el of selectedElements) {
                    //if (el.classList.contains('label') || el.classList.contains('value')) {
                    if (el.matches('.label, .value, .headerlabel, .bodylabel, .footerlabel, .headervalue, .bodyvalue, .footervalue, .headerformula, .bodyformula, .footerformula')) {
                        console.log("selected Elements", selectedElements);
                        el.style.fontWeight = el.style.fontWeight === 'bold' ? 'normal' : 'bold';
                        el.dataset.boldtext = el.dataset.boldtext == '1' ? '0' : '1';

                    }
                }
                break;

            case 'italic':
                for (const el of selectedElements)
                    //if (el.classList.contains('label') || el.classList.contains('value')) {
                    if (el.matches('.label, .value, .headerlabel, .bodylabel, .footerlabel, .headervalue, .bodyvalue, .footervalue, .headerformula, .bodyformula, .footerformula')) {
                        el.style.fontStyle = el.style.fontStyle === 'italic' ? 'normal' : 'italic';
                        el.dataset.italictext = el.dataset.italictext == '1' ? '0' : '1';
                    }
                break;

            case 'increase-font':
                for (const el of selectedElements)
                    //if (el.classList.contains('label') || el.classList.contains('value')) {
                    if (el.matches('.label, .value, .headerlabel, .bodylabel, .footerlabel, .headervalue, .bodyvalue, .footervalue, .headerformula, .bodyformula, .footerformula')) {
                        const s = parseInt(window.getComputedStyle(el).fontSize);
                        el.style.fontSize = (s + 2) + 'px';
                    }
                break;

            case 'decrease-font':
                for (const el of selectedElements)
                    //if (el.classList.contains('label') || el.classList.contains('value')) {
                    if (el.matches('.label, .value, .headerlabel, .bodylabel, .footerlabel, .headervalue, .bodyvalue, .footervalue, .headerformula, .bodyformula, .footerformula')) {
                        const s = parseInt(window.getComputedStyle(el).fontSize);
                        el.style.fontSize = (s - 2) + 'px';
                    }
                break;

            case 'align-left':
                for (const el of selectedElements)
                    //if (el.classList.contains('label') || el.classList.contains('value'))
                    if (el.matches('.label, .value, .headerlabel, .bodylabel, .footerlabel, .headervalue, .bodyvalue, .footervalue, .headerformula, .bodyformula, .footerformula'))
                        el.style.textAlign = 'left';
                break;

            case 'align-center':
                for (const el of selectedElements)
                    //if (el.classList.contains('label') || el.classList.contains('value'))
                    if (el.matches('.label, .value, .headerlabel, .bodylabel, .footerlabel, .headervalue, .bodyvalue, .footervalue, .headerformula, .bodyformula, .footerformula'))
                        el.style.textAlign = 'center';
                break;

            case 'align-right':
                for (const el of selectedElements)
                    //if (el.classList.contains('label') || el.classList.contains('value'))
                    if (el.matches('.label, .value, .headerlabel, .bodylabel, .footerlabel, .headervalue, .bodyvalue, .footervalue, .headerformula, .bodyformula, .footerformula'))
                        el.style.textAlign = 'right';
                break;

            case 'FooteronEP':
                for (const el of selectedElements)
                    //if (el.classList.contains('label') || el.classList.contains('value'))
                    if (el.matches('.line,.headerhline,.bodyhline,.footerhline,.headervline,.bodyvline,.footervline,.footerlabel, .footervalue, .footerbox, .imageheader, .qrcodefooter, .barcodefooter, .footerformula'))
                        el.dataset.FooterOnEPControl = 1;
                break;
            case 'RemoveFooteronEP':
                for (const el of selectedElements)
                    //if (el.classList.contains('label') || el.classList.contains('value'))
                    if (el.matches('.line,.headerhline,.bodyhline,.footerhline,.headervline,.bodyvline,.footervline,.footerlabel, .footervalue, .footerbox, .imageheader, .qrcodefooter, .barcodefooter, .footerformula'))
                        el.dataset.FooterOnEPControl = 0;

            case 'AddWrap':
                for (const el of selectedElements)
                    //if (el.classList.contains('label') || el.classList.contains('value'))
                    if (el.matches('.label, .value, .headerlabel, .bodylabel, .footerlabel, .headervalue, .bodyvalue, .footervalue, .headerformula, .bodyformula, .footerformula'))
                        el.dataset.WrapText = 1;
                break;
            case 'RemoveWrap':
                for (const el of selectedElements)
                    //if (el.classList.contains('label') || el.classList.contains('value'))
                    if (el.matches('.label, .value, .headerlabel, .bodylabel, .footerlabel, .headervalue, .bodyvalue, .footervalue, .headerformula, .bodyformula, .footerformula')) 
                        el.dataset.WrapText = 0;
                break;
        }
        deselectAll();
        contextMenu.style.display = 'none';
    });


    //------------------------------------------//
    // RESIZE (All Edges + Corners)
    //------------------------------------------//
    function createResizeHandles(el) {
        const handles = ['nw', 'ne', 'sw', 'se', 'n', 's', 'e', 'w'];
        handles.forEach(pos => {
            console.log("resize handle");
            const h = document.createElement('div');
            h.className = 'resize-handle ' + pos;
            el.appendChild(h);
            h.addEventListener('mousedown', e => {
                e.stopPropagation();
                console.log("mousedown resize handle");
                resizeStart(e, el, pos);
            });
        });
    }

    function resizeStart(e, el, pos) {
        const startX = e.clientX, startY = e.clientY;
        const startW = el.offsetWidth, startH = el.offsetHeight;
        const startLeft = el.offsetLeft, startTop = el.offsetTop;
        function onMove(ev) {
            let dx = ev.clientX - startX, dy = ev.clientY - startY;
            let newW = startW, newH = startH, newLeft = startLeft, newTop = startTop;
            if (pos.includes('e')) newW = startW + dx;
            if (pos.includes('s')) newH = startH + dy;
            if (pos.includes('w')) { newW = startW - dx; newLeft = startLeft + dx; }
            if (pos.includes('n')) { newH = startH - dy; newTop = startTop + dy; }
            if (el.dataset.type === 'hline') newH = 2;
            if (el.dataset.type === 'vline') newW = 2;
            el.style.width = newW + 'px'; el.style.height = newH + 'px';
            el.style.left = newLeft + 'px'; el.style.top = newTop + 'px';
        }
        document.addEventListener('mousemove', onMove);
        document.addEventListener('mouseup', () => document.removeEventListener('mousemove', onMove), { once: true });
    }

    //------------------------------------------//
    // ROTATION (360°)
    //------------------------------------------//
    function createRotateHandle(el) {
        const r = document.createElement('div');
        r.className = 'rotate-handle';
        el.appendChild(r);
        r.addEventListener('mousedown', e => {
            e.stopPropagation();
            rotateStart(e, el);
        });
    }
    function rotateStart(e, el) {
        const rect = el.getBoundingClientRect();
        const cx = rect.left + rect.width / 2, cy = rect.top + rect.height / 2;
        const startA = Math.atan2(e.clientY - cy, e.clientX - cx);
        const startR = parseFloat(el.dataset.rotation) || 0;
        function onMove(ev) {
            const curA = Math.atan2(ev.clientY - cy, ev.clientX - cx);
            const rot = startR + (curA - startA) * 180 / Math.PI;
            el.dataset.rotation = rot;
            el.style.transform = `rotate(${rot}deg)`;
        }
        document.addEventListener('mousemove', onMove);
        document.addEventListener('mouseup', () => document.removeEventListener('mousemove', onMove), { once: true });
    }

    //------------------------------------------//
    // KEYBOARD SHORTCUTS  🆕
    //------------------------------------------//
    function duplicateSelected() {
        const clones = [];
        for (const el of selectedElements) {
            const c = el.cloneNode(true);
            c.style.left = (parseInt(el.style.left) + 20) + 'px';
            c.style.top = (parseInt(el.style.top) + 20) + 'px';
            makeInteractive(c);
            paper.appendChild(c);
            clones.push(c);
        }
        deselectAll();
        clones.forEach(c => { selectedElements.add(c); c.classList.add('selected'); });
    }

    document.addEventListener('keydown', e => {
        const step = e.altKey ? 10 : 1;
        if (e.key === 'a' && e.ctrlKey) {
            e.preventDefault();
            deselectAll();
            paper.querySelectorAll('.label,.value,.line,.headerhline,.bodyhline,.footerhline,.headervline,.bodyvline,.footervline,.box,.image, .headerlabel, .bodylabel, .footerlabel, .headervalue, .bodyvalue, .footervalue, .headerbox, .bodybox, .footerbox, .imagefooter, .imageheader,.qrcodeheader,.barcodeheader,.qrcodefooter,.barcodefooter, .headerformula, .bodyformula, .footerformula').forEach(el => {
                selectedElements.add(el); el.classList.add('selected');
            });
            return;
        }
        if (!selectedElements.size) return;

        if (e.ctrlKey && e.key === 'Delete') {
            e.preventDefault();
            for (const el of selectedElements) el.remove();
            deselectAll();
        }
        else if ((e.key === 'd' || e.key === 'D') && e.ctrlKey) {
            e.preventDefault(); duplicateSelected();
        }
        else if (!e.ctrlKey && ['ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown'].includes(e.key)) {
            e.preventDefault();
            for (const el of selectedElements) {
                let x = parseInt(el.style.left) || 0;
                let y = parseInt(el.style.top) || 0;
                if (e.key === 'ArrowLeft') el.style.left = Math.max(0, x - step) + 'px';
                if (e.key === 'ArrowRight') el.style.left = Math.min(paper.clientWidth - el.offsetWidth, x + step) + 'px';
                if (e.key === 'ArrowUp') el.style.top = Math.max(0, y - step) + 'px';
                if (e.key === 'ArrowDown') el.style.top = Math.min(paper.clientHeight - el.offsetHeight, y + step) + 'px';
            }
        }
        else if (e.key === 'Escape') { deselectAll(); }
    });
    //------------------------------------------//
    // SHOW INFO BUTTON — Get All Controls Data
    //------------------------------------------//
    document.getElementById('showInfo').addEventListener('click', () => {
        const elements = paper.querySelectorAll('.label, .line, .box, .image, .headerlabel, .bodylabel, .footerlabel, .headervalue, .bodyvalue, .footervalue, .headerbox, .bodybox, .footerbox, .imagefooter, .imageheader,.qrcodeheader,.barcodeheader,.qrcodefooter,.barcodefooter, .headerformula, .bodyformula, .footerformula');
        const info = [];

        elements.forEach(el => {

            const rect = el.getBoundingClientRect();
            const paperRect = paper.getBoundingClientRect();
            const x = Math.round(rect.left - paperRect.left);
            const y = Math.round(rect.top - paperRect.top);
            const width = Math.round(rect.width);
            const height = Math.round(rect.height);
            const rotation = el.dataset.rotation || 0;
            const IsBold = el.dataset.boldtext;
            const IsItalic = el.dataset.italictext;
            const sPlaceType = el.dataset.PlaceType;
            const item = {
                Type: el.matches('.label, .headerlabel, .bodylabel, .footerlabel')
                    ? 'Label'
                    : el.matches('.value, .headervalue, .bodyvalue, .footervalue')
                        ? 'Value'
                        : el.matches('.box, .headerbox, .bodybox, .footerbox')//el.classList.contains('box')//, .headerbox, .bodybox, .footerbox
                            ? 'Box'
                            : el.matches('.image, .imagefooter, .imageheader')//el.classList.contains('image')
                                ? 'Image'
                                : el.matches('.qrcodeheader,.qrcodefooter')
                                    ? 'gksQRCode'
                                    : el.matches('.barcodeheader,.barcodefooter')
                                        ? 'gksBarCode'
                                        : el.dataset.type === 'hline'
                                            ? 'H_Line'
                                            : el.dataset.type === 'vline'
                                                ? 'V_Line'
                                                : 'Unknown',
                X: x,
                Y: y,
                Width: width,
                Height: height,
                Rotation: rotation + '°',
                Bold: IsBold,
                Italic: IsItalic,
                PlaceType: sPlaceType
            };

            if (el.matches('.label, .value, .headerlabel, .bodylabel, .footerlabel, .headervalue, .bodyvalue, .footervalue, .headerbox, .bodybox, .footerbox, .headerformula, .bodyformula, .footerformula')) {
                //if (el.classList.contains('label')) {
                const style = window.getComputedStyle(el);
                item.FontSize = style.fontSize;
                item.FontFamily = style.fontFamily;
                item.FontWeight = style.fontWeight;
                item.FontStyle = style.fontStyle;
                item.Text = el.textContent.trim();
                item.Bold = IsBold;
                item.Italic = IsItalic;
                item.PlaceType = el.dataset.PlaceType;
            }
            console.log("item ", item);
            info.push(item);
        });

        // Display results in a nice popup
        if (!info.length) {
            alert('No controls added on paper.');
            return;
        }

        let msg = '📋 Current Controls Info:<br/><br/>';
        info.forEach((item, i) => {
            msg += `${i + 1}. ${item.Type}<br/>`;
            msg += `   Position: (${item.X}, ${item.Y})<br/>`;
            msg += `   Size: ${item.Width} x ${item.Height}<br/>`;
            msg += `   Rotation: ${item.Rotation}<br/>`;
            if (item.Type === 'Label') {
                msg += `   Font: ${item.FontFamily}<br/>`;
                msg += `   Font Size: ${item.FontSize}<br/>`;
                msg += `   Weight: ${item.FontWeight}<br/>`;
                msg += `   Style: ${item.FontStyle}<br/>`;
                msg += `   Text: "${item.Text}"<br/>`;
            }
            msg += '<br/>';
        });
        console.log(msg);
        //alert(msg);
        InfoDialogMsg(msg, "Controls Info");
    });
    //------------------------------------------//
    // SAVE ALL CONTROLS TO DATABASE (via WebAPI)
    //------------------------------------------//
    function SaveValidation() {
        var isValid = true;
        var IsAdd = $("#rdoAddnew").is(":checked");
        var IsContSheet = $("#chkContinuesPapper").is(":checked");
        if ($("#cmbTransactionName").val() == 0) {
            isValid = false;
            showErrorSnackbar("Select Transaction")
        }
        if (!IsAdd) {
            if ($("#cmbConfigurationName").val() == 0) {
                isValid = false;
                showErrorSnackbar("Select Configuration Name")
            }
        }
        if (IsAdd) {
            if ($("#txtNewConfigName").val() == "") {
                isValid = false;
                showErrorSnackbar("Configuration Name should not be empty")
            }
        }
        if ($("#paperType").val() == "" || $("#paperType").val() == null) {
            isValid = false;
            showErrorSnackbar("Select Paper size")
        }
        if (!IsContSheet) {
            if ($("#txtItemsPerPage").val() == "" || $("#txtItemsPerPage").val() == null) {
                isValid = false;
                showErrorSnackbar("Items Per Page shold not be empty")
            }
        }
        return isValid;
    }
    ['saveToDB'].forEach(id => {//'saveAsToDB'
        document.getElementById(id).addEventListener('click', async () => {
            strSaveType = id == "saveToDB" ? "save" : "saveas";
            if (SaveValidation()) {
                if (cfFocus != 3) {
                    ConfirmDialogMsg("Do you want to save data?");
                } else {
                    SaveData();
                }
            }
        });
    });
    function SaveData() {
        var PrintDetails = [];
        //,.footervlineel.className = ctrl.PlaceType == "Header" ? 'headervline' : ctrl.PlaceType == "Body" ? 'bodyvline' : ctrl.PlaceType == "Footer" ? 'footervline' : 'vline';
        const elements = paper.querySelectorAll(`.label, .value,  .box, .image, .headerlabel, .bodylabel, .footerlabel, .headervalue, .bodyvalue, .footervalue, 
        .headerbox, .bodybox, .footerbox, .imagefooter, .imageheader,.qrcodeheader,.qrcodefooter,.barcodeheader,.barcodefooter,
        .headerformula, .bodyformula, .footerformula,.headervline,.bodyvline,.footervline,.headerhline,.bodyhline,.footerhline`);
        console.log("elements ", elements);
        const controls = [];
        elements.forEach(el => {
            const rect = el.getBoundingClientRect();
            const paperRect = paper.getBoundingClientRect();
            const x = Math.round(rect.left - paperRect.left);
            const y = Math.round(rect.top - paperRect.top);
            const width = Math.round(rect.width);
            const height = Math.round(rect.height);
            const rotation = parseFloat(el.dataset.rotation) || 0;
            const IsBold = el.dataset.boldtext;
            const IsItalic = el.dataset.italictext;
            const sPlaceType = el.dataset.PlaceType;
            const FooteronEPField = el.dataset.FooterOnEPControl || 0;
            const nWrap = el.dataset.WrapText || "0";
            //, .headerformula, .bodyformula, .footerformula
            const data = {
                PaperID: 1, // optional, set your paper/project ID dynamically
                ControlType: el.matches('.label, .headerlabel, .bodylabel, .footerlabel')
                    ? 'Label'
                    : el.matches('.value, .headervalue, .bodyvalue, .footervalue')
                        ? 'Value'
                        : el.matches('.box, .headerbox, .bodybox, .footerbox')//: el.classList.contains('box')
                            ? 'Box'
                            : el.matches('.headerformula, .bodyformula, .footerformula')//: el.classList.contains('box')
                                ? 'Formula'
                            //, .imagefooter, .imageheader
                            : el.matches('.image, .imagefooter, .imageheader')//:el.classList.contains('image')
                                ? 'Image'
                                : el.matches('.qrcodeheader,.qrcodefooter')
                                    ? 'gksQRCode'
                                    : el.matches('.barcodeheader,.barcodefooter')
                                        ? 'gksBarCode'
                                            : el.matches('.hline,.headerhline,.bodyhline,.footerhline')//el.dataset.type === 'hline'
                                            ? 'H_Line'
                                                : el.matches('.vline, .headervline,.bodyvline,.footervline')//el.dataset.type === 'vline'
                                                ? 'V_Line'
                                                : 'Unknown',
                X: x,
                Y: y,
                Width: width,
                Height: height,
                Rotation: rotation,
                FontFamily: null,
                FontSize: null,
                FontWeight: null,
                FontStyle: null,
                TextValue: null,
                ImageData: null,
                Bold: IsBold,
                Italic: IsItalic,
                PlaceType: sPlaceType,
                IsFooter: FooteronEPField,
                WrapText: nWrap
            };
            if (el.matches('.label, .value, .headerlabel, .bodylabel, .footerlabel, .headervalue, .bodyvalue, .footervalue, .headerbox, .bodybox, .footerbox, .headerformula, .bodyformula, .footerformula')) {
                //if (el.classList.contains('label') || el.classList.contains('value')) {
                const style = window.getComputedStyle(el);
                console.log(" style ", style);
                data.FontFamily = style.fontFamily;
                data.FontSize = style.fontSize;
                data.FontWeight = style.fontWeight;
                data.FontStyle = style.fontStyle;
                data.Alignment = style.textAlign == "left" ? "0" : style.textAlign == "right" ? "1" : style.textAlign == "center" ? "2" : "1";
                data.TextValue = el.textContent.trim();
                data.Fontcolor = style.color;
            }
            //, .imagefooter, .imageheader
            if (el.matches('image, .imagefooter, .imageheader')) {
                const img = el.querySelector('img');
                if (img && img.src.startsWith('data:image')) {
                    data.ImageData = img.src; // Base64 encoded
                }
            }
            if (el.matches('.qrcodeheader,.qrcodefooter,.barcodeheader,.barcodefooter')) {
                //el.dataset.qrbarid  , el.dataset.qrcodetext
                data.QRBarcodeID = el.dataset.qrbarid;
                data.QRText = el.dataset.qrcodetext;
            }
            controls.push(data);
        });

        if (!controls.length) {
            //alert('No controls to save.');
            showErrorSnackbar("Select atleast one control");
            return;
        }
        var PrintData = {
            SaveType: strSaveType,//id == "saveToDB" ? "Save" : "SaveAs",
            SaveMode: $("#rdoAddnew").is(":checked") ? 1 : 2,
            TransactionID: strSaveType == "save" ? $("#cmbTransactionName").val() : $("#cmbSaveasTransactionName").val(),
            PrintID: $("#cmbConfigurationName").val(),
            ConfigName: strSaveType == "save" ? $("#txtNewConfigName").val() : $("#txtSaveasProfileName").val(),
            PaperTypeID: $("#paperType").val(),
            PaperType: $("#paperType option:selected").text(),
            Width: $("#customWidth").val(),
            Height: $("#customHeight").val(),
            ContinuesPaper: $("#chkContinuesPapper").is(":checked") ? 1 : 0,
            FooterOnEP: $("#chkFooteronEveryPage").is(":checked") ? 1 : 0,
            IncludeCut: $("#chkIncut").is(":checked") ? 1 : 0,
            LineFeed: $("#txtLF").val(),
            BodyLineSpace: $("#txtBLS").val(),
            DetailItemPerPage: $("#txtItemsPerPage").val(),
            PrintMode: $("#rdoWindows").is(":checked") ? 1 : 0,
            UserID: UID,
            PrintConfigDeatils: controls
        }

        PrintDetails.push(PrintData)
        try {
            $.ajax({
                url: Aurl + "printcustomize/savecontrols",
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(PrintDetails),
                cache: false,
                processData: false,
                xhrFields: {
                    withCredentials: true
                },
                success: function (data) {
                    if (data) {
                        $.each(data, function (i, items) {
                            if (items.MsgID == 0) {
                                showSuccessSnackbar(items.Message);
                                modalQRBarcode.style.display = "none";
                            } else {
                                showErrorSnackbar(items.Message);
                            }
                        });
                    } else {
                        showSuccessSnackbar(data);
                    }

                }
            });
        } catch (err) {
            console.error(err);
            alert('Error saving controls: ' + err.message);
        }
    }
    //------------------------------------------//
    // LOAD ALL CONTROLS FROM DATABASE
    //------------------------------------------//
    document.getElementById('loadFromDB').addEventListener('click', async () => {
        const PrintProfileID = $("#cmbConfigurationName").val();// same PaperID used when saving
        $("#txtRename").val("");
        $("#divRename").html("");
        if (PrintProfileID > 0) {
            var ConfigName = $("#cmbConfigurationName option:selected").text();
            $("#txtRename").val(ConfigName);
            try {
                $.ajax({
                    url: Aurl + "printcustomize/getcontrols",
                    type: 'GET',
                    contentType: 'JSON',
                    data: { PrintID: PrintProfileID },
                    async: false,
                    xhrFields: {
                        withCredentials: true
                    },
                    success: function (data) {
                        //showSuccessSnackbar(data);
                        console.log(data);
                        const controls = data[0].PrintConfigDeatils;
                        if (!controls || !controls.length) {
                            alert('No saved controls found.');
                            return;
                        }
                        $("#paperType").val(data[0].PaperTypeID);
                        $("#customWidth").val(data[0].Width);
                        $("#customHeight").val(data[0].Height);
                        $("#chkContinuesPapper").prop("checked", data[0].ContinuesPaper == 1);
                        $("#chkFooteronEveryPage").prop("checked", data[0].FooterOnEP == 1);
                        $("#chkIncut").prop("checked", data[0].IncludeCut == 1);
                        $("#txtLF").val(data[0].LineFeed);
                        $("#txtBLS").val(data[0].BodyLineSpace);
                        $("#txtItemsPerPage").val(data[0].DetailItemPerPage);
                        $("#rdoWindows").prop("checked", data[0].PrintMode == 1);
                        $("#rdoDOS").prop("checked", data[0].PrintMode == 0);

                        // Clear paper first
                        paper.innerHTML = '';
                        //Height, width set
                        paper.style.width = mmToPx(data[0].Width) + 'px';
                        paper.style.height = mmToPx(data[0].Height) + 'px';
                        // Rebuild all elements
                        controls.forEach(ctrl => {
                            let el;
                            //console.log("ctrl : ", ctrl);
                            switch (ctrl.ControlType) {
                                case 'Label':
                                    el = document.createElement('div');
                                    el.className = ctrl.PlaceType == "Header" ? 'headerlabel' : ctrl.PlaceType == "Body" ? 'bodylabel' :
                                        ctrl.PlaceType == "Footer" ? 'footerlabel' : 'label';
                                    el.textContent = ctrl.TextValue || 'Label';
                                    el.style.fontFamily = ctrl.FontFamily || 'Arial';
                                    el.style.fontSize = ctrl.FontSize || '14px';
                                    el.style.fontWeight = ctrl.Bold == "1" ? 'bold' : 'normal';// ctrl.FontWeight
                                    el.style.fontStyle = ctrl.FontStyle || 'normal';
                                    el.style.textAlign = ctrl.Alignment || 'left';
                                    el.dataset.WrapText = ctrl.Wraptext || "0";
                                    //el.PlaceType = ctrl.Type || "Header";
                                    break;

                                case 'Value':
                                    el = document.createElement('div');
                                    el.className = ctrl.PlaceType == "Header" ? 'headervalue' : ctrl.PlaceType == "Body" ? 'bodyvalue' :
                                        ctrl.PlaceType == "Footer" ? 'footervalue' : 'value';
                                    el.textContent = ctrl.TextValue || 'Value';
                                    el.style.fontFamily = ctrl.FontFamily || 'Arial';
                                    el.style.fontSize = ctrl.FontSize || '14px';
                                    el.style.fontWeight = ctrl.Bold == "1" ? 'bold' : 'normal';//  ctrl.FontWeight || 'normal';
                                    el.style.fontStyle = ctrl.FontStyle || 'normal';
                                    el.style.textAlign = ctrl.Alignment || 'left';
                                    el.dataset.WrapText = ctrl.Wraptext || "0";
                                    //el.PlaceType = ctrl.Type || "Header";
                                    break;
                                case 'Formula':
                                    el = document.createElement('div');
                                    el.className = ctrl.PlaceType == "Header" ? 'headerformula' : ctrl.PlaceType == "Body" ? 'bodyformula' :
                                        ctrl.PlaceType == "Footer" ? 'footerformula' : 'formula';
                                    el.textContent = ctrl.TextValue || 'formula';
                                    el.style.fontFamily = ctrl.FontFamily || 'Arial';
                                    el.style.fontSize = ctrl.FontSize || '14px';
                                    el.style.fontWeight = ctrl.Bold == "1" ? 'bold' : 'normal';//  ctrl.FontWeight || 'normal';
                                    el.style.fontStyle = ctrl.FontStyle || 'normal';
                                    el.style.textAlign = ctrl.Alignment || 'left';
                                    el.dataset.WrapText = ctrl.Wraptext || "0";
                                    //el.PlaceType = ctrl.Type || "Header";
                                    break;
                                case 'Box':
                                    el = document.createElement('div');
                                    //el.className = 'box';
                                    el.className = ctrl.PlaceType == "Header" ? 'headerbox' : ctrl.PlaceType == "Body" ? 'bodybox' :
                                        ctrl.PlaceType == "Footer" ? 'footerbox' : 'box';
                                    break;

                                case 'Image':
                                    el = document.createElement('div');
                                    //el.className = 'image';
                                    el.className = ctrl.PlaceType == "Header" ? 'imageheader' : ctrl.PlaceType == "Body" ? 'bodyimage' :
                                        ctrl.PlaceType == "Footer" ? 'imagefooter' : 'image';
                                    const img = document.createElement('img');
                                    img.src = ctrl.ImageData || '';
                                    //img.style.opacity = 0.2;
                                    el.appendChild(img);
                                    break;
                                
                                case 'H_Line':
                                    el = document.createElement('div');
                                    //el.className = 'line';
                                    el.className = ctrl.PlaceType == "Header" ? 'headerhline' : ctrl.PlaceType == "Body" ? 'bodyhline' : ctrl.PlaceType == "Footer" ? 'footerhline' : 'hline';
                                    el.dataset.type = 'hline';
                                    el.style.height = '2px';
                                    break;

                                case 'V_Line':
                                    el = document.createElement('div');
                                    //el.className = 'line';
                                    el.className = ctrl.PlaceType == "Header" ? 'headervline' : ctrl.PlaceType == "Body" ? 'bodyvline' : ctrl.PlaceType == "Footer" ? 'footervline' : 'vline';
                                    el.dataset.type = 'vline';
                                    el.style.width = '2px';
                                    break;
                                //.qrcodeheader,.qrcodefooter,.barcodeheader,.barcodefooter

                                case 'gksQRCode':
                                    el = document.createElement('div');
                                    var QRBarID = ctrl.TextValue;
                                    el.dataset.qrbarid = QRBarID;
                                    if (ctrl.QRText != "" || ctrl.QRText != null) {
                                        el.dataset.qrcodetext = ctrl.QRText
                                    }
                                    //QR Code : NQR1 - Doc ID,NQR2 - Text,SQR3 - Signed QR,UWA4 - UPI With Amt,UWO5 - UPI With Amt

                                    var titletext = "";
                                    if (QRBarID.includes('NQR') && el.dataset.qrcodetext == "") {
                                        titletext = "Document ID";
                                    }
                                    if (QRBarID.includes('NQR') && el.dataset.qrcodetext != "") {
                                        titletext = "Text";
                                    }
                                    if (QRBarID.includes('SQR')) {
                                        titletext = "Signed QR";
                                    }
                                    if (QRBarID.includes('UWA')) {
                                        titletext = "UPI With Amount";
                                    }
                                    if (QRBarID.includes('UWO')) {
                                        titletext = "UPI Without Amount";
                                    }
                                    el.title = titletext;
                                    el.className = ctrl.PlaceType == "Header" ? 'qrcodeheader' : ctrl.PlaceType == "Footer" ? 'qrcodefooter' : 'qrcodeheader';
                                    const imgqr = document.createElement('img');
                                    el.appendChild(imgqr);
                                    break;

                                case 'gksBarCode':

                                    el = document.createElement('div');
                                    var QRBarID = ctrl.TextValue;
                                    el.dataset.qrbarid = QRBarID;
                                    //Bar Code : BRE3 - Eway No,BRA2 - Ack No,BRC1 - Doc ID
                                    var titletext = "";
                                    if (QRBarID.includes('BRC')) {
                                        titletext = "Document ID";
                                    }
                                    if (QRBarID.includes('BRA')) {
                                        titletext = "Acknowledge No";
                                    }
                                    if (QRBarID.includes('BRE')) {
                                        titletext = "Eway No";
                                    }
                                    el.title = titletext;
                                    el.className = ctrl.PlaceType == "Header" ? 'barcodeheader' : ctrl.PlaceType == "Footer" ? 'barcodefooter' : 'barcodeheader';
                                    const imgbar = document.createElement('img');
                                    el.appendChild(imgbar);
                                    break;

                                default:
                                    return; // skip unknown
                            }
                            el.dataset.FooterOnEPControl = ctrl.IsFooter;
                            el.dataset.IsFooterContol = ctrl.PlaceType == "Footer" ? 1 : 0;
                            el.dataset.boldtext = ctrl.Bold || "0";
                            el.dataset.italictext = ctrl.Italic || "0";
                            el.dataset.PlaceType = ctrl.PlaceType || "Header";
                            
                            el.style.left = ctrl.X + 'px';
                            el.style.top = ctrl.Y + 'px';
                            el.style.width = ctrl.Width + 'px';
                            el.style.height = ctrl.Height + 'px';
                            el.dataset.rotation = ctrl.Rotation || 0;
                            el.style.transform = `rotate(${ctrl.Rotation || 0}deg)`;

                            if (ctrl.Fontcolor) {
                                var fontColor = ctrl.Fontcolor; // A,R,G,B
                                var parts = fontColor.split(',');
                                var a = (parts[0]);
                                var r = (parts[1]);
                                var g = (parts[2]);
                                var b = (parts[3]);
                                var alpha = (a / 255).toFixed(2);

                                // Build CSS rgba color string
                                var cssColor = `rgba(${r}, ${g}, ${b}, ${alpha})`;
                                el.style.color = cssColor;
                            }
                            //console.log("element : ", el);
                            // Make interactive again
                            makeInteractive(el);

                            // Add to paper
                            paper.appendChild(el);
                        });
                    }
                });
                //alert('Controls loaded successfully!');
            } catch (err) {
                console.error(err);
                alert('Error loading controls: ' + err.message);
            }
        }
        else {
            showErrorSnackbar("Select Valid Profile");
        }
    });
    TransactionControls();
    function TransactionControls() {
        var nTransID = $("#cmbTransactionName").val();
        $.ajax({
            url: Aurl + "printcustomize/transactioncontrols",
            type: 'GET',
            contentType: 'JSON',
            data: { TransID: nTransID },
            async: false,
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                tableHeaderControls.destroy();
                tableBodyControls.destroy();
                tableFooterControls.destroy();
                $('#tblHeaderControls,#tblBodyControls,#tblFooterControls').empty();
                console.log(data);
                var HeaderFields = data[0].Header;
                var BodyFields = data[0].Body;
                var FooterFields = data[0].Footer;
                $('#tblHeaderControls').DataTable({
                    pageLength: ItemsperPage, lengthMenu: [[10, 20, 50, 100, -1], [10, 20, 50, 100, "All"]],
                    scrollY: "450px",
                    scrollX: true,
                    scrollCollapse: true,
                    paging: false,
                    destroy: true,
                    data: HeaderFields,
                    fixedColumns: false,
                    searching: true,
                    ordering: false,
                    sorting: false,
                    info: false,
                    pageLength: ItemsperPage, // default page size
                    lengthMenu: [[10, 20, 50, 100, -1], [10, 20, 50, 100, "All"]],
                    columns: [
                        { "data": "ControlName", "autoWidth": true, className: "dt-body-left clsHeaderFields" },//3
                    ],
                    initComplete: function () {
                        // Hide thead after DataTable is fully initialized
                        $('#tblHeaderControls thead').hide();
                    }
                });
                tableHeaderControls = $('#tblHeaderControls').DataTable();
                $('#tblBodyControls').DataTable({
                    pageLength: ItemsperPage, lengthMenu: [[10, 20, 50, 100, -1], [10, 20, 50, 100, "All"]],
                    scrollY: "450px",
                    scrollX: true,
                    scrollCollapse: true,
                    paging: false,
                    destroy: true,
                    data: BodyFields,
                    fixedColumns: false,
                    searching: true,
                    ordering: false,
                    sorting: false,
                    info: false,
                    pageLength: ItemsperPage, // default page size
                    lengthMenu: [[10, 20, 50, 100, -1], [10, 20, 50, 100, "All"]],
                    columns: [
                        { "data": "ControlName", "autoWidth": true, className: "dt-body-left clsBodyFields" },//3
                    ]
                });
                tableBodyControls = $('#tblBodyControls').DataTable();
                $('#tblFooterControls').DataTable({
                    pageLength: ItemsperPage, lengthMenu: [[10, 20, 50, 100, -1], [10, 20, 50, 100, "All"]],
                    scrollY: "450px",
                    scrollX: true,
                    scrollCollapse: true,
                    paging: false,
                    destroy: true,
                    data: FooterFields,
                    fixedColumns: false,
                    searching: true,
                    ordering: false,
                    sorting: false,
                    info: false,
                    pageLength: ItemsperPage, // default page size
                    lengthMenu: [[10, 20, 50, 100, -1], [10, 20, 50, 100, "All"]],
                    columns: [
                        { "data": "ControlName", "autoWidth": true, className: "dt-body-left clsFooterFields" },//3
                    ]
                });
                tableFooterControls = $('#tblFooterControls').DataTable();
            }
        });
    }
    $(document).on('click', '.clsHeaderFields', function (e) {//$('#tblHeaderControls tbody')
        rowdata = tableHeaderControls.row($(this).parents('tr')).data();
        if (rowdata) {
        var Field = rowdata.ControlName;
            //console.log(Field)
            if (!formulaselected) {
                addElement("value", Field);
            }
            else {
                var ExistsFormulaData = $('#txtFormulaData').val();
                var NewData = ExistsFormulaData + '[' + Field + ']';
                $('#txtFormulaData').val(NewData);
            }
        }
    });
    $(document).on('click', '.clsBodyFields', function (e) {//$('#tblHeaderControls tbody')
        rowdata = tableBodyControls.row($(this).parents('tr')).data();
        if (rowdata) {
            var Field = rowdata.ControlName;
            //console.log(Field)
            if (!formulaselected) {
                addElement("value", Field);
            }
            else {
                    var ExistsFormulaData = $('#txtFormulaData').val();
                    var NewData = ExistsFormulaData + '[' + Field + ']';
                    $('#txtFormulaData').val(NewData);
                }
        }
    });
    $(document).on('click', '.clsFooterFields', function (e) {//$('#tblHeaderControls tbody')
        rowdata = tableFooterControls.row($(this).parents('tr')).data();
        if (rowdata) {
            var Field = rowdata.ControlName;
            //console.log(Field)
            if (!formulaselected) {
                addElement("value", Field);
            }
            else {
                var ExistsFormulaData = $('#txtFormulaData').val();
                var NewData = ExistsFormulaData + '[' + Field + ']';
                $('#txtFormulaData').val(NewData);
            }
        }
    });
    
    $('#btnaddFormula').click(function (e) {
        if ($('#txtFormulaData').val() != "") {
            if (!IsFormaulaEdit) {
                addElement("formula", $('#txtFormulaData').val());
            } else {
                for (const el of selectedElements) {
                    el.textContent = $('#txtFormulaData').val();
                    makeInteractive(el);
                }
            }
            modalFormula.style.display = "none";
            $('#txtFormulaData').val("");
            formulaselected = false;
            IsFormaulaEdit = false;
        } else {
            showErrorSnackbar("Field should not empty.Select valid values");
        }
    });
    $("#cmbTransactionName").change(function (e) {
        TransactionControls();
    });
    //rdoheader,rdobody,rdofooter
    //tbHeader,tbBody,tbFooter
    $('#tbHeader').click(function (e) {
        $("#rdoheader").prop("checked", true);
        $("#rdoheader").prop("disabled", false);
        $("#rdobody").prop("disabled", true);
        $("#rdofooter").prop("disabled", false);
    });
    $('#tbBody').click(function (e) {
        $("#rdobody").prop("checked", true);
        $("#rdoheader").prop("disabled", true);
        $("#rdobody").prop("disabled", false);
        $("#rdofooter").prop("disabled", true);
    });
    $('#tbFooter').click(function (e) {
        $("#rdofooter").prop("checked", true);
        $("#rdoheader").prop("disabled", false);
        $("#rdobody").prop("disabled", true);
        $("#rdofooter").prop("disabled", false);
    });
    function InitialDatas() {
        arrPaperTypes = [], arrFontNames = [], arrTransactions = [], arrProfileNames = [];
        $.ajax({
            url: Aurl + "printcustomize/initialDatas",
            type: 'GET',
            contentType: 'JSON',
            data: {  },
            async: false,
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                console.log(data)
                $('#paperType,#cmbFontNames,#cmbTransactionName,#cmbSaveasTransactionName').find("option").remove();
                arrPaperTypes = data[0].PrintPaper;
                arrTransactions = data[0].TransNames;
                arrProfileNames = data[0].ConfigNames;
                arrFontNames = data[0].FontNames;

                $.each(arrPaperTypes, function (i, items) {
                    $('#paperType').append($('<option/>', {
                        value: items.ID,
                        text: items.PaperSize,
                    }));
                });
                $.each(arrFontNames, function (i, items) {
                    $('#cmbFontNames').append($('<option/>', {
                        value: items.ID,
                        text: items.FontName,
                    }));
                });
                $.each(arrTransactions, function (i, items) {
                    if (i == 0) {
                        //LoadConfigNames(items.ID)
                        TransactionControls();
                    }
                    $('#cmbTransactionName,#cmbSaveasTransactionName').append($('<option/>', {
                        value: items.ID,
                        text: items.TransName,
                    }));
                });
            }
        });
    }
    function LoadConfigNames(TransID) {
        if (arrProfileNames) {
            $('#cmbConfigurationName').find("option").remove();
            var Configs = arrProfileNames.filter(c => c.TransactionID == TransID);
            if (Configs.length > 0) {
                $.each(Configs, function (i, items) {
                    $('#cmbConfigurationName').append($('<option/>', {
                        value: items.PrintID,
                        text: items.ConfigName, 'data-automail': items.AutoMail
                    }));
                });
            } else {
                showErrorSnackbar("No profiles found");
            }
        }
    }
    $('#btnDeleteProfile,#saveAsToDB').hide();
    $('#rdoAddnew').click(function (e) {
        $("#dvExistConfig").hide();
        $("#dvNewConfig").show();
        $('#btnDeleteProfile,#saveAsToDB').hide();
        $('#btnScript').hide();
    });
    $('#rdoModify').click(function (e) {
        $("#dvExistConfig").show();
        $("#dvNewConfig").hide();
        $('#btnDeleteProfile,#saveAsToDB').show();
        var TransID = $('#cmbTransactionName').val();
        LoadConfigNames(TransID);
        $('#btnScript').hide();
        if (UID == 1) {
            $('#btnScript').show();
        }
    });
    $('#cmbTransactionName').change(function (e) {
        var TransID = e.target.value;
        var IsModify = $('#rdoModify').is(":checked");
        if (IsModify) {
            LoadConfigNames(TransID);
        }
    });
    $('#btnRename').click(function (e) {
        $("#divRename").html("");
        var nConfigID = $('#cmbConfigurationName').val();
        if (nConfigID > 0) {
            var strNewProfileName = $('#txtRename').val();
            var nTransID = $('#cmbTransactionName').val();
            if (strNewProfileName != "") {
                $.ajax({
                    url: Aurl + "printcustomize/renameprofile",
                    type: 'GET',
                    contentType: 'JSON',
                    data: { TransID: nTransID, ConfigID: nConfigID, NewProfileName: strNewProfileName },
                    async: false,
                    xhrFields: {
                        withCredentials: true
                    },
                    success: function (data) {
                        if (data) {
                            $("#divRename").html(data);
                            showErrorSnackbar(data)
                        } else {
                            showSuccessSnackbar("Renamed Successfully");
                        }
                    }
                });
            }
            else {
                showErrorSnackbar("New Profile name should not be empty");
            }
        } else {
            showErrorSnackbar("Select valid profiles");
        }
    });
    $('#btnClear').click(function (e) {
        if (cfFocus != 3) { ClearConfirmDialogMsg("Do you want to clear?"); } else { ClearForm(); }
    });
    function ClearForm() {
        location.reload();
    }
    $('#btnDeleteProfile').click(function (e) {
        var IsModify = $("#rdoModify").is(":checked");
        if (IsModify) {
            var nConfigID = $('#cmbConfigurationName').val() || 0;
            if (parseInt(nConfigID) > 0) {
                if (confirm("Do you want to delete profile?")) {
                    $.ajax({
                        url: Aurl + "printcustomize/deleteprofile",
                        type: 'GET',
                        contentType: 'JSON',
                        data: { ConfigID: nConfigID },
                        async: false,
                        xhrFields: {
                            withCredentials: true
                        },
                        success: function (data) {
                            showSuccessSnackbar(data);
                            setTimeout(() => {
                                location.reload();
                            }, 2000);
                        }
                    });
                }
            } else {
                showErrorSnackbar("Select valid profiles");
            }
        }
    });
    $("#btnPCPreview").click(function (e) {
        var nConfigID = $('#cmbConfigurationName').val() || 0;
        var nTransID = $('#cmbTransactionName').val() || 0;
        var PreviewDocID = $('#txtPreviewDocID').val();
        var isValid = true;
        if (nConfigID == "" || nConfigID == 0) {
            showErrorSnackbar("Select Configuration Name");
            isValid = false;
        }
        if (nTransID == "" || nTransID == 0) {
            showErrorSnackbar("Select Transaction");
            isValid = false;
        }
        if (PreviewDocID == "" || PreviewDocID == 0) {
            showErrorSnackbar("Enter Valid Doc ID");
            isValid = false;
        }
        if (isValid) {
            $("#btniframePDF,#btniframePrint").hide();
            PCPrintDocument(PreviewDocID, nTransID, nConfigID, 1);
        }
    });
    function PCPrintDocument(ID, strTransID, nConfigID, printorpreview = 0) {
        $.ajax({
            //url: '@Url.Action("PDFGenerate", "CustomizePrinting")',
            url: Aurl + "invoice/PDFGenerate",
            type: 'GET',
            datatype: 'json',
            data: { DocID: ID, TransID: strTransID, ConfigID: nConfigID },
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                if (data.length > 0) {
                    var tempurl = Aurl.replace("/api/", "/");
                    if (printorpreview == 0) {
                        printEmbedDocument(tempurl + "PDF/" + data);//myurl
                    } else {
                        previewiframe(tempurl + "PDF/" + data);//myurl
                    }
                } else {
                    showErrorSnackbar('Enter Valid Doc ID');
                }
            }, error: function (data) {
                if (data.status == "401") {
                    var msg = data.responseJSON.Message;
                    //showErrorSnackbar(msg + " Logout and Login again.");
                }
            }
        });
    }
    $("#btnScript").click(function () {
        var nConfigID = $('#cmbConfigurationName').val() || 0;
        var strConfigName = $('#cmbConfigurationName option:selected').text();
        if (nConfigID > 0) {
            location.href = Aurl + 'printcustomize/profilescript?ConfigID=' + nConfigID + "&ConfigName=" + strConfigName;
        }
        else {
            showErrorSnackbar("Select Config Name")
        }
    });
</script>

